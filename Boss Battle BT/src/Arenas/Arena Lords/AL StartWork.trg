{
  "Id": 50333705,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope OverloadArena initializer init\r\n\r\n    globals\r\n        public constant integer GOLD_INITIAL_FIRST = 60\r\n        public constant integer GOLD_INITIAL_SECOND = 120\r\n        public constant integer GOLD_EXTRA_PER_KILL = 5\r\n        public constant integer GOLD_CAP = 130\r\n        \r\n        private constant integer CENTER_SPAWN_ABILITY = 'A1EX'\r\n        \r\n        private constant integer SPAWN_COOLDOWN = 15\r\n        \r\n        private timer TimerSpawn = CreateTimer()\r\n        private integer Boss_Level = 0\r\n        private integer Boss_Index = 0\r\n        \r\n        boolean IsDisabled_OverlordArena = false\r\n    endglobals\r\n\r\n\tprivate function AggroStart takes nothing returns nothing\r\n\t\tlocal integer id = GetHandleId( GetExpiredTimer() )\r\n\t\tlocal unit boss = LoadUnitHandle(udg_hash, id, StringHash(\"aggro_delay\") )\r\n\t\t\r\n\t\tcall aggro(boss)\r\n\t\tcall FlushChildHashtable( udg_hash, id )\r\n\t\t\r\n\t\tset boss = null\r\n\tendfunction\r\n\t\r\n    private function AL_BossSpawn takes integer bossId, timer timerUsed returns nothing\r\n    \tlocal unit boss\r\n        local integer rand = GetRandomInt( 1, 4 )\r\n\r\n        set boss = CreateUnit(Player(10), bossId, GetLocationX( udg_point[rand + 13] ), GetLocationY( udg_point[rand + 13] ), 270 )\r\n        \r\n        //call BJDebugMsg(\"Boss: \" + GetUnitName(boss))\r\n        if GetUnitAbilityLevel( boss, CENTER_SPAWN_ABILITY ) > 0 then\r\n        \tcall SetUnitPosition( boss, GetRectCenterX( udg_Boss_Rect ), GetRectCenterX( udg_Boss_Rect ) )\r\n        endif\r\n        \r\n        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Orc\\\\FeralSpirit\\\\feralspirittarget.mdl\", boss, \"origin\" ) )\r\n        call PingMinimapForForceEx( bj_FORCE_ALL_PLAYERS, GetUnitX( boss ), GetUnitY( boss ), 5, bj_MINIMAPPINGSTYLE_ATTACK, 100, 50, 50 )\r\n        \r\n        if GetUnitTypeId(boss) == 'n00F' then\r\n\t\t\tcall CombatTimer_Launch()\r\n            call ExtraArenaGeneral_RemovePortals()\r\n            call PauseTimer( timerUsed )\r\n        endif\r\n\r\n        call InvokeTimerWithUnit( boss, \"aggro_delay\", 0.05, false, function AggroStart )\r\n\r\n        set boss = null\r\n    endfunction\r\n\r\n\tprivate function GetAmountOfBosses takes integer bossId returns integer\r\n\t\tif bossId == 0 then\r\n\t\t\treturn 0\r\n\t\tendif\r\n\t\treturn CountUnitsInGroup(GetUnitsOfTypeIdAll(bossId))\r\n\tendfunction\r\n\r\n\tprivate function Tick takes timer timerUsed returns nothing\r\n\t\tlocal integer bossLevel = Boss_Level\r\n\t\tlocal integer bossIndex = Boss_Index + 1\r\n        local integer bossId = DB_Boss_id[bossLevel][bossIndex]\r\n        local boolean loopEnd = false\r\n        local integer amountOfBosses\r\n        \r\n        //call BJDebugMsg(\"TICK\")\r\n        loop\r\n            exitwhen loopEnd or bossLevel > 10\r\n            set amountOfBosses = GetAmountOfBosses(bossId)\r\n            if amountOfBosses > 0 then\r\n            \t//call BJDebugMsg(\"INDEX+\")\r\n            \tset bossIndex = bossIndex + 1\r\n            \tset bossId = DB_Boss_id[bossLevel][bossIndex]\r\n            elseif bossId != 0 and amountOfBosses == 0 then\r\n            \t//call BJDebugMsg(\"FOUND\")\r\n            \tset Boss_Level = bossLevel \r\n        \t\tset Boss_Index = bossIndex\r\n                call AL_BossSpawn(bossId, timerUsed)\r\n                set loopEnd = true\r\n            else\r\n            \t//call BJDebugMsg(\"ADD\")\r\n                set bossLevel = bossLevel + 1\r\n                set bossIndex = 1\r\n                //call BJDebugMsg(\"bossLevel: \" + I2S(bossLevel) )\r\n                //call BJDebugMsg(\"bossIndex: \" + I2S(bossIndex) )\r\n                set bossId = DB_Boss_id[bossLevel][bossIndex]\r\n            /*else\r\n            \t//call BJDebugMsg(\"END\")\r\n                set loopL = true\r\n                call PauseTimer( timerUsed )*/\r\n            endif\r\n        endloop\r\n        if bossLevel > 10 then\r\n        \tcall BJDebugMsg(\"Error! OverloadArena: Tick - Boss not found! bossLevel: \" + I2S(bossLevel) + \" bossIndex: \" + I2S(bossIndex) + \" bossId: \" + I2S(bossId) + \" amountOfBosses: \" + I2S(amountOfBosses))\r\n        endif\r\n        \r\n        call ExtraArenaGeneral_CreateRunes()\r\n    endfunction\r\n    \r\n    private function LA_StartSpawn takes nothing returns nothing\r\n        if udg_fightmod[4] == false then\r\n            call PauseTimer( GetExpiredTimer() )\r\n        else\r\n        \tcall Tick(GetExpiredTimer())\r\n        endif\r\n    endfunction\r\n\r\n    function Trig_AL_StartWork_Actions takes nothing returns nothing\r\n    \tlocal integer bossId\r\n    \r\n        set udg_Boss_Rect = gg_rct_RandomItem\r\n        set udg_Boss_BigRect = gg_rct_Vision3\r\n        set udg_fightmod[4] = true\r\n        set IsDisabled_OverlordArena = true\r\n        call FightStart()\r\n        call MultiSetColor( udg_multi, 5, 2, 0.00, 0.00, 0.00, 100.00 )\r\n        \r\n        call EnableTrigger( gg_trg_IA_TPBattle )\r\n        call EnableTrigger( gg_trg_BossDamage )\r\n        call OverlordArenaDeath_Enable()\r\n        \r\n        call ExtraArenaGeneral_MoveHeroesIntoArena()\r\n        \r\n        if udg_Arena_LvL[1] == 0 then\r\n            set udg_number[9] = GOLD_INITIAL_FIRST\r\n            call DisplayTimedTextToForce( GetPlayersAll(), 15, \"|cffffcc00'Overlord Arena'|r - an arena in which bosses constantly appear. For each defeated boss you will receive gold.\" )\r\n            call DisplayTimedTextToForce( GetPlayersAll(), 15, \"|cffffcc00Death in this arena will not bring defeat.|r\")\r\n        else\r\n            set udg_number[9] = GOLD_INITIAL_SECOND\r\n        endif\r\n        \r\n        if udg_Arena_LvL[1] == 1 then\r\n            set bossId = 'e004'\r\n            set Boss_Level = 4\r\n        else\r\n            set bossId = 'n005'\r\n            set Boss_Level = 1\r\n        endif\r\n        set Boss_Index = 1\r\n        call TimerStart( TimerSpawn, SPAWN_COOLDOWN, true, function LA_StartSpawn )\r\n        \r\n        call AL_BossSpawn(bossId, null)\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_AL_StartWork = CreateTrigger(  )\r\n        call TriggerAddAction( gg_trg_AL_StartWork, function Trig_AL_StartWork_Actions )\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}