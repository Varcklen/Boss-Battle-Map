{
  "Id": 50333692,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope InfiniteArena initializer init\r\n\r\n    globals\r\n        private integer round\r\n        private integer pack\r\n        private integer upgrade_counter\r\n        \r\n        private integer enemySpawnLimit\r\n    endglobals\r\n    \r\n    public function GetRound takes nothing returns integer\r\n        return round\r\n    endfunction\r\n\r\n    //=========Aggro===========\r\n    private function unit_search takes nothing returns boolean\r\n        local unit filtered = GetFilterUnit()\r\n        local boolean b\r\n        \r\n        set b = GetOwningPlayer(filtered) == Player(10) and GetUnitCurrentOrder(filtered) == OrderId(\"stand\") and GetUnitDefaultMoveSpeed(filtered) > 0\r\n        set filtered = null\r\n        return b\r\n    endfunction\r\n\r\n    public function Aggro takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local group g = CreateGroup()\r\n        local unit u\r\n\r\n        if udg_fightmod[0] == false then\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n            call GroupEnumUnitsInRect(g, gg_rct_RandomItem, Condition( function unit_search ))\r\n            loop\r\n                set u = FirstOfGroup(g)\r\n                exitwhen u == null\r\n                call aggro( u )\r\n                call GroupRemoveUnit(g,u)\r\n            endloop\r\n        endif\r\n        \r\n        call DestroyGroup( g )\r\n        set u = null\r\n        set g = null\r\n    endfunction\r\n    //=========================\r\n    \r\n    private function SpawnRune takes nothing returns nothing\r\n        set bj_lastCreatedItem = CreateItem( 'I03J' + GetRandomInt(1, 6), GetRandomReal(GetRectMinX(udg_Boss_Rect), GetRectMaxX(udg_Boss_Rect)), GetRandomReal(GetRectMinY(udg_Boss_Rect), GetRectMaxY(udg_Boss_Rect)) )\r\n        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Orc\\\\FeralSpirit\\\\feralspirittarget.mdl\", GetItemX( bj_lastCreatedItem ), GetItemY( bj_lastCreatedItem ) ) )\r\n    endfunction\r\n    \r\n    private function SpawnUnit takes integer unitNumber, integer spawnPosition returns nothing\r\n        local UnitIA unitSctruct = IADatabase_Units[unitNumber]\r\n        local integer id\r\n        local integer color\r\n        \r\n        set bj_lastCreatedUnit = CreateUnitAtLoc(Player(10), unitSctruct.Rawcode, udg_point[spawnPosition + 13], 90 * spawnPosition  - 45)\r\n        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Orc\\\\FeralSpirit\\\\feralspirittarget.mdl\", bj_lastCreatedUnit, \"origin\" ) )\r\n        \r\n        call BlzSetUnitMaxHP( bj_lastCreatedUnit, unitSctruct.Health_Initial + (unitSctruct.Health_Increase*round) )\r\n        call BlzSetUnitBaseDamage( bj_lastCreatedUnit, unitSctruct.Attack_Initial + (unitSctruct.Attack_Increase*round), 0 )\r\n        call SetUnitMoveSpeed( bj_lastCreatedUnit, GetUnitDefaultMoveSpeed(bj_lastCreatedUnit) + (unitSctruct.Speed_Increase*round) )\r\n        call SetUnitLifePercentBJ( bj_lastCreatedUnit, 100 )\r\n        \r\n        /*Visual*/\r\n    \tcall BlzSetUnitRealFieldBJ( bj_lastCreatedUnit, UNIT_RF_SCALING_VALUE, BlzGetUnitRealField(bj_lastCreatedUnit, UNIT_RF_SCALING_VALUE) + (UnitIA.UNIT_SIZE_INCREASE*round) )\r\n    \t\r\n    \tset color = IMaxBJ(0, BlzGetUnitIntegerField(bj_lastCreatedUnit, UNIT_IF_TINTING_COLOR_RED) - (UnitIA.RED_COLOR_INCREASE*round))\r\n    \tcall SetUnitVertexColor(bj_lastCreatedUnit, BlzGetUnitIntegerField(bj_lastCreatedUnit, UNIT_IF_TINTING_COLOR_RED), color, color, 255)\r\n        /*=======*/\r\n        \r\n        set id = GetHandleId( bj_lastCreatedUnit )\r\n        call SaveInteger( udg_hash, id, StringHash( \"roundIA\" ), round )\r\n        call SaveInteger( udg_hash, id, StringHash( \"goldIA\" ), unitSctruct.Gold_Initial + (unitSctruct.Gold_Increase*round) )\r\n        \r\n        set unitSctruct = 0\r\n    endfunction\r\n    \r\n    private function LaunchWave takes nothing returns nothing\r\n    \tlocal integer i\r\n        local integer minionAmount\r\n    \r\n    \tset minionAmount = CountUnitsInGroup(GetUnitsInRectOfPlayer(gg_rct_RandomItem, Player(10)))\r\n        if minionAmount <= enemySpawnLimit then\r\n            set i = 1\r\n            loop\r\n                exitwhen i > 4\r\n                call SpawnUnit( IADatabase_PackUnit[pack][i-1], i)\r\n                set i = i + 1\r\n            endloop\r\n        endif\r\n        \r\n        set pack = pack + 1\r\n        if pack >= IADatabase_PACK_AMOUNT then\r\n            set pack = 0\r\n        endif\r\n        \r\n        set upgrade_counter = upgrade_counter + 1\r\n        if upgrade_counter >= IADatabase_WAVES_UNTIL_UPGRADE then\r\n            set upgrade_counter = 0\r\n            set round = round + 1\r\n        endif\r\n    endfunction\r\n\r\n    private function StartSpawn takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer( ) )\r\n        \r\n        if not( udg_fightmod[2] ) then\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n            call LaunchWave()\r\n            \r\n            if ModuloInteger(pack, 2) == 0 then\r\n\t            call SpawnRune()\r\n\t            if udg_modgood[21] then\r\n\t                call SpawnRune()\r\n\t            endif\r\n            endif\r\n        endif\r\n    endfunction\r\n    \r\n    private function FirstLaunchDelay takes nothing returns nothing\r\n    \tlocal integer id = GetHandleId( GetExpiredTimer( ) )\r\n    \tlocal timer launchTimer\r\n    \t\r\n    \tcall FlushChildHashtable( udg_hash, id )\r\n    \tif not( udg_fightmod[2] ) then\r\n    \t\treturn\r\n    \tendif\r\n    \t\r\n    \tcall LaunchWave()\r\n    \r\n    \tset id = StringHash( \"IA_spawner\" )\r\n    \tset launchTimer = LoadTimerHandle( udg_hash, 1, id )\r\n        if LoadTimerHandle( udg_hash, 1, id ) == null then\r\n        \tset launchTimer = CreateTimer()\r\n            call SaveTimerHandle( udg_hash, 1, id, launchTimer )\r\n        endif\r\n        call TimerStart( launchTimer, IADatabase_PACK_SPAWN_COOLDOWN, true, function StartSpawn )\r\n    endfunction\r\n\r\n    function Trig_IA_StartWork_Actions takes nothing returns nothing\r\n        local integer cyclA = 1\r\n        local integer id\r\n\r\n        set udg_Boss_Rect = gg_rct_RandomItem\r\n        set udg_Boss_BigRect = gg_rct_Vision3\r\n        set udg_ArenaLim[0] = udg_ArenaLim[0] + 1\r\n        set udg_fightmod[2] = true\r\n        set udg_logic[33] = true\r\n        call FightStart()\r\n        call TriggerExecute( gg_trg_BossDamage )\r\n        call MultiSetColor( udg_multi, 4, 2, 0.00, 0.00, 0.00, 100.00 )\r\n        \r\n        call EnableTrigger( gg_trg_IA_TPBattle )\r\n        loop\r\n            exitwhen cyclA > 4\r\n            call CreateUnitAtLoc(Player(10), 'h00J', udg_point[cyclA + 43], ( 90. * cyclA ) - 45. )\r\n            if GetPlayerSlotState(Player(cyclA - 1)) == PLAYER_SLOT_STATE_PLAYING then\r\n                call SetUnitPositionLoc( udg_hero[cyclA], udg_point[cyclA + 17] )\r\n                call PanCameraToTimedLocForPlayer( Player(cyclA - 1), udg_point[( cyclA + 17 )], 0.00 )\r\n                call DestroyEffect( AddSpecialEffect( \"Void Teleport Caster.mdx\" , GetUnitX( udg_hero[cyclA] ), GetUnitY( udg_hero[cyclA] ) ) )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        \r\n        //Arena Starter\r\n        set round = udg_Arena_LvL[0]*2\r\n        set pack = 0\r\n        set upgrade_counter = 0\r\n        set enemySpawnLimit = IADatabase_ENEMY_LIMIT_BASE * udg_Heroes_Amount + IADatabase_ENEMY_LIMIT_PER_HERO\r\n        \r\n        set id = StringHash( \"IA_spawn_delay\" )\r\n        if LoadTimerHandle( udg_hash, 1, id ) == null then\r\n            call SaveTimerHandle( udg_hash, 1, id, CreateTimer() )\r\n        endif\r\n        call TimerStart( LoadTimerHandle( udg_hash, 1, id ), IADatabase_FIRST_WAVE_APPEAR_DELAY, false, function FirstLaunchDelay )\r\n        \r\n        call EnableTrigger( gg_trg_IA_End )\r\n        //==================\r\n        \r\n        //Explanation\r\n        if udg_Arena_LvL[0] == 0 then\r\n            set cyclA = 0\r\n            loop\r\n                exitwhen cyclA > 3\r\n                if GetPlayerSlotState(Player(cyclA)) == PLAYER_SLOT_STATE_PLAYING and udg_LvL[cyclA+1] <= 5 then\r\n                    call DisplayTimedTextToPlayer( Player( cyclA ), 0, 0, 15, \"|cffffcc00'Endless Arena'|r - an arena in which enemies will constantly appear. For each defeated enemy you will receive gold.\" )\r\n                    call DisplayTimedTextToPlayer( Player( cyclA ), 0, 0, 15, \"|cffffcc00Death in this arena will not bring defeat.|r Enemy get stronger over time.\" )\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n        //==================\r\n        \r\n        //Aggro\r\n        set id = GetHandleId( udg_UNIT_CUTE_BOB )\r\n        \r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"aggro\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"aggro\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"aggro\" ) ) ) \r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_UNIT_CUTE_BOB ), StringHash( \"aggro\" ) ), 1, true, function Aggro )\r\n        //==================\r\n        \r\n        //Lord of Chaos: Madness\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if GetUnitAbilityLevel( udg_hero[cyclA], 'A0LK') > 0 and GetPlayerSlotState(Player(cyclA - 1)) == PLAYER_SLOT_STATE_PLAYING then\r\n                call madness( udg_hero[cyclA], GetUnitAbilityLevel( udg_hero[cyclA], 'A0LK') )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        //==================\r\n        \r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_IA_StartWork = CreateTrigger()\r\n        call TriggerAddAction( gg_trg_IA_StartWork, function Trig_IA_StartWork_Actions )\r\n    endfunction\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}