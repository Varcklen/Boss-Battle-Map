{
  "Id": 50332152,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library SetDamageLib requires UnitstLib, HealstLib\r\n\r\nfunction CommandoWAtCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local integer counter = LoadInteger( udg_hash, id, StringHash( \"codw\" ) ) + 1\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"codw\" ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"codwc\" ) )\r\n    local unit u\r\n    local real NewX = GetUnitX( dummy ) + 90 * Cos( 0.017 * GetUnitFacing( dummy ) )\r\n    local real NewY = GetUnitY( dummy ) + 90 * Sin( 0.017 * GetUnitFacing( dummy ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"codw\" ) )\r\n    local group g = CreateGroup()\r\n    local boolean l = false\r\n\r\n    if counter >= 8 or GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n        call RemoveUnit( dummy )\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        call SetUnitPosition( dummy, NewX, NewY )\r\n        call SaveInteger( udg_hash, id, StringHash( \"codw\" ), counter )\r\n        call GroupEnumUnitsInRange( g, GetUnitX( dummy ), GetUnitY( dummy ), 100, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if unitst( u, dummy, \"enemy\" ) then\r\n                set l = true\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n\r\n        if l then\r\n            call GroupEnumUnitsInRange( g, GetUnitX( dummy ), GetUnitY( dummy ), 150, null )\r\n            loop\r\n                set u = FirstOfGroup(g)\r\n                exitwhen u == null\r\n                if unitst( u, dummy, \"enemy\" ) then\r\n                    call UnitDamageTarget( dummy, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS )\r\n                endif\r\n                call GroupRemoveUnit(g,u)\r\n            endloop\r\n            call RemoveUnit( dummy )\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        endif\r\n    endif\r\n    \r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set caster = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction CommandoWAt takes unit caster, real dmg, integer lvl returns nothing\r\n    local integer id\r\n    local integer cyclA = 1\r\n    local integer b = lvl + 4\r\n    local real x = GetUnitX( caster ) + 90 * Cos( 0.017 * GetUnitFacing( caster ) )\r\n    local real y = GetUnitY( caster ) + 90 * Sin( 0.017 * GetUnitFacing( caster ) )\r\n\r\n    loop\r\n        exitwhen cyclA > b\r\n        set bj_lastCreatedUnit = CreateUnit( GetOwningPlayer( caster ), 'u000', x, y, GetUnitFacing( caster ) + GetRandomReal( -40, 40 ) ) \r\n        call UnitAddAbility( bj_lastCreatedUnit, 'A0N5')\r\n        call UnitAddAbility( bj_lastCreatedUnit, 'A19G')\r\n        \r\n        set id = GetHandleId( bj_lastCreatedUnit )\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"codw\" ), CreateTimer() )\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"codw\" ) ) ) \r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"codw\" ), bj_lastCreatedUnit )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"codwc\" ), caster )\r\n        call SaveReal( udg_hash, id, StringHash( \"codw\" ), dmg )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"codw\" ) ), 0.04, true, function CommandoWAtCast )\r\n        set cyclA = cyclA + 1\r\n    endloop\r\nendfunction\r\n\r\nfunction InfernalE takes unit u, real dmg returns nothing\r\n    local integer id = GetHandleId(u)\r\n    local real dmgdone = LoadReal( udg_hash, id, StringHash( \"infe\" ) )\r\n    local real dmghp = LoadReal( udg_hash, id, StringHash( \"infen\" ) )\r\n\r\n    set dmgdone = dmgdone + dmg\r\n    if dmgdone >= dmghp then\r\n        set dmgdone = 0\r\n        if GetUnitAbilityLevel(u, 'A1A6') > 1 then\r\n            call platest(u, -1 )\r\n            set bj_lastCreatedItem = CreateItem('I0G8', GetUnitX( u ) + GetRandomReal( -300, 300 ), GetUnitY( u ) + GetRandomReal( -300, 300 ))\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Orc\\\\MirrorImage\\\\MirrorImageDeathCaster.mdl\", GetItemX( bj_lastCreatedItem ), GetItemY( bj_lastCreatedItem ) ) )\r\n        endif\r\n    endif\r\n    \r\n    call SaveReal( udg_hash, id, StringHash( \"infe\" ), dmgdone )\r\nendfunction\r\n\r\nfunction MimicRCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit c = LoadUnitHandle( udg_hash, id, StringHash( \"mmcrc\" ) )\r\n    local unit t = LoadUnitHandle( udg_hash, id, StringHash( \"mmcr\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"mmcr\" ) )\r\n\r\n    if GetUnitState( t, UNIT_STATE_LIFE) > 0.405 then\r\n        call UnitDamageTarget( c, t, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n\tendif\r\n    \r\n    call FlushChildHashtable( udg_hash, id )\r\n    \r\n    set c = null\r\n    set t = null\r\nendfunction\r\n\r\nfunction CairneCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit c = LoadUnitHandle( udg_hash, id, StringHash( \"crnnc\" ) )\r\n    local unit t = LoadUnitHandle( udg_hash, id, StringHash( \"crnn\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"crnn\" ) )\r\n\r\n    if GetUnitState( t, UNIT_STATE_LIFE) > 0.405 then\r\n        call UnitDamageTarget( c, t, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n\tendif\r\n    \r\n    call FlushChildHashtable( udg_hash, id )\r\n    \r\n    set c = null\r\n    set t = null\r\nendfunction\r\n\r\nfunction MaidenECast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"mdne\" ) )\r\n\r\n    call UnitRemoveAbility( u, 'A16P' )\r\n    call UnitRemoveAbility( u, 'B07C' )\r\n    call FlushChildHashtable( udg_hash, id )\r\n\r\n    set u = null\r\nendfunction\r\n\r\nfunction Channel_Energy takes unit u, real damage returns nothing\r\n    local unit target = LoadUnitHandle( udg_hash, GetHandleId( u ), StringHash( \"pckw2\" ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, GetHandleId( u ), StringHash( \"pckw2c\" ) )\r\n    local real percent = LoadReal( udg_hash, GetHandleId( u ), StringHash( \"pckw2\" ) )\r\n\r\n    if target != null then\r\n        call healst(caster, target, percent*damage)\r\n    endif\r\n\r\n    set u = null\r\n    set target = null\r\n    set caster = null\r\nendfunction\r\n\r\nfunction MarshalRDamage takes unit hero, integer lvl, real dmg returns nothing\r\n    local real bonusDmg = 0.05+(0.05*lvl)\r\n    local real bonusCritDmg = 5 + lvl\r\n    \r\n    set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*bonusDmg)\r\n\r\n    if luckylogic( hero, MARSHAL_R_CHANCE, 1, 100 ) then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*bonusCritDmg)\r\n        set udg_DamageEventType = udg_DamageTypeCriticalStrike\r\n    endif\r\n    \r\n    set hero = null\r\nendfunction\r\n\r\nfunction EntW_Stun takes unit target, group affected returns nothing\r\n    local unit u \r\n    loop\r\n        set u = FirstOfGroup(affected)\r\n        exitwhen u == null\r\n        if unitst( u, target, \"enemy\" ) then\r\n            call UnitStun(target, u, CORRUPTED_ENT_W_DAMAGE_STUN_DURATION )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\RaiseSkeletonWarrior\\\\RaiseSkeleton.mdl\", u, \"origin\" ) )\r\n        endif\r\n        call GroupRemoveUnit(affected,u)\r\n    endloop\r\n    set u = null\r\nendfunction\r\n\r\nfunction EntW_Damage takes unit target, unit dealer returns nothing\r\n    local integer unitId = GetHandleId( target )\r\n    local real damage = udg_DamageEventAmount * LoadReal(udg_hash, unitId, StringHash(\"entw\") )\r\n    local real summary = LoadReal(udg_hash, unitId, StringHash(\"entwsum\") ) + damage\r\n    local boolean isWork = LoadBoolean(udg_hash, unitId, StringHash(\"entwwrk\") )\r\n    local group affected = LoadGroupHandle(udg_hash, GetHandleId( target ), StringHash(\"entwg\") )\r\n    \r\n    call SaveReal(udg_hash, unitId, StringHash(\"entwsum\"), summary )\r\n    \r\n    set udg_DamageEventAmount = udg_DamageEventAmount - damage\r\n    call SetUnitState( dealer, UNIT_STATE_LIFE, RMaxBJ(0,GetUnitState( dealer, UNIT_STATE_LIFE) - damage ))\r\n    \r\n    if IsUnitInGroup(dealer, affected) == false and IsUnitAlive(dealer) then\r\n        call GroupAddUnit(affected, dealer)\r\n    endif\r\n    \r\n    if summary >= CORRUPTED_ENT_W_DAMAGE_STUN_LIMIT and isWork == false then\r\n        call SaveBoolean(udg_hash, unitId, StringHash(\"entwwrk\"), true )\r\n        call EntW_Stun(target, affected)\r\n    endif\r\nendfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}