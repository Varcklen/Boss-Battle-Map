{
  "Id": 50332153,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "/*\r\n\t--This Whole Trigger is Obsolete. Please do not add anything here.\r\n*/\r\nfunction Trig_Set_Damage_Actions takes nothing returns nothing\r\n    local integer i = GetPlayerId( GetOwningPlayer(udg_DamageEventSource) ) + 1\r\n    local integer k = GetPlayerId( GetOwningPlayer(udg_DamageEventTarget) ) + 1\r\n    local integer cyclA = 1\r\n    local real l \r\n    local real sh\r\n    local real dmg = udg_DamageEventAmount\r\n    local integer id\r\n    local integer g\r\n    local unit u \r\n    local real t\r\n    local integer p\r\n    \r\n    if udg_DamageReduction[k] != 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (udg_DamageReduction[k]*dmg) \r\n    endif\r\n    \r\n    if udg_IsDamageSpell then\r\n        set l = LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"dvre\" ) )\r\n        set udg_DamageEventAmount = udg_DamageEventAmount * (1+l)\r\n    endif\r\n    \r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'BPSE') > 0 and GetUnitAbilityLevel( udg_DamageEventSource, 'B05J') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount * 2  \r\n    endif\r\n    if GetUnitAbilityLevel( udg_DamageEventSource, 'B07Y') > 0 then\r\n        call UnitRemoveAbility( udg_DamageEventSource, 'A02Z' )\r\n        call UnitRemoveAbility( udg_DamageEventSource, 'B07Y' )\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (3*dmg) \r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B073') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (dmg*0.2)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B07U') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*0.25)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_hero[i], 'B088') > 0 and ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*0.75)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_hero[i], 'B09J') > 0 and ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + dmg\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B09J') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (0.5*dmg)\r\n    endif\r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0LH') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + LoadInteger( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"wndrb\" ) )\r\n    endif\r\n    if GetUnitAbilityLevel( udg_DamageEventSource, 'B04O') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (LoadReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"pckrb\" ))*dmg) \r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B08Q') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (dmg*0.15)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A0VW') > 0 then\r\n        set udg_DamageEventAmount = ( 0.95 - ( 0.05 * GetUnitAbilityLevel(udg_DamageEventTarget, 'A0VW') ) ) * udg_DamageEventAmount\r\n    endif\r\n    if GetUnitAbilityLevel(udg_hero[i], 'A165') > 0 and inv( udg_hero[i], 'I03R' ) > 0 and GetUnitAbilityLevel(udg_DamageEventTarget, 'A16A') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (0.4*dmg)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_hero[i], 'A0JV') > 0 and GetUnitState( udg_DamageEventTarget, UNIT_STATE_LIFE ) <= ((0.2+(0.05*GetUnitAbilityLevel(udg_hero[i], 'A0JV')))*GetUnitState( udg_DamageEventTarget, UNIT_STATE_MAX_LIFE) ) and ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) then\r\n        set udg_DamageEventType = udg_DamageTypeCriticalStrike\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (0.75*dmg)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A15P') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (dmg*LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"prdw1\" )))\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A0DZ') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"sslq\" ))*dmg)\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A15Q') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - (dmg*(0.03+(0.03*GetUnitAbilityLevel(udg_DamageEventTarget, 'A15Q'))))\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventSource, 'A16N') > 0 and IsUnitEnemy( udg_DamageEventSource, GetOwningPlayer( udg_DamageEventTarget ) ) and udg_combatlogic[i] then\r\n        set l = GetUnitAbilityLevel(udg_DamageEventSource, 'A16N') + 1\r\n        set t = timebonus(udg_DamageEventSource, l)\r\n    \tcall UnitAddAbility( udg_DamageEventTarget, 'A16P' )\r\n        set id = GetHandleId( udg_DamageEventTarget )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"mdne\" ) ) == null then\r\n          call SaveTimerHandle( udg_hash, id, StringHash( \"mdne\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"mdne\" ) ) ) \r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"mdne\" ), udg_DamageEventTarget )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"mdne\" ) ), t, false, function MaidenECast )\r\n    endif\r\n    if GetUnitTypeId(udg_DamageEventTarget) == 'e000' and (GetUnitTypeId(udg_DamageEventSource) == 'u000' or IsUnitType( udg_DamageEventSource, UNIT_TYPE_HERO)) then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (3*dmg) \r\n    endif\r\n    //Физ. Урон\r\n    if not( udg_IsDamageSpell ) then\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0OG') > 0 then\r\n            call EntW_Damage(udg_DamageEventTarget, udg_DamageEventSource)\r\n        endif\r\n        if IsUnitInGroup(udg_hero[i], udg_heroinfo) then\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A03X') > 0 then\r\n                if CountLivingPlayerUnitsOfTypeId('n020', GetOwningPlayer(udg_DamageEventSource)) == 0 then\r\n                    set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*(0.1+(0.1*GetUnitAbilityLevel(udg_DamageEventSource, 'A03X'))))\r\n                endif\r\n            endif\r\n            if inv( udg_DamageEventSource, 'I090') > 0 then\r\n                call bufst( udg_DamageEventSource, udg_DamageEventTarget, 'A0DS', 'B090', \"orbf\", 4 )\r\n            endif\r\n            if inv( udg_DamageEventSource, 'I0EP') > 0 then\r\n                call bufst( udg_DamageEventSource, udg_DamageEventTarget, 'A0RJ', 'B096', \"orbe\", 4 )\r\n            endif\r\n            if inv( udg_DamageEventSource, 'I0DF') > 0 then\r\n                call bufst( udg_DamageEventSource, udg_DamageEventTarget, 'A0HX', 'B092', \"orbkl\", 4 )\r\n            endif\r\n            set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*udg_BossDamagePhysical[i])\r\n            /*if inv( udg_DamageEventTarget, 'I0DB') > 0 or ( udg_Set_Weapon_Logic[i + 88] and inv(udg_DamageEventTarget, 'I030') > 0 ) then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount - (0.1*dmg) \r\n            endif*/\r\n            if GetUnitAbilityLevel( udg_DamageEventSource, 'A0TC') > 0 and BlzGetUnitAbilityCooldownRemaining(udg_DamageEventSource, 'A0TC') > 2 then\r\n                call BlzStartUnitAbilityCooldown( udg_DamageEventSource, 'A0TC', BlzGetUnitAbilityCooldownRemaining(udg_DamageEventSource, 'A0TC') - 2 )\r\n            endif\r\n            if GetUnitAbilityLevel( udg_DamageEventSource, 'B06H' ) > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + LoadInteger( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"mtmqd\" ) )\r\n            endif\r\n            if inv(udg_DamageEventSource, 'I0AT') > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + GetHeroInt( udg_DamageEventSource, true)\r\n            endif\r\n            if inv(udg_DamageEventSource, 'I06J') > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*(GetUnitSpellPower(udg_DamageEventSource)-1))\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A0BQ') > 0 and not(IsUnitType( udg_DamageEventTarget, UNIT_TYPE_HERO)) and not(IsUnitType( udg_DamageEventTarget, UNIT_TYPE_ANCIENT)) then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + ( GetUnitState( udg_DamageEventTarget, UNIT_STATE_MAX_LIFE ) * 0.5 )\r\n    \t    endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A152') > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*LoadReal( udg_hash, GetHandleId(udg_DamageEventSource), StringHash( \"trme\" ) ))\r\n                set g = LoadInteger( udg_hash, GetHandleId(udg_DamageEventSource), StringHash( \"trme\" ) ) - 1\r\n                call SaveInteger( udg_hash, GetHandleId(udg_DamageEventSource), StringHash( \"trme\" ), g )\r\n                if g <= 0 then\r\n                    call UnitRemoveAbility( udg_DamageEventSource, 'A152' )\r\n                    call UnitRemoveAbility( udg_DamageEventSource, 'B06X' )\r\n                endif\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'B05R') > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + (3*dmg)\r\n                call UnitRemoveAbility( udg_DamageEventSource, 'A128' )\r\n                call UnitRemoveAbility( udg_DamageEventSource, 'B05R' )\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A0JI') > 0 and udg_hero[i] != null then\r\n                set l = LoadReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"pig\" ) ) + 1\r\n                if l >= 4 then\r\n                    call SaveReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"pig\" ), 0 )\r\n                    set udg_DamageEventAmount = udg_DamageEventAmount + GetHeroAgi( udg_hero[i], true )\r\n                else\r\n                    call SaveReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"pig\" ), l )\r\n                endif\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A0VW') > 0 then\r\n                set udg_DamageEventAmount = ( 1.05 + ( 0.05 * GetUnitAbilityLevel(udg_DamageEventSource, 'A0VW') ) ) * udg_DamageEventAmount\r\n            endif\r\n            if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0DP') > 0 then\r\n                set id = GetHandleId( udg_DamageEventTarget )\r\n                if LoadUnitHandle( udg_hash, id, StringHash( \"ogrqt\" ) ) == udg_DamageEventTarget and LoadUnitHandle( udg_hash, id, StringHash( \"ogrqc\" ) ) == udg_DamageEventSource then\r\n                    set udg_DamageEventAmount = udg_DamageEventAmount + LoadReal( udg_hash, id, StringHash( \"ogrq\" ) )\r\n                    set t = timebonus(udg_DamageEventSource, 3)\r\n                    call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"ogrq\" ) ), t, false, function OgreQEnd )\r\n                endif\r\n            endif \r\n            if GetUnitAbilityLevel( udg_DamageEventSource, 'A0EO') > 0 then\r\n                set id = GetHandleId( udg_DamageEventSource )\r\n                set l = LoadReal( udg_hash, id, StringHash( \"ogrr\" ) ) + LoadReal( udg_hash, id, StringHash( \"ogrrc\" ) )\r\n                call SaveReal( udg_hash, id, StringHash( \"ogrr\" ), l )\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + (l*dmg)\r\n            endif\r\n            if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0E1') > 0 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + ( LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"ogrw\" ) ) * dmg )\r\n            endif\r\n            if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0RK') > 0 then\r\n                set l = LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"nerwd\" ) )\r\n                set udg_DamageEventAmount = udg_DamageEventAmount - (l*dmg)\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A0J8') > 0 and luckylogic( udg_DamageEventSource, 25, 1, 100 ) then\r\n                set udg_DamageEventType = udg_DamageTypeCriticalStrike\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + dmg\r\n            endif\r\n            \r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A09R') > 0 and luckylogic( udg_DamageEventSource, 4+(2*GetUnitAbilityLevel(udg_DamageEventSource, 'A09R')), 1, 100 ) then\r\n                set udg_DamageEventType = udg_DamageTypeCriticalStrike\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + (0.75*dmg)\r\n                call bufallst( udg_DamageEventSource, udg_DamageEventTarget, 'A09T', 'A0AE', 0, 0, 0, 'B08Z', \"armr\", 8 )\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'B023') > 0 then\r\n                call UnitStun(udg_DamageEventSource, udg_DamageEventTarget, 0.3 )\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventSource, 'A0EW') > 0 and luckylogic( udg_DamageEventSource, GetUnitAbilityLevel(udg_DamageEventSource, 'A0EW'), 1, 100 ) then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount + 50 + (50*GetUnitAbilityLevel(udg_DamageEventSource, 'A0EW'))\r\n                call UnitStun(udg_DamageEventSource, udg_DamageEventTarget, 0.25+(0.25*GetUnitAbilityLevel(udg_DamageEventSource, 'A0EW')) )\r\n            endif\r\n            if GetUnitAbilityLevel(udg_DamageEventTarget, 'A09R') > 0 and luckylogic( udg_DamageEventTarget, 4+(2*GetUnitAbilityLevel(udg_DamageEventTarget, 'A09R')), 1, 100 ) then\r\n                call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Items\\\\SpellShieldAmulet\\\\SpellShieldCaster.mdl\", udg_DamageEventTarget, \"origin\" ) )\r\n                set udg_DamageEventAmount = udg_DamageEventAmount - 0.8*dmg\r\n                set udg_DamageEventType = udg_DamageTypeBlocked\r\n            endif\r\n        endif\r\n\t    if GetUnitAbilityLevel( udg_DamageEventTarget, 'A09B' ) > 0 then\r\n            set l = dmg*0.05*GetUnitAbilityLevel( udg_DamageEventTarget, 'A09B' )\r\n            if l > 1 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount - l\r\n                set id = GetHandleId( udg_DamageEventSource )\r\n                if LoadTimerHandle( udg_hash, id, StringHash( \"mmcr\" ) ) == null then\r\n                    call SaveTimerHandle( udg_hash, id, StringHash( \"mmcr\" ), CreateTimer() )\r\n                endif\r\n                set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"mmcr\" ) ) ) \r\n                call SaveReal( udg_hash, id, StringHash( \"mmcr\" ), l )\r\n                call SaveUnitHandle( udg_hash, id, StringHash( \"mmcr\" ), udg_DamageEventSource )\r\n                call SaveUnitHandle( udg_hash, id, StringHash( \"mmcrc\" ), udg_DamageEventTarget )\r\n                call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"mmcr\" ) ), 0.01, false, function MimicRCast )\r\n            endif\r\n\t    endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B097' ) > 0 then\r\n            set l = dmg*0.15\r\n            if l > 1 then\r\n                set udg_DamageEventAmount = udg_DamageEventAmount - l\r\n                set id = GetHandleId( udg_DamageEventSource )\r\n                if LoadTimerHandle( udg_hash, id, StringHash( \"crnn\" ) ) == null then\r\n                    call SaveTimerHandle( udg_hash, id, StringHash( \"crnn\" ), CreateTimer() )\r\n                endif\r\n                set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"crnn\" ) ) ) \r\n                call SaveReal( udg_hash, id, StringHash( \"crnn\" ), l )\r\n                call SaveUnitHandle( udg_hash, id, StringHash( \"crnn\" ), udg_DamageEventSource )\r\n                call SaveUnitHandle( udg_hash, id, StringHash( \"crnnc\" ), udg_DamageEventTarget )\r\n                call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"crnn\" ) ), 0.01, false, function CairneCast )\r\n            endif\r\n\t    endif\r\n        if IsUnitInGroup(udg_hero[k], udg_heroinfo) then\r\n            if ( GetUnitAbilityLevel( udg_DamageEventSource, 'B01N') > 0 ) and luckylogic( LoadUnitHandle( udg_hash, GetHandleId( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"mnkq1\" ) ) ), StringHash( \"mnkq1c\" ) ), LoadInteger( udg_hash, GetHandleId( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"mnkq1\" ) ) ), StringHash( \"mnkq1\" ) ), 1, 100 ) then\r\n                set udg_DamageEventAmount = 0\r\n                set udg_DamageEventType = udg_DamageTypeBlocked\r\n            elseif GetUnitTypeId(udg_DamageEventSource) == 'n02U' and GetRandomInt(1, 4) == 1 then\r\n                set udg_DamageEventAmount = 0\r\n                set udg_DamageEventType = udg_DamageTypeBlocked\r\n    \t    elseif GetUnitAbilityLevel(udg_DamageEventSource, 'B07U') > 0 and GetRandomInt( 1, 5 ) == 1 then\r\n                set udg_DamageEventAmount = 0\r\n                set udg_DamageEventType = udg_DamageTypeBlocked\r\n            endif\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'B024' ) > 0  then\r\n            call healst( udg_DamageEventSource, null, udg_DamageEventAmount*LoadReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"mrlqv\" ) ) )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_DamageEventSource, \"origin\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'B049' ) > 0  then\r\n            call healst( udg_DamageEventSource, null, udg_DamageEventAmount * 0.15 * GetUnitAbilityLevel( udg_DamageEventSource, 'A0ZN' ) )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_DamageEventSource, \"origin\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'B08O' ) > 0  then\r\n            call healst( udg_DamageEventSource, null, udg_DamageEventAmount * 0.2 )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_DamageEventSource, \"origin\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'A0JJ' ) > 0  then\r\n            call healst( udg_DamageEventSource, null, udg_DamageEventAmount * 0.1 * udg_SpellDamageSpec[i] )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_DamageEventSource, \"origin\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'A0JK' ) > 0 then\r\n            call healst( udg_DamageEventSource, null, udg_DamageEventAmount * 0.2 * udg_SpellDamageSpec[i] )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_DamageEventSource, \"origin\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventSource, 'B030' ) > 0 then\r\n             call manast( udg_DamageEventSource, null, udg_DamageEventAmount * LoadReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"snpw1m\" ) ) )\r\n        endif\r\n    //Маг. Урон\r\n    else\r\n        set udg_DamageEventAmount = udg_DamageEventAmount + (dmg*udg_BossDamageMagical[i])\r\n        if GetUnitAbilityLevel(udg_DamageEventTarget, 'B08I') > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount + (LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"flne1m\" ) )*dmg)\r\n        endif\r\n        if GetUnitTypeId( udg_DamageEventTarget ) == 'n009' then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.2*dmg)\r\n        endif\r\n        if GetUnitTypeId(udg_DamageEventTarget) == 'h011' or GetUnitTypeId(udg_DamageEventTarget) == 'h00O' then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.4*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0D9' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.5*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A05K' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.3*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A05O' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.3*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A14V' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.5*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0T8') >= 5 or (GetUnitAbilityLevel( udg_hero[k], 'A0T8') >= 5 and GetUnitTypeId(udg_DamageEventTarget) == 'u00X') then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (dmg* 0.2)\t\r\n        endif\r\n        if GetUnitTypeId(udg_DamageEventTarget) == 'n041' then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * 0.6\r\n        endif\r\n        if GetUnitAbilityLevel( udg_hero[i], 'A0V4' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount + ((0.04+(0.04*GetUnitAbilityLevel( udg_hero[i], 'A0V4' )))*dmg)\r\n        endif\r\n        if inv( udg_DamageEventTarget, 'I08C' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - (0.33*dmg)\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B04S') > 0 then\r\n            set udg_DamageEventAmount = 1.5 * udg_DamageEventAmount\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B01V' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"bknw\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B05E' ) > 0  then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * 0.5   \r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B05W' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"advrd\" ) )\r\n            call manast( udg_DamageEventTarget, null, LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"advrm\" ) ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B06O' ) > 0 then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"shmrd\" ) )\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B04H' ) > 0 then\r\n            set udg_DamageEventAmount = 0\r\n        endif\r\n        if GetUnitAbilityLevel( udg_DamageEventTarget, 'B07F' ) > 0 then\r\n            set udg_DamageEventAmount = 0\r\n        endif\r\n    endif\r\n\r\n    if ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) and GetUnitAbilityLevel( udg_hero[i], 'B08J') > 0 then\r\n        set udg_DamageHealLoop = true\r\n        call healst( udg_hero[i], null, udg_DamageEventAmount * 0.15 )\r\n        call DestroyEffect(AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Undead\\\\VampiricAura\\\\VampiricAuraTarget.mdl\", udg_hero[i], \"origin\" ))\r\n    endif\r\n    \r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'B05U') > 0 then\r\n        set udg_DamageEventAmount = udg_DamageEventAmount * LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"advwd\" ) )\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A0GX') > 0 and LoadBoolean( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"drdw\" ) ) then\r\n        set l = LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"drdw\" ) )*dmg\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - l\r\n        call healst( udg_DamageEventTarget, null, l )\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventSource, 'A0GX') > 0 and not(LoadBoolean( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"drdw\" ) ) ) then\r\n        set l = LoadReal( udg_hash, GetHandleId( udg_DamageEventSource ), StringHash( \"drdw\" ) )*dmg\r\n        set udg_DamageEventAmount = udg_DamageEventAmount - l\r\n        call SetUnitState( udg_DamageEventSource, UNIT_STATE_LIFE, RMaxBJ(0,GetUnitState( udg_DamageEventSource, UNIT_STATE_LIFE) - l ))\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B012') > 0 then\r\n        call Channel_Energy(udg_DamageEventTarget, udg_DamageEventAmount)\r\n    endif\r\n    /////////\r\n\tif udg_DamageEventAmount < (0.2*dmg) and udg_DamageEventType != udg_DamageTypeBlocked then\r\n\t\tset udg_DamageEventAmount = (0.2*dmg)\r\n\tendif\r\n    /////////\r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'A0NG') > 0 and udg_DamageEventAmount >= 1 then\r\n\tset l = LoadReal( udg_hash, GetHandleId( udg_hero[k] ), StringHash( \"bksb\" ) ) + 1\r\n        if l >= 11 - GetUnitAbilityLevel( udg_DamageEventTarget, 'A0NG') then\r\n            set udg_DamageEventAmount = 0\r\n            call DestroyEffect( AddSpecialEffectTarget(\"Abilities\\\\Spells\\\\Items\\\\SpellShieldAmulet\\\\SpellShieldCaster.mdl\", udg_hero[k], \"origin\" ) )\r\n            call SaveReal( udg_hash, GetHandleId( udg_hero[k] ), StringHash( \"bksb\" ), 0 )\r\n        else\r\n            call SaveReal( udg_hash, GetHandleId( udg_hero[k] ), StringHash( \"bksb\" ), l )\r\n        endif\r\n    endif\r\n    if inv( udg_DamageEventSource, 'I0F4' ) > 0 and udg_DamageEventAmount >= 1 and IsUnitAlly(udg_DamageEventTarget, GetOwningPlayer(udg_DamageEventSource)) and udg_combatlogic[i] then\r\n        call healst( udg_DamageEventSource, udg_DamageEventTarget, udg_DamageEventAmount )\r\n        call healst( udg_DamageEventSource, null, udg_DamageEventAmount )\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventSource, 'A16N') > 0 and IsUnitAlly( udg_DamageEventSource, GetOwningPlayer( udg_DamageEventTarget ) ) then\r\n        call healst( udg_DamageEventSource, udg_DamageEventTarget, udg_DamageEventAmount*(0.7+(0.1*GetUnitAbilityLevel(udg_DamageEventSource, 'A16N'))) )\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B07S') > 0 then\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'A0SV') > 0 then\r\n        call UnitRemoveAbility( udg_DamageEventTarget, 'A0SV' )\r\n        call UnitRemoveAbility( udg_DamageEventTarget, 'B07Z' )\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B08E') > 0 and udg_DamageEventAmount > 0 then\r\n        call UnitRemoveAbility( udg_DamageEventTarget, 'A01I' )\r\n        call UnitRemoveAbility( udg_DamageEventTarget, 'B08E' )\r\n        if combat( udg_DamageEventTarget, false, 0 ) and not(udg_fightmod[3]) then\r\n        \tset udg_Data[k + 244] = udg_Data[k + 244] + R2I(udg_DamageEventAmount)\r\n    \tendif\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    \r\n    if GetUnitAbilityLevel(udg_DamageEventTarget, 'B08M') > 0 then\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    if udg_DamageEventAmount < 30 and inv(udg_hero[i], 'I0DQ') > 0 and ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) then\r\n        set udg_DamageEventAmount = 30\r\n    endif\r\n    if udg_DamageEventAmount >= 100000 then\r\n        set udg_DamageEventAmount = 100000\r\n    endif\r\n    if GetUnitTypeId(udg_DamageEventTarget) == 'n04O' then\r\n        set u = LoadUnitHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"bsdl\" ) )\r\n        if u != null and not(u == udg_DamageEventSource or (GetUnitTypeId(udg_DamageEventSource) == 'u000' and GetOwningPlayer(udg_DamageEventSource) == GetOwningPlayer(u) )) then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount * 0.2\r\n        endif\r\n    endif\r\n    /////////\r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'A1A5') > 0 and udg_DamageEventAmount > 0 then\r\n        call InfernalE( udg_DamageEventTarget, udg_DamageEventAmount )\r\n    endif\r\n    if udg_combatlogic[i] and not(udg_fightmod[3]) and inv(udg_hero[i], 'I0AN') > 0 and udg_DamageEventAmount > 0 and ( GetUnitTypeId(udg_DamageEventSource) == 'u000' or udg_DamageEventSource == udg_hero[i] ) then\r\n        set udg_OrbManaburn[i] = udg_OrbManaburn[i] + (udg_DamageEventAmount*GetRandomReal(0.1,0.3))\r\n        if udg_OrbManaburn[i] > 2000 then\r\n            set udg_OrbManaburn[i] = 2000\r\n        endif\r\n        set udg_TimedItem = GetItemOfTypeFromUnitBJ(udg_hero[i], 'I0AN')\r\n        call BlzSetItemExtendedTooltip( udg_TimedItem, words( udg_hero[i], BlzGetItemDescription(udg_TimedItem), \"|cFF959697(\", \")|r\", I2S( R2I(udg_OrbManaburn[i]) ) + \"/2000\" ) ) // sadtwig\r\n        //call BlzSetItemIconPath( udg_TimedItem, words( udg_hero[i], BlzGetItemDescription(udg_TimedItem), \"|cFF959697(\", \")|r\", I2S( R2I(udg_OrbManaburn[i]) ) + \"/2000\" ) )\r\n    endif\r\n    if GetUnitAbilityLevel(udg_DamageEventSource, 'B02O') > 0 and not( udg_IsDamageSpell ) then\r\n        call CommandoWAt( udg_DamageEventSource, 0.2*udg_DamageEventAmount, GetUnitAbilityLevel(udg_DamageEventSource, 'A19F') )\r\n        set udg_DamageEventAmount = 0\r\n    endif\r\n    /////////\r\n    if udg_DamageEventAmount > 0 and IsUnitType( udg_DamageEventTarget, UNIT_TYPE_HERO) and not( udg_fightmod[3] ) then\r\n        if udg_DamageEventAmount > 0 then\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 4\r\n                if inv( udg_hero[cyclA], 'I09Q' ) > 0 and GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 and inv( udg_DamageEventTarget, 'I09Q' ) == 0 and IsUnitAlly(udg_DamageEventTarget, GetOwningPlayer(udg_hero[cyclA])) and udg_DamageEventTarget != udg_hero[cyclA] then\r\n                    call SetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE, RMaxBJ(0, GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE ) - udg_DamageEventAmount ) ) \r\n                    set udg_DamageEventAmount = 0\r\n                    set cyclA = 4\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n    endif\r\n    if GetUnitAbilityLevel( udg_DamageEventTarget, 'B05P') > 0 then\r\n        set sh = LoadReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"shield\" ) )\r\n        if udg_DamageEventAmount >= sh then\r\n            set udg_DamageEventAmount = udg_DamageEventAmount - sh\r\n            set sh = 0\r\n        else\r\n            set sh = sh - udg_DamageEventAmount\r\n            set udg_DamageEventAmount = 0\r\n        endif\r\n        call SaveReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"shield\" ), sh )\r\n        if sh <= 0 then\r\n            call UnitRemoveAbility( udg_DamageEventTarget, 'A11F' )\r\n            call UnitRemoveAbility( udg_DamageEventTarget, 'B05P' )\r\n            call SaveInteger( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"shieldnum\" ), 0 )\r\n            call SaveReal( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"shieldMax\" ), 0 )\r\n        endif\r\n    endif\r\n    \r\n    if (IsUnitEnemy(udg_DamageEventSource, GetOwningPlayer(udg_DamageEventTarget)) or GetOwningPlayer(udg_DamageEventTarget) == GetOwningPlayer(udg_DamageEventSource) ) and not( udg_fightmod[3] ) and not( IsVictory ) and udg_DamageEventAmount > 0 then\r\n        if udg_DamageEventAmount >= GetUnitState( udg_DamageEventTarget, UNIT_STATE_LIFE ) then\r\n            set l = GetUnitState( udg_DamageEventTarget, UNIT_STATE_LIFE )\r\n        else\r\n            set l = udg_DamageEventAmount\r\n        endif\r\n        if IsUnitType( udg_DamageEventTarget, UNIT_TYPE_HERO) and udg_combatlogic[k] then\r\n            set udg_DamagedAllTime[k] = udg_DamagedAllTime[k] + l\r\n            set udg_DamagedFight[k] = udg_DamagedFight[k] + l\r\n            call MultiSetValue( udg_multi, ( ( udg_Multiboard_Position[k] * 3 ) - 1 ), 13, I2S( R2I( udg_DamagedAllTime[k] ) ) )\r\n            call MultiSetValue( udg_multi, ( ( udg_Multiboard_Position[k] * 3 ) - 1 ), 14, I2S( R2I( udg_DamagedFight[k] ) ) )\r\n        endif\r\n        if IsUnitInGroup(udg_hero[i], udg_heroinfo) and udg_combatlogic[i] then\r\n            set udg_DamageAllTime[i] = udg_DamageAllTime[i] + l\r\n            set udg_DamageFight[i] = udg_DamageFight[i] + l\r\n            call MultiSetValue( udg_multi, ( ( udg_Multiboard_Position[i] * 3 ) - 1 ), 6, I2S( R2I( udg_DamageAllTime[i] ) ) )\r\n            call MultiSetValue( udg_multi, ( ( udg_Multiboard_Position[i] * 3 ) - 1 ), 7, I2S( R2I( udg_DamageFight[i] ) ) )\r\n            if udg_IsDamageSpell then\r\n                set udg_Info_DamageMagic[i] = udg_Info_DamageMagic[i] + l\r\n            else\r\n                set udg_Info_DamagePhysical[i] = udg_Info_DamagePhysical[i] + l\r\n            endif\r\n        endif\r\n    endif\r\n\r\n\tset u = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_Set_Damage takes nothing returns nothing\r\n    set gg_trg_Set_Damage = CreateTrigger(  )\r\n    call TriggerRegisterVariableEvent( gg_trg_Set_Damage, \"udg_DamageModifierEvent\", EQUAL, 1.00 )\r\n    call TriggerAddAction( gg_trg_Set_Damage, function Trig_Set_Damage_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}