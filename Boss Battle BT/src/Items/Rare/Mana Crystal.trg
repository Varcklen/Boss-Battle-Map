{
  "Id": 50332621,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope ManaCrystal initializer init\r\n\r\n    globals\r\n        private constant integer ID_ABILITY = 'A14B'\r\n        \r\n        private constant integer DAMAGE = 100\r\n        \r\n        private constant string ANIMATION_CASTER = \"Abilities\\\\Spells\\\\Human\\\\Slow\\\\SlowCaster.mdl\"\r\n        private constant string ANIMATION_TARGET = \"Abilities\\\\Spells\\\\Human\\\\Invisibility\\\\InvisibilityTarget.mdl\"\r\n        \r\n        private boolean isManaCrystal = false\r\n    endglobals\r\n\r\n    function Trig_Mana_Crystal_Conditions takes nothing returns boolean\r\n        return GetSpellAbilityId() == ID_ABILITY\r\n    endfunction\r\n\r\n    function Trig_Mana_Crystal_Actions takes nothing returns nothing\r\n        local integer i = 1\r\n        local integer iEnd\r\n        local unit caster\r\n        local unit target\r\n        \r\n        if CastLogic() then\r\n            set caster = udg_Caster\r\n            set target = udg_Target\r\n        elseif RandomLogic() then\r\n            set caster = udg_Caster\r\n            set target = randomtarget( caster, 900, TARGET_ENEMY, \"\", \"\", \"\", \"\" )\r\n            call textst( udg_string[0] + GetObjectName(ID_ABILITY), caster, 64, 90, 10, 1.5 )\r\n            if target == null then\r\n                set caster = null\r\n                return\r\n            endif\r\n        else\r\n            set caster = GetSpellAbilityUnit()\r\n            set target = GetSpellTargetUnit()\r\n        endif\r\n        \r\n        call PlaySpecialEffect(ANIMATION_CASTER, caster )\r\n        call PlaySpecialEffect(ANIMATION_TARGET, target )\r\n        \r\n        set isManaCrystal = true\r\n        set iEnd = eyest( caster )\r\n        loop\r\n            exitwhen i > iEnd\r\n            call UnitTakeDamage(caster, target, DAMAGE, DAMAGE_TYPE_MAGIC)\r\n            set i = i + 1\r\n        endloop\r\n        set isManaCrystal = false\r\n        \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n    \r\n    private function AfterDamageEvent_Conditions takes nothing returns boolean\r\n        return isManaCrystal\r\n    endfunction\r\n    \r\n    private function AfterDamageEvent takes nothing returns nothing\r\n        call manast( udg_DamageEventSource, null, udg_DamageEventAmount )\r\n    endfunction\r\n    \r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_Mana_Crystal = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_Mana_Crystal, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n        call TriggerAddCondition( gg_trg_Mana_Crystal, Condition( function Trig_Mana_Crystal_Conditions ) )\r\n        call TriggerAddAction( gg_trg_Mana_Crystal, function Trig_Mana_Crystal_Actions )\r\n        \r\n        call CreateEventTrigger( \"udg_AfterDamageEvent\", function AfterDamageEvent, function AfterDamageEvent_Conditions )\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}