{
  "Id": 50332722,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope PhoenixEgg initializer init\r\n\r\n\tprivate function condition takes nothing returns boolean\r\n\t    return DeathSystem_IsUnkillable(GetDyingUnit()) == false and inv(GetDyingUnit(), 'I05U') > 0 and GetUnitAbilityLevel( GetDyingUnit(), 'B047' ) == 0 and not(LoadBoolean( udg_hash, GetHandleId( GetDyingUnit() ), StringHash( \"pheg\" ) ) ) and combat( GetDyingUnit(), false, 0 ) and not( IsUnitInGroup(GetDyingUnit(), udg_Return) ) and udg_Heroes_Ressurect_Battle <= 0 and GetPlayerSlotState(GetOwningPlayer(GetDyingUnit())) == PLAYER_SLOT_STATE_PLAYING\r\n\tendfunction\r\n\t\r\n\tprivate function action takes nothing returns nothing\r\n\t\tlocal unit caster = GetDyingUnit()\r\n\t\t\r\n\t    set bj_lastCreatedUnit = CreateUnit( Player(PLAYER_NEUTRAL_AGGRESSIVE), 'h012', GetUnitX( caster ), GetUnitY( caster ), 270 )\r\n\t    call spectime(\"Abilities\\\\Spells\\\\Other\\\\BreathOfFire\\\\BreathOfFireMissile.mdl\", GetUnitX( caster ), GetUnitY( caster ), 1 )\r\n\t    call SaveUnitHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"fnx\" ), caster )\r\n\t    \r\n\t    set caster = null\r\n\tendfunction\r\n\t\r\n\t\r\n\t//-----------------------------\r\n\tprivate function egg_death_condition takes nothing returns boolean\r\n\t    return GetUnitTypeId(GetDyingUnit()) == 'h012'\r\n\tendfunction\r\n\t\r\n\tprivate function egg_death takes nothing returns nothing\r\n\t\tlocal unit egg = GetDyingUnit()\r\n\t\tlocal integer id = GetHandleId( egg )\r\n\t\tlocal unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"fnx\" ) )\r\n\t    \r\n\t    if IsUnitDead(caster) then\r\n\t        call SaveBoolean( udg_hash, GetHandleId( caster ), StringHash( \"pheg\" ), true )\r\n\t        call ReviveHero( caster, GetUnitX(egg), GetUnitY(egg), true )\r\n\t        call SetUnitState( caster, UNIT_STATE_MANA, GetUnitState(caster, UNIT_STATE_MAX_MANA) )\r\n\t    endif\r\n\r\n        set caster = null\r\n        set egg = null\r\n\tendfunction\r\n\t\r\n\t//-----------------------------\r\n\tprivate function ToRemove takes nothing returns nothing\r\n\t\tcall spectime(\"Abilities\\\\Spells\\\\Other\\\\BreathOfFire\\\\BreathOfFireMissile.mdl\", GetUnitX( GetEnumUnit() ), GetUnitY( GetEnumUnit() ), 1 )\r\n\t    call RemoveUnit( GetEnumUnit() )\r\n\tendfunction\r\n\t\r\n\tprivate function remove_eggs takes nothing returns nothing\r\n\t\tcall ForGroupBJ( GetUnitsOfTypeIdAll('h012'), function ToRemove )\r\n\tendfunction\r\n\t\r\n\t//===========================================================================\r\n\tprivate function init takes nothing returns nothing\r\n\t\tset gg_trg_PhoenixEgg = CreateNativeEvent( EVENT_PLAYER_UNIT_DEATH, function action, function condition )\r\n\t\t\r\n\t\tcall CreateNativeEvent( EVENT_PLAYER_UNIT_DEATH, function egg_death, function egg_death_condition )\r\n\t\t\r\n\t\tcall BetweenBattles.AddListener(function remove_eggs, null)\r\n\tendfunction\r\n\t\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}