{
  "Id": 50332863,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library MoonSetLib initializer init requires UnitstLib, SpellPower\r\n\r\n    globals\r\n        real Event_UntilMoonSetCast_Real\r\n        unit Event_UntilMoonSetCast_Hero\r\n        real Event_UntilMoonSetCast_Damage\r\n        real Event_UntilMoonSetCast_Static_Damage\r\n        \r\n        private trigger Wave_Use = null\r\n        \r\n        private constant integer CHANCE = 5\r\n        private constant real TICK = 0.04\r\n        private constant integer FLIGHT_LENGTH = 20\r\n        private constant integer AREA = 100\r\n        private constant integer SPEED = 44\r\n        \r\n        private constant string WAVE_ANIMATION = \"Abilities\\\\Spells\\\\Undead\\\\OrbOfDeath\\\\AnnihilationMissile.mdl\"\r\n    endglobals\r\n\r\n\t/*private function DealDamage takes unit caster, real dmg, real x, real y, group nodmg returns nothing\r\n\t\tlocal group g = CreateGroup()\r\n        local unit u\r\n\t\r\n\t\tcall GroupEnumUnitsInRange( g, x, y, 100, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if unitst( u, caster, \"enemy\" ) and not( IsUnitInGroup( u, nodmg ) ) then\r\n                call UnitDamageTarget( caster, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS )\r\n                call GroupAddUnit( nodmg, u )\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n        \r\n        call DestroyGroup( g )\r\n        set u = null\r\n        set g = null\r\n\tendfunction\r\n\r\n    private function MoonACast takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local integer counter = LoadInteger( udg_hash, id, StringHash( \"moon\" ) ) + 1\r\n        local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"moon\" ) )\r\n        local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"mooncs\" ) )\r\n        local real NewX = GetUnitX( dummy ) + 44 * Cos( 0.017 * GetUnitFacing( dummy ) )\r\n        local real NewY = GetUnitY( dummy ) + 44 * Sin( 0.017 * GetUnitFacing( dummy ) )\r\n        local real dmg = LoadReal( udg_hash, id, StringHash( \"moon\" ) )\r\n        local group nodmg = LoadGroupHandle( udg_hash, id, StringHash( \"moong\" ) )\r\n        \r\n        if counter >= 20 or GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Undead\\\\OrbOfDeath\\\\AnnihilationMissile.mdl\", GetUnitX( dummy ), GetUnitY( dummy ) ) )\r\n            call RemoveUnit( dummy )\r\n            call DestroyGroup( nodmg )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n            call SetUnitPosition( dummy, NewX, NewY )\r\n            call SaveInteger( udg_hash, id, StringHash( \"moon\" ), counter )\r\n            call DealDamage(caster, dmg, GetUnitX( dummy ), GetUnitY( dummy ), nodmg )\r\n        endif\r\n        \r\n        set dummy = null\r\n        set caster = null\r\n    endfunction*/\r\n    \r\n    private function Use takes nothing returns nothing\r\n        local unit caster = Event_WaveHit_Caster\r\n        local unit target = Event_WaveHit_Target\r\n        local real damage = LoadReal( udg_hash, GetHandleId(Event_WaveHit_Wave), StringHash( \"moon_set\" ) )\r\n        \r\n        call UnitTakeDamage(caster, target, damage, DAMAGE_TYPE_MAGIC)\r\n                \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n    \r\n\tprivate function CastWaves takes unit caster, real damage returns nothing\r\n\t\tlocal integer i = 1\r\n        local integer id\r\n        local real x = GetUnitX(caster)\r\n        local real y = GetUnitY(caster)\r\n        local effect particle\r\n        local group affected = CreateGroup()\r\n        \r\n\t\r\n\t\tset i = 1\r\n        loop\r\n            exitwhen i > 8\r\n            set particle = Wave_Create( caster, x, y, 45 * i, TICK, AREA, FLIGHT_LENGTH, SPEED, TARGET_ENEMY, WAVE_ANIMATION, Wave_Use, affected )\r\n            call SaveReal( udg_hash, GetHandleId(particle), StringHash( \"moon_set\" ), damage )\r\n            /*set bj_lastCreatedUnit = CreateUnit( GetOwningPlayer( caster ), 'u000', GetUnitX( caster ), GetUnitY( caster ), 45 * cyclA )\r\n            call UnitAddAbility( bj_lastCreatedUnit, 'A01Z')\r\n            call UnitAddAbility( bj_lastCreatedUnit, 'A0N5')\r\n            \r\n            call SaveTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"moon\" ), CreateTimer() )\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"moon\" ) ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"moon\" ), bj_lastCreatedUnit )\r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"mooncs\" ), caster )\r\n            call SaveReal( udg_hash, id, StringHash( \"moon\" ), r )\r\n            call SaveGroupHandle( udg_hash, id, StringHash( \"moong\" ), CreateGroup() )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"moon\" ) ), 0.04, true, function MoonACast )*/\r\n            set i = i + 1\r\n        endloop\r\n        \r\n        set affected = null\r\n        set particle = null\r\n\tendfunction\r\n\r\n\tprivate function Figurine takes unit caster returns nothing\r\n\t\tlocal group g = CreateGroup()\r\n        local unit u\r\n\t\r\n\t\tset bj_livingPlayerUnitsTypeId = 'o01F'\r\n        call GroupEnumUnitsOfPlayer(g, GetOwningPlayer( caster ), filterLivingPlayerUnitsOfTypeId)\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            call MoonTrigger.evaluate(u)\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n        \r\n        call DestroyGroup( g )\r\n        set u = null\r\n        set g = null\r\n\tendfunction\r\n\r\n    function MoonTrigger takes unit caster returns nothing\r\n        //local unit hero = udg_hero[GetPlayerId(GetOwningPlayer( caster ) ) + 1]\r\n        //local integer index = CorrectPlayer(caster)\r\n        local real damage\r\n\r\n        set damage = 50 + ( GetUnitState(caster, UNIT_STATE_MANA) / 15)\r\n\r\n        set Event_UntilMoonSetCast_Hero = caster\r\n        set Event_UntilMoonSetCast_Damage = damage\r\n        set Event_UntilMoonSetCast_Static_Damage = damage\r\n        \r\n        set Event_UntilMoonSetCast_Real = 0.00\r\n        set Event_UntilMoonSetCast_Real = 1.00\r\n        set Event_UntilMoonSetCast_Real = 0.00\r\n        \r\n        set damage = Event_UntilMoonSetCast_Damage\r\n        \r\n        //set r = r + ( nr * ( GetUnitSpellPower(caster) - 1 ) )\r\n        \r\n        call CastWaves(caster, damage)\r\n\r\n        if GetUnitTypeId(caster) != 'o01F' then\r\n            call Figurine(caster)\r\n        endif\r\n    endfunction\r\n    \r\n    private function init takes nothing returns nothing\r\n    \tset Wave_Use = CreateTrigger()\r\n        call TriggerAddAction( Wave_Use, function Use )\r\n    endfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}