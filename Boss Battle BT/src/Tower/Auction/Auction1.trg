{
  "Id": 50332246,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope Auction01 initializer init\r\n\r\n    globals\r\n        integer array PutInExcanger[6]\r\n        \r\n        integer ExchangeCost = 125\r\n    endglobals\r\n\r\n    function Trig_Auction1_Conditions takes nothing returns boolean\r\n        local integer cyclA = 0\r\n        local boolean l = false\r\n        \r\n        loop\r\n            exitwhen cyclA > 5 or l\r\n            if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[cyclA] then\r\n                set l = true\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        return l\r\n    endfunction\r\n\r\n    function Auction3Logic takes nothing returns boolean\r\n        local integer cyclA = 0\r\n        local boolean l = false\r\n\r\n        loop\r\n            exitwhen cyclA > 5 or l\r\n            if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[cyclA] and GetItemType(UnitItemInSlot(GetManipulatingUnit(), cyclA)) == ITEM_TYPE_PURCHASABLE then\r\n                set l = true\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        return l\r\n    endfunction\r\n\r\n    function Auction2Logic takes nothing returns boolean\r\n        local integer cyclA = 0\r\n        local boolean l = false\r\n        \r\n        loop\r\n            exitwhen cyclA > 5 or l\r\n            if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[cyclA] and ( GetItemTypeId(UnitItemInSlot(GetManipulatingUnit(), cyclA)) == 'I05J' or GetItemTypeId(UnitItemInSlot(GetManipulatingUnit(), cyclA)) == 'I030' ) then\r\n                set l = true\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        return l\r\n    endfunction\r\n\r\n    function Auction1Logic takes nothing returns boolean\r\n        local integer cyclA = 0\r\n        local boolean l = false\r\n        \r\n        loop\r\n            exitwhen cyclA > 5 or l\r\n            if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[cyclA] and GetItemType(UnitItemInSlot(GetManipulatingUnit(), cyclA)) == ITEM_TYPE_POWERUP then\r\n                set l = true\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        return l\r\n    endfunction\r\n\r\n    function Trig_Auction1_Actions takes nothing returns nothing\r\n        local unit hero = GetManipulatingUnit()\r\n        local integer cyclA = 0\r\n        local item it = null\r\n        local boolean l = true\r\n        local player owner = GetOwningPlayer(hero)\r\n        local integer i = GetPlayerId(owner) + 1\r\n        local integer j = 0\r\n\r\n        set udg_auctionlogic[i] = false\r\n        if GetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD) >= ExchangeCost then\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 4\r\n                if GetOwningPlayer( udg_artifzone[cyclA] ) == GetOwningPlayer( hero ) and udg_auctionlogic[cyclA] then\r\n                    set udg_auctionlogic[cyclA] = false\r\n                    call SetPlayerState( Player(cyclA - 1), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Player(cyclA - 1), PLAYER_STATE_RESOURCE_GOLD) + ExchangeCost)\r\n                    call SetUnitOwner( udg_artifzone[cyclA], Player(PLAYER_NEUTRAL_PASSIVE), true )\r\n                    call DisplayTimedTextToPlayer( Player(cyclA - 1), 0, 0, 5., \"|cffffcc00Exchanger:|r color reset. Another player posted an artifact from the exchanger.\" )\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n            if ItemRandomizerLib_IsRewardExist(owner) == false then\r\n                if Auction1Logic() then\r\n                    call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"Only artifacts can be exchanged.\")\r\n                    set l = false\r\n                elseif Auction2Logic() then\r\n                    call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"This artifact cannot be put into the exchanger.\")\r\n                    set l = false\r\n                elseif Auction3Logic() then\r\n                    call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"|cffffcc00Quests|r cannot be exchanged.\")\r\n                    set l = false\r\n                elseif udg_auctionartif[i] != null then\r\n                    set it = udg_auctionartif[i]\r\n                    call SetItemPosition( it, GetUnitX(udg_hero[i]), GetUnitY(udg_hero[i]))\r\n                    set udg_auctionartif[i] = null\r\n                endif\r\n                if l then\r\n                    set cyclA = 0\r\n                    loop\r\n                        exitwhen cyclA > 5\r\n                        if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[cyclA] and UnitHasItem(hero, UnitItemInSlot(hero, cyclA)) then\r\n                            set udg_auctionartif[i] = UnitItemInSlot(GetManipulatingUnit(), cyclA)\r\n                            call SetItemPosition(UnitItemInSlot(udg_hero[i], cyclA), GetLocationX(udg_point[i]), GetLocationY(udg_point[i]))\r\n                        endif\r\n                        set cyclA = cyclA + 1\r\n                    endloop\r\n                    if not( IsItemOwned( it ) ) and it != null then\r\n                        call UnitAddItem( udg_hero[i], it )\r\n                    endif\r\n                endif\r\n            else\r\n                set j = ( GetPlayerId(owner) * 3 ) + 2\r\n                call PanCameraToTimedLocForPlayer(owner, udg_itemcentr[j], 0.5 )\r\n                call DisplayTimedTextToPlayer( owner, 0, 0, 5., \"Select an artifact in the preparatory room before starting the exchange.\" )\r\n                call PingMinimapLocForForceEx( GetForceOfPlayer(owner), udg_itemcentr[j], 10., bj_MINIMAPPINGSTYLE_FLASHY, 100, 0, 0 )\r\n            endif\r\n        else\r\n            call DisplayTimedTextToPlayer(owner, 0, 0, 5., \"Not enough gold.\")\r\n        endif\r\n        \r\n        set hero = null\r\n        set owner = null\r\n        set it = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_Auction1 = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_Auction1, EVENT_PLAYER_UNIT_PICKUP_ITEM ) \r\n        call TriggerAddCondition( gg_trg_Auction1, Condition( function Trig_Auction1_Conditions ) )\r\n        call TriggerAddAction( gg_trg_Auction1, function Trig_Auction1_Actions )\r\n        \r\n        set PutInExcanger[0] = 'I0GX'\r\n        set PutInExcanger[1] = 'I0GW'\r\n        set PutInExcanger[2] = 'I0GV'\r\n        set PutInExcanger[3] = 'I0GU'\r\n        set PutInExcanger[4] = 'I0GT'\r\n        set PutInExcanger[5] = 'I0GS'\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}