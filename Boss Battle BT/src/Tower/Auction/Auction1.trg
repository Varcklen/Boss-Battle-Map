{
  "Id": 50332246,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope Auction01 initializer init\r\n\r\n    globals\r\n        integer array PutInExcanger[6]\r\n        \r\n        integer ExchangeCost = 125\r\n    endglobals\r\n\r\n    function Trig_Auction1_Conditions takes nothing returns boolean\r\n        local integer i = 0\r\n        \r\n        loop\r\n            exitwhen i > 5\r\n            if GetItemTypeId(GetManipulatedItem()) == PutInExcanger[i] then\r\n                return true\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        return false\r\n    endfunction\r\n    \r\n    function GetSlotUsed takes nothing returns integer\r\n        local integer i = 0\r\n        local integer itemId = GetItemTypeId(GetManipulatedItem())\r\n        \r\n        loop\r\n            exitwhen i > 5\r\n            if itemId == PutInExcanger[i] then\r\n                return i\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        return -1\r\n    endfunction\r\n\r\n    private function Reset takes unit hero returns nothing\r\n    \tlocal integer i = 1\r\n    \t\r\n        loop\r\n            exitwhen i > PLAYERS_LIMIT\r\n            if GetOwningPlayer( udg_artifzone[i] ) == GetOwningPlayer( hero ) and udg_auctionlogic[i] then\r\n                set udg_auctionlogic[i] = false\r\n                call SetUnitOwner( udg_artifzone[i], Player(PLAYER_NEUTRAL_PASSIVE), true )\r\n                call DisplayTimedTextToPlayer( Player(i - 1), 0, 0, 5, \"|cffffcc00Exchanger:|r color reset. Another player posted an artifact from the exchanger.\" )\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n    endfunction\r\n    \r\n    private function RewardAttention takes unit hero, player owner returns nothing\r\n    \tlocal integer  j = ( GetPlayerId(owner) * 3 ) + 2\r\n    \t\r\n\t    call PanCameraToTimedLocForPlayer(owner, udg_itemcentr[j], 0.5 )\r\n\t    call PingMinimapLocForForceEx( GetForceOfPlayer(owner), udg_itemcentr[j], 10., bj_MINIMAPPINGSTYLE_FLASHY, 100, 0, 0 )\r\n    endfunction\r\n    \r\n    private function PutItem takes unit hero returns nothing\r\n    \tlocal integer i = 0\r\n    \tlocal integer iMax = UnitInventorySize(hero)\r\n    \tlocal item itemUsed = GetManipulatedItem()\r\n    \tlocal integer itemType = GetItemTypeId(itemUsed)\r\n    \tlocal item itemSlot\r\n    \t\r\n        loop\r\n            exitwhen i >= iMax\r\n            set itemSlot = UnitItemInSlot(hero, i)\r\n            if itemType == PutInExcanger[i] and itemSlot != null then\r\n                set udg_auctionartif[i] = itemSlot\r\n                call SetItemPosition( itemSlot, GetLocationX(udg_point[i]), GetLocationY(udg_point[i]))\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        \r\n        set itemUsed = null\r\n        set itemSlot = null\r\n    endfunction\r\n\r\n    private function Trig_Auction1_Actions takes nothing returns nothing\r\n        local unit hero = GetManipulatingUnit()\r\n        local item oldItem = null\r\n        local item currentItem = null\r\n        local player owner = GetOwningPlayer(hero)\r\n        local integer index = GetPlayerId(owner) + 1\r\n        local integer slotUsed\r\n        \r\n        set slotUsed = GetSlotUsed()\r\n        set currentItem = UnitItemInSlot(hero, slotUsed)\r\n\r\n        //if GetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD) >= ExchangeCost then\r\n        \r\n        if ItemRandomizerLib_IsRewardExist(owner) then\r\n        \tcall RewardAttention(hero, owner)\r\n        \tcall DisplayTimedTextToPlayer( owner, 0, 0, 5, \"Select an artifact in the preparatory room before starting the exchange.\" )\r\n        \tset hero = null\r\n        \tset owner = null\r\n        \tset currentItem = null\r\n        \treturn\r\n        endif\r\n        \r\n        if GetItemType(currentItem) == ITEM_TYPE_POWERUP then\r\n            call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"Only artifacts can be exchanged.\")\r\n            set hero = null\r\n        \tset owner = null\r\n        \tset currentItem = null\r\n        \treturn\r\n        endif\r\n        \r\n        if GetItemTypeId(currentItem) == 'I05J' or GetItemTypeId(UnitItemInSlot(GetManipulatingUnit(), slotUsed)) == 'I030' then\r\n            call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"This artifact cannot be put into the exchanger.\")\r\n            set hero = null\r\n        \tset owner = null\r\n        \tset currentItem = null\r\n        \treturn\r\n        endif\r\n        \r\n        if GetItemType(UnitItemInSlot(GetManipulatingUnit(), slotUsed)) == ITEM_TYPE_PURCHASABLE then\r\n            call DisplayTimedTextToPlayer(owner, 0, 0, 5, \"|cffffcc00Quests|r cannot be exchanged.\")\r\n            set hero = null\r\n        \tset owner = null\r\n        \tset currentItem = null\r\n        \treturn\r\n    \tendif\r\n    \t\r\n    \tset udg_auctionlogic[index] = false\r\n    \tcall Reset(hero)\r\n    \t\r\n        if udg_auctionartif[index] != null then\r\n            set oldItem = udg_auctionartif[index]\r\n            call SetItemPosition( oldItem, GetUnitX(hero), GetUnitY(hero))\r\n            set udg_auctionartif[index] = null\r\n        endif\r\n            \r\n        call PutItem(hero)\r\n        \r\n        if oldItem != null and IsItemOwned( oldItem ) == false then\r\n            call UnitAddItem( hero, oldItem )\r\n        endif\r\n        \r\n        set hero = null\r\n        set owner = null\r\n        set oldItem = null\r\n        set currentItem = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_Auction1 = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_Auction1, EVENT_PLAYER_UNIT_PICKUP_ITEM ) \r\n        call TriggerAddCondition( gg_trg_Auction1, Condition( function Trig_Auction1_Conditions ) )\r\n        call TriggerAddAction( gg_trg_Auction1, function Trig_Auction1_Actions )\r\n        \r\n        set PutInExcanger[0] = 'I0GX'\r\n        set PutInExcanger[1] = 'I0GW'\r\n        set PutInExcanger[2] = 'I0GV'\r\n        set PutInExcanger[3] = 'I0GU'\r\n        set PutInExcanger[4] = 'I0GT'\r\n        set PutInExcanger[5] = 'I0GS'\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}