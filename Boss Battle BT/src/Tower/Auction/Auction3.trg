{
  "Id": 50332248,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals\r\n    real Event_ItemExchange_Real\r\n    item Event_ItemExchange_Item\r\n    item Event_ItemExchange_OldItem\r\n    unit Event_ItemExchange_Hero\r\n    unit Event_ItemExchange_Friend\r\nendglobals\r\n\r\nfunction Trig_Auction3_Conditions takes nothing returns boolean\r\n    return GetItemTypeId(GetManipulatedItem()) == 'I0BJ' or GetItemTypeId(GetManipulatedItem()) == 'I07Y'\r\nendfunction\r\n\r\nfunction Trig_Auction3_Actions takes nothing returns nothing\r\n    local integer i = GetPlayerId(GetOwningPlayer(GetManipulatingUnit())) + 1\r\n    local integer p = 0\r\n    local integer cyclA \r\n    local boolean l = true\r\n    local integer rand\r\n    local integer gold = ExchangeCost\r\n\r\n    set cyclA = 0\r\n    loop\r\n        exitwhen cyclA > 3\r\n        if GetOwningPlayer(udg_artifzone[i]) == Player(cyclA) then\r\n            set p = GetPlayerId(Player(cyclA) ) + 1\r\n        endif\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n    \r\n    if udg_auctionartif[i] != null and udg_auctionartif[p] != null and GetOwningPlayer(udg_artifzone[i]) == Player(p - 1) and GetOwningPlayer(udg_artifzone[p]) == Player(i - 1) and not( udg_auctionlogic[i] ) and ( GetOwningPlayer(GetManipulatingUnit()) == Player(i - 1) or GetOwningPlayer(GetManipulatingUnit()) == Player(p - 1) ) and not( IsUnitLoaded( udg_hero[i] ) ) and not( IsUnitLoaded( udg_hero[p] ) ) then\r\n        set udg_auctionlogic[i] = true\r\n        set l = false\r\n        if udg_auctionlogic[p] then\r\n            call SetItemPosition( udg_auctionartif[i], GetUnitX(udg_hero[p]), GetUnitY(udg_hero[p]))\r\n            if UnitInventoryCount(udg_hero[p]) >= 6 then\r\n                set rand = GetRandomInt(0, 5)\r\n                call RemoveItem( UnitItemInSlot( udg_hero[p], rand ) )\r\n                call DisplayTimedTextToPlayer(Player(p - 1), 0, 0, 10., \"|cffffcc00WARNING!|r There is not enough room in the inventory to exchange. Artifact |cffffcc00\" + GetItemName( UnitItemInSlot( udg_hero[i], rand ) ) + \"|r was removed.\" )\r\n            endif\r\n            \r\n            set Event_ItemExchange_Hero = udg_hero[p]\r\n            set Event_ItemExchange_Item = udg_auctionartif[i]\r\n            \r\n            set Event_ItemExchange_Friend = udg_hero[i]\r\n            set Event_ItemExchange_OldItem = udg_auctionartif[p]\r\n            \r\n            set Event_ItemExchange_Real = 0.00\r\n            set Event_ItemExchange_Real = 1.00\r\n            set Event_ItemExchange_Real = 0.00\r\n            \r\n            set udg_auctionartif[i] = Event_ItemExchange_Item\r\n            \r\n            if udg_auctionartif[i] != null then\r\n                call UnitAddItem( udg_hero[p], udg_auctionartif[i] )\r\n            endif\r\n\r\n            call SetItemPosition( udg_auctionartif[p], GetUnitX(udg_hero[i]), GetUnitY(udg_hero[i]))\r\n            if UnitInventoryCount(udg_hero[i]) >= 6 then\r\n                set rand = GetRandomInt(0, 5)\r\n                call RemoveItem( UnitItemInSlot( udg_hero[i], rand ) )\r\n                call DisplayTimedTextToPlayer(Player(i - 1), 0, 0, 10., \"|cffffcc00WARNING!|r There is not enough room in the inventory to exchange. Artifact |cffffcc00\" + GetItemName( UnitItemInSlot( udg_hero[i], rand ) ) + \"|r was removed.\" )\r\n            endif\r\n            \r\n            set Event_ItemExchange_Hero = udg_hero[i]\r\n            set Event_ItemExchange_Item = udg_auctionartif[p]\r\n            \r\n            set Event_ItemExchange_Friend = udg_hero[p]\r\n            set Event_ItemExchange_OldItem = udg_auctionartif[i]\r\n            \r\n            set Event_ItemExchange_Real = 0.00\r\n            set Event_ItemExchange_Real = 1.00\r\n            set Event_ItemExchange_Real = 0.00\r\n            \r\n            set udg_auctionartif[p] = Event_ItemExchange_Item\r\n            \r\n            if udg_auctionartif[p] != null then\r\n                call UnitAddItem( udg_hero[i], udg_auctionartif[p] )\r\n            endif\r\n            \r\n            \r\n            set udg_auctionartif[i] = null\r\n            set udg_auctionartif[p] = null\r\n            set udg_auctionlogic[i] = false\r\n            set udg_auctionlogic[p] = false\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\Resurrect\\\\ResurrectTarget.mdl\", udg_hero[i], \"origin\" ) )\r\n            call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\Resurrect\\\\ResurrectTarget.mdl\", udg_hero[p], \"origin\" ) )\r\n            call SetUnitOwner( udg_artifzone[i], Player(PLAYER_NEUTRAL_PASSIVE), true )\r\n            call SetUnitOwner( udg_artifzone[p], Player(PLAYER_NEUTRAL_PASSIVE), true )\r\n        else\r\n            call DisplayTimedTextToPlayer(Player(i - 1), 0, 0, 5., \"Wait for the other player to click |cffffcc00'Make an exchange'|r.\" )\r\n            call DisplayTimedTextToPlayer(Player(p - 1), 0, 0, 5., \"Another player is ready to complete the exchange. Click |cffffcc00'Make an exchange'|r.\" )\r\n        endif\r\n    elseif udg_auctionlogic[i] then\r\n        call DisplayTimedTextToPlayer( GetOwningPlayer(GetManipulatingUnit()), 0, 0, 5., \"You have already clicked 'Make Exchange'. Wait for another player.\" )\r\n    elseif IsUnitLoaded( udg_hero[i] ) or IsUnitLoaded( udg_hero[p] ) then\r\n        call DisplayTimedTextToPlayer( GetOwningPlayer(GetManipulatingUnit()), 0, 0, 5., \"Get out of the vehicle to finish the exchange (another player too).\" )\r\n    elseif udg_auctionartif[i] == null then\r\n        call DisplayTimedTextToPlayer( GetOwningPlayer(GetManipulatingUnit()), 0, 0, 5., \"You does not have an artifact in the exchanger.\" )\r\n    elseif udg_auctionartif[p] == null then\r\n        call DisplayTimedTextToPlayer( GetOwningPlayer(GetManipulatingUnit()), 0, 0, 5., \"Another player does not have an artifact in the exchanger.\" )\r\n    else\r\n        call DisplayTimedTextToPlayer(GetOwningPlayer(GetManipulatingUnit()), 0, 0, 5, \"The conditions are not met.\" )\r\n    endif\r\n    if  l then\r\n        call SetPlayerState(GetOwningPlayer(GetManipulatingUnit()), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(GetManipulatingUnit()), PLAYER_STATE_RESOURCE_GOLD) + gold)\r\n    endif\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_Auction3 takes nothing returns nothing\r\n    set gg_trg_Auction3 = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_Auction3, EVENT_PLAYER_UNIT_PICKUP_ITEM ) \r\n    call TriggerAddCondition( gg_trg_Auction3, Condition( function Trig_Auction3_Conditions ) )\r\n    call TriggerAddAction( gg_trg_Auction3, function Trig_Auction3_Actions )\r\nendfunction",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}