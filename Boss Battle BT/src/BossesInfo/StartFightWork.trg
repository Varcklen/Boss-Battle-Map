{
  "Id": 50333394,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function AggroBoss takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local group g = CreateGroup()\r\n    local unit u\r\n\r\n    if not( udg_fightmod[1] ) then\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        set bj_groupEnumOwningPlayer = Player(10)\r\n        call GroupEnumUnitsInRect(g, udg_Boss_Rect, filterGetUnitsInRectOfPlayer)\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if GetUnitCurrentOrder(u) == OrderId(\"stand\") and GetUnitDefaultMoveSpeed(u) > 0 then\r\n                call aggro( u )\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n    endif\r\n    \r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set g = null\r\n    set u = null\r\nendfunction\r\n\r\nfunction ModGood22 takes nothing returns nothing\r\n    local unit boss = LoadUnitHandle( udg_hash, 1, StringHash( \"modg22\" ) )\r\n    call SetUnitLifePercentBJ( boss, GetUnitLifePercent(boss) - 10 )\r\n    call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\Thunderclap\\\\ThunderClapCaster.mdl\", boss, \"origin\") )\r\n    set boss = null\r\nendfunction\r\n\r\nfunction StartFight takes nothing returns nothing\r\n    local integer cyclA = 1\r\n    local integer cyclAEnd\r\n    local integer cyclB\r\n    local integer id\r\n    local integer i\r\n    local unit boss = null\r\n    local unit boss2 = null\r\n    local real x\r\n    local real y\r\n    local integer v\r\n    local integer n\r\n    local location array reg\r\n    local real bx\r\n    local real by\r\n\r\n\tif BossArenaChoise[udg_Boss_LvL][udg_Boss_Random] == 2 and not(udg_logic[78]) then\r\n        set udg_Boss_Rect = gg_rct_ArenaBossSmall\r\n        set udg_Boss_BigRect = gg_rct_Vision4\r\n\t\tset reg[1] = udg_point[30]\r\n\t\tset reg[2] = udg_point[31]\r\n\t\tset reg[3] = udg_point[32]\r\n\t\tset reg[4] = udg_point[33]\r\n\t\tset bx = GetRectCenterX(gg_rct_BossSpawnSmall)\r\n\t\tset by = GetRectCenterY(gg_rct_BossSpawnSmall)\r\n\telse\r\n        set udg_Boss_Rect = gg_rct_ArenaBoss\r\n        set udg_Boss_BigRect = gg_rct_Vision2\r\n\t\tset reg[1] = udg_point[5]\r\n\t\tset reg[2] = udg_point[6]\r\n\t\tset reg[3] = udg_point[7]\r\n\t\tset reg[4] = udg_point[8]\r\n\t\tset bx = GetRectCenterX(gg_rct_BossSpawn)\r\n\t\tset by = GetRectCenterY(gg_rct_BossSpawn)\r\n\tendif\r\n\r\n    set udg_fightmod[1] = true\r\n    call FightStart()\r\n\r\n    loop\r\n        exitwhen cyclA > 4\r\n        if GetPlayerSlotState( Player( cyclA - 1 ) ) == PLAYER_SLOT_STATE_PLAYING then\r\n            call SetUnitPositionLoc( udg_hero[cyclA], reg[cyclA] )\r\n            call SetUnitFacing( udg_hero[cyclA], 90 )\r\n            call PanCameraToTimedLocForPlayer( Player( cyclA - 1 ), reg[cyclA], 0 )\r\n            call DestroyEffect( AddSpecialEffect( \"Void Teleport Caster.mdx\", GetUnitX( udg_hero[cyclA] ), GetUnitY( udg_hero[cyclA] ) ) )\r\n            if udg_modgood[11] and udg_Boss_LvL != 1 then\r\n                call CreateUnit( Player( cyclA - 1 ), 'h00S', GetUnitX( udg_hero[cyclA] ) + 200, GetUnitY( udg_hero[cyclA] ), 90 )\r\n                call SetPlayerTechResearched( Player( cyclA - 1 ), 'R002', GetPlayerTechCount( Player( cyclA - 1 ), 'R002', true) + 1 )\r\n                call SetPlayerTechResearched( Player( cyclA - 1 ), 'R003', GetPlayerTechCount( Player( cyclA - 1 ), 'R003', true) + 1 )\r\n            endif\r\n            set cyclB = 1\r\n            loop\r\n                exitwhen cyclB > 6\r\n                if cyclB != udg_Boss_Random then\r\n                    call UnitRemoveAbility( udg_unit[cyclA + 17], Boss_Info[udg_Boss_LvL][cyclB] )\r\n                endif\r\n                set cyclB = cyclB + 1\r\n            endloop\r\n        endif\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n    if udg_Boss_LvL != 10 then\r\n        set cyclB = 1\r\n        loop\r\n            exitwhen cyclB > 6\r\n            if cyclB == udg_Boss_Random  then\r\n                set v = Boss_Info[udg_Boss_LvL][cyclB]\r\n                call IconFrame( \"boss\", BlzGetAbilityIcon(v), BlzGetAbilityTooltip(v, 0), BlzGetAbilityExtendedTooltip(v, 0) )\r\n            endif\r\n            set cyclB = cyclB + 1\r\n        endloop\r\n    endif\r\n\r\n    call EnableTrigger( gg_trg_HeroDeath )\r\n    call EnableTrigger( gg_trg_BossDamage )\r\n    call EnableTrigger( gg_trg_MinionsTeleportation )\r\n    if udg_Boss_LvL == 1 then\r\n        set udg_UntilFirstFight = false\r\n        set udg_LogicModes = false\r\n        call BlzFrameSetVisible( rpkmod,false)\r\n        call BlzFrameSetVisible( reselectionButton,false)\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if cyclA == 1 then\r\n                call UnitRemoveAbility( udg_unit[cyclA + 31], 'A06V' )\r\n                call UnitRemoveAbility( udg_unit[cyclA + 31], 'A0J8' )\r\n                call UnitRemoveAbility( udg_unit[cyclA + 31], 'A0JI' )\r\n                call UnitRemoveAbility( udg_unit[cyclA + 31], 'A0JJ' )\r\n            else\r\n                call RemoveUnit( udg_unit[cyclA + 31] )\r\n            endif\r\n            set udg_minion_repick[cyclA] = 0\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        if udg_logic[2] then\r\n            set udg_Multiboard_Time[1] = 0\r\n            set udg_Multiboard_Time[2] = 0\r\n            set udg_Multiboard_Time[3] = 0\r\n        endif\r\n    endif\r\n\r\n    if udg_logic[78] and udg_Boss_LvL != 1 then\r\n        set boss = CreateUnit( Player(10), DB_Boss_id[udg_Boss_LvL][udg_Boss_Random], GetRectCenterX(gg_rct_BossSpawn) - 600, GetRectCenterY(gg_rct_BossSpawn), 270 )\r\n\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 1\r\n            set n = GetRandomInt( 1, 5 ) //ИСПРАВИТЬ НА 5 КОГДА ПРОБЛЕМА С КРАШЕМ БУДЕТ РЕШЕНА\r\n            if DB_Boss_id[udg_Boss_LvL][n] != null and DB_Boss_id[udg_Boss_LvL][n] != GetUnitTypeId( boss ) then\r\n                set boss2 = CreateUnit( Player(10), DB_Boss_id[udg_Boss_LvL][n], GetRectCenterX(gg_rct_BossSpawn) + 600, GetRectCenterY(gg_rct_BossSpawn), 270 )\r\n                call IconFrame( \"second boss\", BlzGetAbilityIcon(Boss_Info[udg_Boss_LvL][n]), BlzGetAbilityTooltip(Boss_Info[udg_Boss_LvL][n], 0), BlzGetAbilityExtendedTooltip(Boss_Info[udg_Boss_LvL][n], 0) )\r\n            else\r\n                set cyclA = cyclA - 1\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    else\r\n        set boss = CreateUnit( Player(10), DB_Boss_id[udg_Boss_LvL][udg_Boss_Random], bx, by, 270 )\r\n    endif\r\n    \r\n    if LoadTimerHandle( udg_hash, 1, StringHash( \"aggro\" ) ) == null  then\r\n        call SaveTimerHandle( udg_hash, 1, StringHash( \"aggro\" ), CreateTimer() )\r\n    endif\r\n    call TimerStart( LoadTimerHandle( udg_hash, 1, StringHash( \"aggro\" ) ), 5, true, function AggroBoss )\r\n    \r\n    if udg_modbad[7] then\r\n        call EnableTrigger( gg_trg_Equality )\r\n    endif\r\n    if udg_modgood[22] then\r\n        //call UnitStun(boss, boss, 10 )\r\n        //call SetUnitLifePercentBJ( boss, GetUnitLifePercent(boss) - 10 )\r\n        //call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\Thunderclap\\\\ThunderClapCaster.mdl\", boss, \"origin\") )\r\n        call SaveUnitHandle( udg_hash, 1, StringHash( \"modg22\" ), boss )\r\n        call TimerStart( CreateTimer(), 1, false, function ModGood22 )\r\n    endif\r\n    if udg_modbad[14] then\r\n        set cyclA = 1\r\n        set cyclAEnd = udg_Boss_LvL-1\r\n        if cyclAEnd < 1 then\r\n            set cyclAEnd = 1\r\n        endif\r\n        loop\r\n            exitwhen cyclA > cyclAEnd\r\n            set bj_lastCreatedUnit = CreateUnit(GetOwningPlayer(boss), udg_Database_RandomUnit[GetRandomInt(1, udg_Database_NumberItems[5])], GetUnitX(boss), GetUnitY(boss), GetUnitFacing(boss))\r\n            call DestroyEffect(AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Orc\\\\FeralSpirit\\\\feralspirittarget.mdl\", bj_lastCreatedUnit, \"origin\"))\r\n            call UnitApplyTimedLife(bj_lastCreatedUnit, 'BTLF', 20 )\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    endif\r\n    set cyclA = 1\r\n    loop\r\n        exitwhen cyclA > 4\r\n        if GetUnitAbilityLevel( udg_hero[cyclA], 'A0LK') > 0 then\r\n            call madness( udg_hero[cyclA], GetUnitAbilityLevel( udg_hero[cyclA], 'A0LK') )\r\n        endif\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n    if boss != null then\r\n        set bossbar = boss\r\n    endif\r\n    if boss2 != null then\r\n        set bossbar1 = boss2\r\n    endif\r\n\r\n    call AUI_TimerGo()\r\n    \r\n\tset cyclA = 1\r\n    loop\r\n        exitwhen cyclA > 4\r\n        set reg[cyclA] = null\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n\r\n    set boss = null\r\n    set boss2 = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_StartFightWork takes nothing returns nothing\r\n    set gg_trg_StartFightWork = CreateTrigger(  )\r\n    call TriggerAddAction( gg_trg_StartFightWork, function StartFight )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}