{
  "Id": 50332083,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library Repick initializer init requires SpellPower, NullingAbility, BuffDeleteLib \r\n\r\n    globals\r\n        real Event_HeroRepick_Real = 0\r\n        unit Event_HeroRepick_Hero = null\r\n        player Event_HeroRepick_Player = null\r\n    endglobals\r\n    \r\n    private function DeleteItems takes unit hero returns nothing\r\n        local integer i = 0\r\n        local item it\r\n        \r\n        loop\r\n            exitwhen i > 5\r\n            set it = UnitItemInSlot(hero, i)\r\n            if UnitHasItem( hero, it ) then\r\n                call UnitRemoveItem(hero, it)//leave from inventory\r\n                call RemoveItem( it )//delete them\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n    \r\n        set hero = null\r\n        set it = null\r\n    endfunction\r\n    \r\n    private function DeleteMinions takes player owner returns nothing\r\n    \tlocal group g = CreateGroup()\r\n    \tlocal unit u\r\n    \tlocal unit h\r\n    \r\n    \tcall GroupEnumUnitsOfPlayer(g, owner, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if not( IsUnitType( u, UNIT_TYPE_HERO) ) and not( IsUnitType( u, UNIT_TYPE_STRUCTURE) ) and GetUnitAbilityLevel( u, 'A1ES') == 0 then\r\n                if GetUnitTypeId(u) == 'u00X' then\r\n                    set h = LoadUnitHandle( udg_hash, GetHandleId(u), StringHash( \"sldg\" ) )\r\n                    if h != null then\r\n                        call BlzSetUnitMaxHP( h, R2I(BlzGetUnitMaxHP(h)+BlzGetUnitMaxHP(u)) )\r\n                        call BlzSetUnitBaseDamage( h, R2I(BlzGetUnitBaseDamage(h, 0)+BlzGetUnitBaseDamage(u, 0)+1), 0 )\r\n                    endif\r\n                endif\r\n                call RemoveUnit( u )\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n        \r\n        call DestroyGroup(g)\r\n        set g = null\r\n        set u = null\r\n        set h = null\r\n    endfunction\r\n    \r\n    function Repick takes player owner returns nothing\r\n        local integer index = GetPlayerId(owner) + 1\r\n        local integer heroKey = udg_HeroNum[index]\r\n        local unit hero = udg_hero[index]\r\n        local unit temp\r\n        \r\n        if hero == null then\r\n            set temp = null\r\n            set owner = null\r\n            return\r\n        endif\r\n\r\n        set udg_UnitHeroLogic[heroKey] = false\r\n        set udg_SkinUsed[index] = 0\r\n        /*if IsUnitAliveBJ(hero) then\r\n        \tcall UnitAddItem( hero, CreateItem( 'I03S', GetUnitX(hero), GetUnitY(hero) ) )//Remove all abilities form hero\r\n    \tendif*/\r\n    \tcall BookOfOblivion_ResetHeroAbilities(hero)\r\n        if udg_fightlogic[index] then\r\n            set udg_fightlogic[index] = false\r\n            set udg_Player_Readiness = udg_Player_Readiness - 1\r\n        endif\r\n        //call MMD_UpdateValueString(\"hero\", owner, \"none\")\r\n        call GroupRemoveUnit(udg_otryad, hero)\r\n        call GroupRemoveUnit(udg_heroinfo, hero)\r\n        \r\n        if udg_number[index + 100] == 7 then\r\n            call spdst( hero, -10 )\r\n        elseif udg_number[index + 100] == 5 then\r\n        \tcall luckyst( hero, -5 )\r\n        endif\r\n        \r\n        call DelBuff( hero, false )\r\n        call DeleteItems(hero)\r\n        call DeleteMinions(owner)\r\n        call MultiSetIcon( udg_multi, ( udg_Multiboard_Position[index] * 3 ) - 1, 3, \"ReplaceableTextures\\\\CommandButtons\\\\BTNSelectHeroOn.blp\" )\r\n\r\n\t\tset Event_HeroRepick_Player = owner\r\n        set Event_HeroRepick_Hero = hero\r\n        set Event_HeroRepick_Real = 0.00\r\n        set Event_HeroRepick_Real = 1.00\r\n        set Event_HeroRepick_Real = 0.00\r\n\r\n        //Delete shield numbers\r\n        call DestroyTextTag( LoadTextTagHandle( udg_hash, GetHandleId(hero), StringHash( \"shldtx\" ) ) )\r\n\r\n        if udg_UntilFirstFight then\r\n            set temp = CreateUnit( Player(PLAYER_NEUTRAL_PASSIVE), 'u000', GetLocationX(udg_point[25+index]), GetLocationY(udg_point[25+index]), bj_UNIT_FACING )\r\n            call CameraSetupApplyForPlayer( true, udg_CameraChoose[index], Player(index-1), 0 )\r\n            call SetCameraTargetControllerNoZForPlayer( Player(index-1), temp, 200.00, -150.00, false )\r\n        \r\n            call BlzFrameSetTexture( iconframe[index], \"ReplaceableTextures\\\\CommandButtons\\\\BTNDivineShieldOff.blp\", 0, true )\r\n            call BlzFrameSetTexture( faceframe[index], \"ReplaceableTextures\\\\CommandButtons\\\\BTNSelectHeroOn.blp\", 0, false)\r\n            call BlzFrameSetVisible( uniqframe[index], false)\r\n            call BlzFrameSetVisible( specframe[index], false)\r\n            call BlzFrameSetTexture( HeroesTable_ChoosedHeroButton[index], HeroesTable_ChoosedHeroIcon[index], 0, true )\r\n\r\n            if GetLocalPlayer() == owner then\r\n                //call BlzFrameSetVisible( AspectVision, false )\r\n                call BlzFrameSetVisible( juleback, false )\r\n                call BlzFrameSetVisible( quartback, false )\r\n                call BlzFrameSetVisible( modesback, false )\r\n                call BlzFrameSetVisible( modesbut, false )\r\n                call BlzFrameSetVisible( modeslight, false )\r\n                call BlzFrameSetVisible( fon,false)\r\n                call BlzFrameSetVisible( butbk,false)\r\n                call BlzFrameSetVisible( iconframe[1],false)\r\n                call BlzFrameSetVisible( iconframe[2],false)\r\n                call BlzFrameSetVisible( iconframe[3],false)\r\n                call BlzFrameSetVisible( iconframe[4],false)\r\n                call BlzFrameSetVisible( faceframe[1],false)\r\n                call BlzFrameSetVisible( faceframe[2],false)\r\n                call BlzFrameSetVisible( faceframe[3],false)\r\n                call BlzFrameSetVisible( faceframe[4],false)\r\n                call BlzFrameSetVisible( rpkmod,false)\r\n                call BlzFrameSetVisible( arrowframe, false )\r\n            endif\r\n        endif\r\n        \r\n        call SetUnitOwner( hero, Player(PLAYER_NEUTRAL_PASSIVE), true )\r\n        call FlushChildHashtable( udg_hash, GetHandleId(hero) )\r\n        call SetUnitPosition(hero, GetLocationX(udg_point[25+index]), GetLocationY(udg_point[25+index]))\r\n        call SetUnitFacing(hero, 270)\r\n        call ShowUnit(hero, false )\r\n        set udg_hero[index] = null\r\n        set ChoosedHero[index] = null\r\n        \r\n        set hero = null\r\n        set temp = null\r\n        set owner = null\r\n    endfunction\r\n        \r\n    private function OnPlayerLeave takes nothing returns nothing\r\n    \tcall Repick(Event_PlayerLeave_Player)\r\n    endfunction\r\n    \r\n    private function init takes nothing returns nothing\r\n        call CreateEventTrigger( \"Event_PlayerLeave_Real\", function OnPlayerLeave, null )\r\n    endfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}