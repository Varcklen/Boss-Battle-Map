{
  "Id": 50332336,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope JuleFrame initializer init\r\n\r\n    globals\r\n        private constant real SIZE = 1\r\n\r\n        framehandle juleback\r\n        framehandle juleextra1\r\n        framehandle juleextra2\r\n        framehandle julerefr\r\n        framehandle julecont\r\n        framehandle juleupgr\r\n        framehandle bookOfOblivionCostText\r\n        framehandle array juleicon[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        framehandle array julebut[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        framehandle array juletext[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        framehandle array JuleExtraInfo[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        //framehandle array julename[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        //framehandle array juledisc[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        //framehandle array julediscback[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        \r\n        boolean array julebool[ROW_LIMIT_ARRAYS][3]\r\n        integer array julecost[ROW_LIMIT_ARRAYS][COLUMN_LIMIT_ARRAYS]\r\n        \r\n        integer julenum = 0\r\n        private integer Index = 1\r\n        \r\n        private constant integer REFRESH_COST = 400 \r\n    endglobals\r\n        \r\n    /*function SetStableToolJule takes integer a, integer b, string name, string disc returns nothing\r\n        set julediscback[a][b] = BlzCreateFrame( \"QuestButtonBaseTemplate\", julebut[a][b], 0, 0 )\r\n        call BlzFrameSetAbsPoint(julediscback[a][b], FRAMEPOINT_BOTTOM, 0.7, 0.16)\r\n        call BlzFrameSetTooltip( julebut[a][b], julediscback[a][b] )\r\n        call BlzFrameSetSize( julediscback[a][b], 0.35, StringSizeStableTool(disc) )\r\n\r\n        set julename[a][b] = BlzCreateFrameByType(\"TEXT\", \"\",  julediscback[a][b], \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetPoint( julename[a][b], FRAMEPOINT_TOPLEFT, julediscback[a][b], FRAMEPOINT_TOPLEFT, 0.008,-0.008) \r\n        call BlzFrameSetSize(julename[a][b], 0.25, StringSizeStableTool(disc)+0.05)\r\n        call BlzFrameSetText( julename[a][b], name )\r\n\r\n        set juledisc[a][b] = BlzCreateFrameByType(\"TEXT\", \"\",  julediscback[a][b], \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetPoint( juledisc[a][b], FRAMEPOINT_TOPLEFT, julediscback[a][b], FRAMEPOINT_TOPLEFT, 0.008,-0.023) \r\n        call BlzFrameSetSize(juledisc[a][b], 0.25, StringSizeStableTool(disc)+0.05)\r\n        call BlzFrameSetText( juledisc[a][b], disc )\r\n    endfunction*/\r\n\r\n    function ButtonExitJule takes nothing returns nothing\r\n        if GetLocalPlayer() == GetTriggerPlayer() then\r\n            call BlzFrameSetVisible( juleback,false)\r\n        endif\r\n    endfunction\r\n\r\n    function JuleAddItem takes unit u, integer index returns item\r\n        set udg_it = CreateItem( index, GetUnitX(u), GetUnitY(u) )\r\n        call SaveBoolean( udg_hash, GetHandleId( udg_it ), StringHash( \"jule\" ), true ) \r\n        return udg_it\r\n    endfunction\r\n\r\n\t//======Buing==========\r\n\tprivate function EndBuying takes player owner, integer row, integer column returns nothing\r\n\t\tlocal framehandle itemSlotFrame = juleicon[row][column]\r\n\t\tlocal integer cost = julecost[row][column]\r\n\t\t\r\n\t\tcall BlzFrameSetVisible( itemSlotFrame, false )\r\n        call SetPlayerState( owner, PLAYER_STATE_RESOURCE_GOLD, IMaxBJ(0, GetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD) - cost ) )\r\n        \r\n        set itemSlotFrame = null\r\n\tendfunction\r\n\t\r\n\tglobals\r\n\t\tprivate integer BuyingType = 0\r\n\t\t\r\n\t\tprivate constant integer RESULT_FALSE = 0\r\n\t\tprivate constant integer RESULT_BUYING_ITEM = 1\r\n\t\tprivate constant integer RESULT_BUYING_WEAPON_PIECE = 2\r\n\t\tprivate constant integer RESULT_BUYING_UNMERGED_ORB = 3\r\n\t\tprivate constant integer RESULT_BUYING_TRIPLE_SET_ITEM = 4\r\n\tendglobals\r\n\t\r\n\tprivate function BasePlayError takes player owner, string text returns nothing\r\n\t\tif owner == GetLocalPlayer() then\r\n\t\t\tcall DisplayTimedTextToPlayer(owner, 0, 0, 5, text )\r\n\t\t\tcall StartSound(gg_snd_Error)\r\n\t\tendif\r\n\tendfunction\r\n\t\r\n\tprivate function PlayError takes player owner, string text returns boolean\r\n\t\tcall BasePlayError(owner, \"|cffffcc00You cannot buy the item.|r \" + text)\r\n\t\tset BuyingType = RESULT_FALSE\r\n\t\treturn false\r\n\tendfunction\r\n\t\r\n\tprivate function CheckSpecialConditions takes unit hero, integer itemInSlot returns integer\r\n\t\tif WeaponPieceSystem_IsItemCanBeAddedToUltimateWeapon(hero, itemInSlot) then\r\n\t\t\treturn RESULT_BUYING_WEAPON_PIECE\r\n\t\telseif TagSystem_CheckTag( itemInSlot, TAG_UNMERGED_ORB ) and TagSystem_GetInventoryAmountOfTagItems( hero, TAG_UNMERGED_ORB) > 0 then\r\n\t\t\treturn RESULT_BUYING_UNMERGED_ORB\r\n\t\telseif TagSystem_CheckTag( itemInSlot, TAG_TRIPLE_SET_PIECE ) and TripleSetEvent_CheckCondition(hero, itemInSlot) then\r\n\t\t\treturn RESULT_BUYING_TRIPLE_SET_ITEM\r\n\t\tendif\r\n\t\treturn 0\r\n\tendfunction\r\n\t\r\n\tprivate function ByingResult takes unit hero, integer itemType returns nothing\r\n\t\tif BuyingType == RESULT_BUYING_ITEM then\r\n       \t\tcall UnitAddItem( hero, JuleAddItem( hero, itemType) )\r\n   \t\telseif BuyingType == RESULT_BUYING_WEAPON_PIECE then\r\n   \t\t\tcall WeaponGain_AddWeapon.evaluate(hero, JuleAddItem( hero, itemType) )\r\n\t\telseif BuyingType == RESULT_BUYING_UNMERGED_ORB then\r\n\t\t\tcall OrbMerge_Merge.evaluate(hero, itemType)\r\n\t\telseif BuyingType == RESULT_BUYING_TRIPLE_SET_ITEM then\r\n\t\t\tcall TripleSetEvent_EndMerging(hero, itemType)\r\n   \t\tendif\r\n\tendfunction\r\n\t\r\n\tprivate function CheckConditions takes player owner, unit hero, integer itemInSlot, integer row, integer column returns boolean\r\n\t\tlocal integer specialCheck = CheckSpecialConditions(hero, itemInSlot)\r\n\r\n\t\tif GetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD) < julecost[row][column] then\r\n\t\t\treturn PlayError(owner, \"Not enough money.\")\r\n\t\telseif itemInSlot == 0 then\r\n\t\t\treturn PlayError(owner, \"The item type does not exist in the slot.\")\r\n\t\telseif UnitInventoryCount(hero) >= UnitInventorySize(hero) and specialCheck == 0 then\r\n\t\t\treturn PlayError(owner, \"The inventory is full.\")\r\n\t\tendif\r\n\t\t\r\n\t\tif specialCheck != 0 then\r\n\t\t\tset BuyingType = specialCheck//RESULT_BUYING_WEAPON_PIECE\r\n\t\t\treturn true\r\n\t\tendif\r\n\t\tset BuyingType = RESULT_BUYING_ITEM\r\n\t\treturn true\r\n\tendfunction\r\n\r\n    private function Buy takes nothing returns nothing\r\n        local player owner = GetTriggerPlayer()\r\n        local unit hero = udg_hero[GetPlayerId(owner) + 1]\r\n        local integer id = GetHandleId(BlzGetTriggerFrame())\r\n        local integer row = LoadInteger(udg_hash, id, StringHash(\"jule_button_row\") )\r\n        local integer column = LoadInteger(udg_hash, id, StringHash(\"jule_button_column\") )\r\n        local integer slot = LoadInteger(udg_hash, id, StringHash(\"jule_button_index\") )\r\n        local integer itemInSlot = JuleLib_GetItemInSlot(slot)\r\n\r\n        if GetLocalPlayer() == owner then\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(), false)\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(), true)\r\n        endif\r\n        \r\n        if CheckConditions(owner, hero, itemInSlot, row, column) then\r\n        \tcall ByingResult(hero, itemInSlot)\r\n\t    \tcall EndBuying( owner, row, column)\r\n        endif\r\n        \r\n        set BuyingType = RESULT_FALSE\r\n\r\n        set owner = null\r\n        set hero = null\r\n    endfunction\r\n\r\n\t//=========Refresh Timer=============\r\n    globals\r\n    \tprivate framehandle TimerTextFrame = null\r\n    \tpublic framehandle ButtonLess = null\r\n    \tpublic framehandle ButtonMore = null\r\n    \t\r\n    \tprivate integer array TimerTime\r\n    \tprivate integer CurrentTimer = 0\r\n    \tprivate constant integer MAX_TIMER = 3\r\n    \tprivate constant integer REFRESH_STRING_HASH = StringHash(\"refresh_timer\")\r\n    \t\r\n    \tprivate timer RefreshTimer = CreateTimer()\r\n    \tprivate player TimerUser = null\r\n    \tprivate boolean IsTimerActive = false\r\n    endglobals\r\n    \r\n    private function ChangeTimer takes integer toAdd returns nothing\r\n    \tlocal integer newValue = CurrentTimer + toAdd\r\n    \t\r\n    \tif GetLocalPlayer() == GetTriggerPlayer() then\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),false)\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),true)\r\n        endif\r\n    \t\r\n    \tif newValue < 0 or newValue > MAX_TIMER then\r\n    \t\treturn\r\n    \tendif\r\n    \tset CurrentTimer = newValue\r\n    \tcall BlzFrameSetText( TimerTextFrame, I2S(TimerTime[newValue]) )\r\n    endfunction\r\n    \r\n    private function LowerTimer takes nothing returns nothing\r\n    \tcall ChangeTimer(-1)\r\n    endfunction\r\n    \r\n    private function AddToTimer takes nothing returns nothing\r\n    \tcall ChangeTimer(1)\r\n    endfunction\r\n    \r\n    private function InitTimer takes nothing returns nothing\r\n    \tset TimerTime[0] = 0\r\n    \tset TimerTime[1] = 3\r\n    \tset TimerTime[2] = 5\r\n    \tset TimerTime[3] = 7\r\n    endfunction\r\n    //===================================\r\n\r\n\t//========Refresh=============\r\n\tprivate function IsEnoughGold takes player p returns boolean\r\n\t\treturn GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) >= REFRESH_COST or udg_logic[42] \r\n\tendfunction\r\n\t\r\n\tprivate function StartResfresh takes player owner returns nothing\r\n\t\tif IsEnoughGold(owner) == false then\r\n\t\t\tcall BasePlayError(owner, \"|cffffcc00You can't run refresh.|r Not enough gold.\")\r\n\t\t\treturn\r\n\t\tendif\r\n\t\r\n        call JuleRef()\r\n        if udg_logic[42] then\r\n            set udg_logic[42] = false\r\n            call BlzFrameSetText( juletext[1][0], I2S(REFRESH_COST) + \" G\" )\r\n        else\r\n            call SetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD, IMaxBJ(0,GetPlayerState(owner, PLAYER_STATE_RESOURCE_GOLD) - REFRESH_COST))\r\n        endif\r\n\tendfunction\r\n\t\r\n\tprivate function EndTimer takes nothing returns nothing\r\n\t\tset TimerUser = null\r\n    \tset IsTimerActive = false\r\n\t\tcall PauseTimer(RefreshTimer)\r\n\tendfunction\r\n\t\r\n\tprivate function RefreshTick takes nothing returns nothing\r\n    \tlocal integer id = GetHandleId( GetExpiredTimer())\r\n    \tlocal integer counter = LoadInteger(udg_hash, id, REFRESH_STRING_HASH ) - 1\r\n    \t\r\n    \tif udg_fightmod[0] then\r\n    \t\tcall EndTimer()\r\n    \t\treturn\r\n    \tendif\r\n    \t\r\n    \tif counter > 0 then\r\n    \t\tcall SaveInteger(udg_hash, id, REFRESH_STRING_HASH, counter)\r\n    \t\tcall DisplayTimedTextToForce( bj_FORCE_ALL_PLAYERS, 5, I2S(counter) + \"...\" )\r\n    \telse\r\n    \t\tcall StartResfresh(TimerUser)\r\n    \t\tcall EndTimer()\r\n    \tendif\r\n    endfunction\r\n\t\r\n\tprivate function RunTimer takes player p returns nothing\r\n    \tlocal integer id = GetHandleId(RefreshTimer)\r\n    \tlocal integer time = TimerTime[CurrentTimer]\r\n    \t\r\n    \tset TimerUser = p\r\n    \tset IsTimerActive = true\r\n    \t\r\n    \tcall SaveInteger(udg_hash, id, REFRESH_STRING_HASH, time)\r\n    \tcall TimerStart(RefreshTimer, 1, true, function RefreshTick)\r\n    \t\r\n    \tcall DisplayTimedTextToForce( bj_FORCE_ALL_PLAYERS, 5, \"|cffffcc00The Artifact Store|r will be refreshed in \" + I2S(time) + \" seconds.\" )\r\n    endfunction\r\n\t\r\n    private function JuleRefresh takes nothing returns nothing\r\n        local player p = GetTriggerPlayer()\r\n        if GetLocalPlayer() == p then\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),false)\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),true)\r\n        endif\r\n\r\n\t\tif IsTimerActive and TimerUser != p then\r\n\t\t\tcall BasePlayError(p, \"|cffffcc00You can't run refresh.|r It has already been launched by another player.\")\r\n\t\t\tset p = null\r\n\t\t\treturn\r\n\t\tendif\r\n\t\tif IsEnoughGold(p) == false then\r\n\t\t\tcall BasePlayError(p, \"|cffffcc00You can't run refresh.|r Not enough gold.\")\r\n\t\t\tset p = null\r\n\t\t\treturn\r\n\t\tendif\r\n\t\t\r\n\t\tif CurrentTimer != 0 then\r\n\t\t\tif IsTimerActive then\r\n\t\t\t\tcall DisplayTimedTextToForce( bj_FORCE_ALL_PLAYERS, 5, \"|cffffcc00The Artifact Store|r refresh timer has stopped.\" )\r\n\t\t\t\tcall EndTimer()\r\n\t\t\telse\r\n\t\t\t\tcall RunTimer(p)\r\n\t\t\tendif\r\n\t\t\tset p = null\r\n\t\t\treturn\r\n\t\tendif\t\r\n\r\n\t\tcall StartResfresh(p)\r\n        \r\n        set p = null\r\n    endfunction\r\n    //=============================\r\n\r\n    function JuleContract takes nothing returns nothing\r\n        local player p = GetTriggerPlayer()\r\n        \r\n        if GetLocalPlayer() == p then\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),false)\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),true)\r\n        endif\r\n        if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) >= 125 then\r\n            if not(udg_logic[99]) then\r\n                set udg_logic[99] = true\r\n                //call BlzSetSpecialEffectScale( fx, 0.5 )\r\n                call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\Resurrect\\\\ResurrectTarget.mdl\", udg_UNIT_JULE, \"origin\" ) )\r\n                call DisplayTimedTextToForce( bj_FORCE_ALL_PLAYERS, 10, \"|cffffcc00Contract|r with Jule is signed.\" )\r\n                call StartSound(gg_snd_QuestLog)\t\r\n                call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, IMaxBJ(0,GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) - 125))\r\n                call BlzFrameSetVisible( julecont, false )\r\n\r\n                call IconFrame( \"Contract\", \"ReplaceableTextures\\\\CommandButtons\\\\BTNScrollOfProtection.blp\", \"Contract\", \"Jule will not refresh artifacts after defeating a boss.\" )\r\n            else\r\n                call textst( \"Already active\", udg_UNIT_JULE, 64, 90, 8, 1 )\r\n            endif\r\n        endif\r\n        \r\n        set p = null\r\n    endfunction\r\n\r\n    function JuleUpgradeUse takes player initiator returns nothing\r\n    \tlocal integer index = GetPlayerId(initiator) + 1\r\n    \tlocal integer openSlots\r\n    \t\r\n        if julenum >= JuleLib_INITIAL_OPEN_SLOTS then\r\n        \treturn\r\n    \tendif\r\n    \t\r\n        set julenum = julenum + 1\r\n        set openSlots = JuleLib_INITIAL_OPEN_SLOTS + julenum\r\n        set JuleLib_Item_Name[openSlots] = \"Unlocked\"\r\n        set JuleLib_Item_Description[openSlots] = \"The artifact will be available for purchase here soon.\"\r\n        if julenum > 4 then\r\n            set julebool[julenum-4][2] = true\r\n            call BlzFrameSetTexture( juleicon[julenum-4][4], \"war3mapImported\\\\BTNfeed-icon-red-1_result.blp\", 0, true )\r\n        else\r\n            set julebool[julenum][1] = true\r\n            call BlzFrameSetTexture( juleicon[julenum][3], \"war3mapImported\\\\BTNfeed-icon-red-1_result.blp\", 0, true )\r\n        endif\r\n        if julenum < JuleLib_INITIAL_OPEN_SLOTS then\r\n            call BlzFrameSetText( juletext[0][0], I2S(300 + (100*julenum))+\" G\" )\r\n        else\r\n            call BlzFrameSetVisible( juleupgr,false)\r\n        endif\r\n        \r\n        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Other\\\\Levelup\\\\LevelupCaster.mdl\", GetUnitX( udg_UNIT_JULE ), GetUnitY( udg_UNIT_JULE ) ) )\r\n        call DisplayTimedTextToForce( bj_FORCE_ALL_PLAYERS, 10, \"|cffffcc00The Artifact Store|r has been upgraded by \" + udg_Player_Color[index] + GetPlayerName(initiator) + \"|r.\" )\r\n        \r\n        call JuleLib_StockAmountChange(openSlots)\r\n    endfunction\r\n\r\n    private function JuleUpgrade takes nothing returns nothing\r\n        local player p = GetTriggerPlayer()\r\n        local integer cost = 300 + (100*julenum)\r\n        \r\n        if GetLocalPlayer() == p then\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),false)\r\n            call BlzFrameSetVisible( BlzGetTriggerFrame(),true)\r\n        endif\r\n        \r\n        if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) >= cost then\r\n            call JuleUpgradeUse(p)\r\n            call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, IMaxBJ(0,GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) - cost))\r\n        endif\r\n        \r\n        set p = null\r\n    endfunction\r\n    \r\n    private function EnableTooltip takes nothing returns nothing\r\n        local integer index = LoadInteger(udg_hash, GetHandleId(BlzGetTriggerFrame()), StringHash(\"index\") )\r\n \r\n        call Tooltip_SetLocalTooltipText(GetTriggerPlayer(), JuleLib_Item_Name[index], JuleLib_Item_Description[index])\r\n    endfunction\r\n    \r\n    private function CreateJuleButton takes integer row, integer column, framehandle parent, real x, real y, string name, string description returns nothing\r\n    \tlocal framehandle juleIcon\r\n    \tlocal framehandle frame\r\n    \tlocal trigger trig\r\n    \tlocal integer id\r\n    \t\r\n        set julecost[row][column] = 0\r\n        set juleIcon = BlzCreateFrameByType(\"BACKDROP\", \"\", parent, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juleIcon, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(juleIcon, FRAMEPOINT_TOP, parent, FRAMEPOINT_TOP, x, y)\r\n        call BlzFrameSetTexture( juleIcon, \"war3mapImported\\\\BTNIconLock.blp\", 0, true )\r\n        set juleicon[row][column] = juleIcon\r\n        \r\n        set julebut[row][column] = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", juleIcon, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( julebut[row][column], 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(julebut[row][column], FRAMEPOINT_CENTER, juleIcon, FRAMEPOINT_CENTER, 0,0)\r\n        \r\n        set JuleLib_Item_Name[Index] = name\r\n        set JuleLib_Item_Description[Index] = description\r\n        \r\n        set trig = Tooltip_AddMouseEvent( julebut[row][column], function EnableTooltip, function Buy, Index )\r\n        set id = GetHandleId(julebut[row][column])\r\n        call SaveInteger(udg_hash, id, StringHash(\"jule_button_row\"), row )\r\n        call SaveInteger(udg_hash, id, StringHash(\"jule_button_column\"), column )\r\n        call SaveInteger(udg_hash, id, StringHash(\"jule_button_index\"), Index )\r\n        //call BJDebugMsg(\"index: \" + I2S(Index))\r\n        \r\n        set Index = Index + 1\r\n        \r\n        set juletext[row][column] = BlzCreateFrameByType(\"TEXT\", \"\", juleIcon, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juletext[row][column], 0.04*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(juletext[row][column], FRAMEPOINT_TOP, juleIcon, FRAMEPOINT_TOP, 0.01*SIZE,-0.04*SIZE) \r\n        \r\n        set JuleExtraInfo[row][column] = BlzCreateFrameByType(\"BACKDROP\", \"\", juleIcon, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( JuleExtraInfo[row][column], 0.01*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(JuleExtraInfo[row][column], FRAMEPOINT_BOTTOMRIGHT, juleIcon, FRAMEPOINT_BOTTOMRIGHT, 0, 0)\r\n        call BlzFrameSetVisible( JuleExtraInfo[row][column], false )\r\n        \r\n        set frame = BlzCreateFrameByType(\"BACKDROP\", \"\", JuleExtraInfo[row][column], \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( frame, 0.01*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(frame, FRAMEPOINT_CENTER, JuleExtraInfo[row][column], FRAMEPOINT_CENTER, 0, 0)\r\n        call BlzFrameSetTexture( frame, \"war3mapImported\\\\RedOutline.blp\", 0, true )\r\n        \r\n        set frame = null\r\n        set trig = null\r\n        set juleIcon = null\r\n    endfunction\r\n    \r\n    private function Action takes nothing returns nothing\r\n        local trigger trig\r\n        local framehandle frameback\r\n        local framehandle framebase\r\n        local framehandle frame\r\n        local integer cyclA\r\n        local integer cyclB\r\n\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > PLAYERS_LIMIT\r\n            set Book_Of_Oblivion_Cost[cyclA] = BOOK_OF_OBLIVION_BASE_COST\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n\r\n        set juleback = BlzCreateFrame(\"QuestButtonBaseTemplate\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), 0, 0)\r\n        call BlzFrameSetAbsPoint(juleback, FRAMEPOINT_TOPRIGHT, 0.75, 0.53)\r\n        call BlzFrameSetSize(juleback, SIZE*0.27, SIZE*0.28)\r\n        call BlzFrameSetVisible( juleback, false )\r\n        call BlzFrameSetLevel( juleback, -1 )\r\n        \r\n        \r\n        //=========Команды=========\r\n        set frameback = BlzCreateFrame(\"QuestButtonBackdropTemplate\", juleback, 0, 0)\r\n        call BlzFrameSetPoint(frameback, FRAMEPOINT_TOPLEFT, juleback, FRAMEPOINT_TOPLEFT, 0.005*SIZE,-0.005*SIZE) \r\n        call BlzFrameSetSize(frameback, 0.06*SIZE, 0.27*SIZE)\r\n        \r\n        \r\n        //Refresh\r\n        set julerefr = BlzCreateFrameByType(\"BACKDROP\", \"\", frameback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( julerefr, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(julerefr, FRAMEPOINT_CENTER, frameback, FRAMEPOINT_TOP, 0*SIZE,-0.03*SIZE)\r\n        call BlzFrameSetTexture( julerefr, \"ReplaceableTextures\\\\CommandButtons\\\\BTNRiderlessKodo.blp\", 0, true )\r\n        \r\n        set framebase = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", julerefr, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( framebase, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_CENTER, julerefr, FRAMEPOINT_CENTER, 0,0)\r\n        \r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, framebase, FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function JuleRefresh)\r\n        \r\n        call SetStableTool( framebase, \"Refresh\", \"Changes artifacts in the store to others.|n|nThe host can set a timer that will update items after a while. If the timer initiator presses again, the timer will be canceled.\" )\r\n        \r\n        set juletext[1][0] = BlzCreateFrameByType(\"TEXT\", \"\", framebase, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juletext[1][0], 0.03*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(juletext[1][0], FRAMEPOINT_TOP, framebase, FRAMEPOINT_TOP, 0,-0.04*SIZE) \r\n        call BlzFrameSetText( juletext[1][0], \"400 G\" )\r\n        \r\n        \r\n        //Refresh Timer\r\n        set framebase = BlzCreateFrameByType(\"FRAME\", \"\", julerefr, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( framebase, 0.04*SIZE, 0.02*SIZE )\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_CENTER, frameback, FRAMEPOINT_TOP, 0*SIZE,-0.075*SIZE)\r\n        \r\n        \r\n        set frame = BlzCreateFrame(\"ScriptDialogButton\", framebase, 0,0) \r\n\t    call BlzFrameSetSize(frame, 0.021,0.021)\r\n\t    call BlzFrameSetPoint( frame, FRAMEPOINT_LEFT, framebase, FRAMEPOINT_LEFT, 0, 0) \r\n\t    call BlzFrameSetText(frame, \"<\")\r\n\t    set ButtonLess = frame\r\n\t    \r\n\t    set trig = CreateTrigger()\r\n\t    call BlzTriggerRegisterFrameEvent(trig, frame, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tcall TriggerAddAction(trig, function LowerTimer)\r\n\t\t\r\n\t\t\r\n\t\tset frame = BlzCreateFrame(\"ScriptDialogButton\", framebase, 0,0) \r\n\t    call BlzFrameSetSize(frame, 0.021,0.021)\r\n\t    call BlzFrameSetPoint( frame, FRAMEPOINT_RIGHT, framebase, FRAMEPOINT_RIGHT, 0, 0) \r\n\t    call BlzFrameSetText(frame, \">\")\r\n\t    set ButtonMore = frame\r\n\t    \r\n\t    set trig = CreateTrigger()\r\n\t    call BlzTriggerRegisterFrameEvent(trig, frame, FRAMEEVENT_CONTROL_CLICK)\r\n\t\tcall TriggerAddAction(trig, function AddToTimer)\r\n\t\t\r\n\t\t\r\n\t\tset frame = BlzCreateFrameByType(\"BACKDROP\", \"\", framebase, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( frame, 0.01*SIZE, 0.02*SIZE )\r\n        call BlzFrameSetPoint(frame, FRAMEPOINT_CENTER, framebase, FRAMEPOINT_CENTER, 0, 0)\r\n        call BlzFrameSetTexture( frame, \"war3mapImported\\\\BTNfeed-icon-red-1_result.blp\", 0, true )\r\n\t\t\r\n\t\tset TimerTextFrame = BlzCreateFrameByType(\"TEXT\", \"\", frame, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( TimerTextFrame, 0.01*SIZE, 0.02*SIZE )\r\n        call BlzFrameSetPoint(TimerTextFrame, FRAMEPOINT_CENTER, frame, FRAMEPOINT_CENTER, 0,0) \r\n        call BlzFrameSetText( TimerTextFrame, \"0\" )\r\n        call BlzFrameSetTextAlignment(TimerTextFrame, TEXT_JUSTIFY_MIDDLE, TEXT_JUSTIFY_MIDDLE)\r\n\t\t\r\n\t\tcall InitTimer()\r\n        \r\n        //Contract\r\n        set julecont = BlzCreateFrameByType(\"BACKDROP\", \"\", frameback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( julecont, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(julecont, FRAMEPOINT_CENTER, frameback, FRAMEPOINT_BOTTOM, 0*SIZE,0.04*SIZE)\r\n        call BlzFrameSetTexture( julecont, \"ReplaceableTextures\\\\CommandButtons\\\\BTNScrollOfProtection.blp\", 0, true )\r\n        \r\n        set framebase = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", julecont, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( framebase, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_CENTER, julecont, FRAMEPOINT_CENTER, 0,0)\r\n\r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, framebase, FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function JuleContract)\r\n        \r\n        call SetStableTool( framebase, \"Contract\", \"Jule will not refresh artifacts after defeating a boss.\" )\r\n        \r\n        set juletext[2][0] = BlzCreateFrameByType(\"TEXT\", \"\", framebase, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juletext[2][0], 0.03*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(juletext[2][0], FRAMEPOINT_TOP, framebase, FRAMEPOINT_TOP, 0,-0.04*SIZE) \r\n        call BlzFrameSetText( juletext[2][0], \"125 G\" )\r\n        \r\n        \r\n        //Tome of Oblivion\r\n        set frame = BlzCreateFrameByType(\"BACKDROP\", \"\", frameback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( frame, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(frame, FRAMEPOINT_CENTER, frameback, FRAMEPOINT_TOP, 0*SIZE,-0.11*SIZE)\r\n        call BlzFrameSetTexture( frame, \"ReplaceableTextures\\\\CommandButtons\\\\BTNTomeOfRetraining.blp\", 0, true )\r\n        \r\n        set framebase = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", frame, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( framebase, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_CENTER, frame, FRAMEPOINT_CENTER, 0,0)\r\n\r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, framebase, FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function Book_Of_Oblivion)\r\n        \r\n        call SetStableTool( framebase, \"Tome of Oblivion\", \"Forces the hero to forget all abilities and allows it to learn others.\" )\r\n        \r\n        set bookOfOblivionCostText = BlzCreateFrameByType(\"TEXT\", \"\", framebase, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( bookOfOblivionCostText, 0.03*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(bookOfOblivionCostText, FRAMEPOINT_TOP, framebase, FRAMEPOINT_TOP, 0,-0.04*SIZE) \r\n        call BlzFrameSetText( bookOfOblivionCostText, I2S(Book_Of_Oblivion_Cost[1]) + \" G\" )\r\n        \r\n        \r\n        \r\n        //Upgrade\r\n        set juleupgr = BlzCreateFrameByType(\"BACKDROP\", \"\", frameback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juleupgr, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(juleupgr, FRAMEPOINT_CENTER, frameback, FRAMEPOINT_BOTTOM, 0*SIZE,0.09*SIZE)\r\n        call BlzFrameSetTexture( juleupgr, \"ReplaceableTextures\\\\CommandButtons\\\\BTNCryptFiendUnBurrow.blp\", 0, true )\r\n        \r\n        set framebase = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", juleupgr, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( framebase, 0.035*SIZE, 0.035*SIZE )\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_CENTER, juleupgr, FRAMEPOINT_CENTER, 0,0)\r\n        \r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, framebase, FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function JuleUpgrade)\r\n        \r\n        call SetStableTool( framebase, \"Upgrade\", \"Improves the shop by increasing the assortment of artifacts.\" )\r\n        \r\n        set juletext[0][0] = BlzCreateFrameByType(\"TEXT\", \"\", framebase, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize( juletext[0][0], 0.03*SIZE, 0.01*SIZE )\r\n        call BlzFrameSetPoint(juletext[0][0], FRAMEPOINT_TOP, framebase, FRAMEPOINT_TOP, 0,-0.04*SIZE) \r\n        call BlzFrameSetText( juletext[0][0], \"300 G\" )\r\n        \r\n        \r\n        //=========Основные предметы=========\r\n        set framebase = BlzCreateFrame(\"QuestButtonBackdropTemplate\", juleback, 0, 0)\r\n        call BlzFrameSetPoint(framebase, FRAMEPOINT_TOPLEFT, juleback, FRAMEPOINT_TOPLEFT, 0.063*SIZE,-0.005*SIZE) \r\n        call BlzFrameSetSize(framebase, 0.2*SIZE, 0.13*SIZE)\r\n\r\n        set cyclB = 1\r\n        loop\r\n            exitwhen cyclB > 2\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > ROW_LIMIT\r\n                call CreateJuleButton( cyclA, cyclB, framebase, (-0.115+(cyclA*0.045))*SIZE, (0.05+(-0.06*cyclB))*SIZE, \"Locked\", \"Defeat the first boss to unlock.\" )\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n            set cyclB = cyclB + 1\r\n        endloop \r\n        \r\n        \r\n        //=========Дополнительные предметы=========\r\n        set juleextra1 = BlzCreateFrame(\"QuestButtonBackdropTemplate\", juleback, 0, 0)\r\n        call BlzFrameSetPoint(juleextra1, FRAMEPOINT_TOPLEFT, juleback, FRAMEPOINT_TOPLEFT, 0.063*SIZE,-0.135*SIZE) \r\n        call BlzFrameSetSize(juleextra1, 0.2*SIZE, 0.07*SIZE)\r\n        \r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > ROW_LIMIT\r\n                set julebool[cyclA][1] = false\r\n                call CreateJuleButton( cyclA, 3, juleextra1, (-0.115+(cyclA*0.045))*SIZE,-0.01*SIZE, \"Locked\", \"Upgrade this store to open.\" )\r\n            set cyclA = cyclA + 1\r\n        endloop \r\n        \r\n        \r\n        //=========Наборные предметы=========\r\n        set juleextra2 = BlzCreateFrame(\"QuestButtonBackdropTemplate\", juleback, 0, 0)\r\n        call BlzFrameSetPoint(juleextra2, FRAMEPOINT_TOPLEFT, juleback, FRAMEPOINT_TOPLEFT, 0.063*SIZE,-0.205*SIZE) \r\n        call BlzFrameSetSize(juleextra2, 0.2*SIZE, 0.07*SIZE)\r\n        \r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > ROW_LIMIT\r\n                set julebool[cyclA][2] = false\r\n                call CreateJuleButton( cyclA, 4, juleextra2, (-0.115+(cyclA*0.045))*SIZE,-0.01*SIZE, \"Locked\", \"Upgrade this store to open.\" )\r\n            set cyclA = cyclA + 1\r\n        endloop \r\n        \r\n        \r\n        //=========Выключение=========\r\n        set framebase = BlzCreateFrameByType(\"BACKDROP\", \"\", juleback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize(framebase, 0.022, 0.022)\r\n        call BlzFrameSetPoint( framebase, FRAMEPOINT_CENTER, juleback, FRAMEPOINT_TOPRIGHT, -0.008, -0.008 )\r\n        call BlzFrameSetTexture(framebase, \"war3mapImported\\\\BTNExit.blp\", 0, true)\r\n        \r\n        set frame = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", juleback, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( frame, 0.025, 0.025 )\r\n        call BlzFrameSetPoint( frame, FRAMEPOINT_CENTER, framebase, FRAMEPOINT_CENTER, 0, 0 )\r\n        \r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, frame, FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function ButtonExitJule)\r\n        \r\n        set trig = null\r\n        set frame = null\r\n        set framebase = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        call TimerStart(CreateTimer(), 0.05, false, function Action)\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}