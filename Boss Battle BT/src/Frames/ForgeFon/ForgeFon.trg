{
  "Id": 50332309,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library ForgeFon requires CorruptedLib, ForgeOtherLib\r\n\r\nglobals\r\n\tframehandle array bgfrgfon\r\n\tframehandle array forgeicon\r\n\tframehandle array forgename\r\n\tframehandle array forgetool\r\n\tframehandle array forgebutchs\r\n\tframehandle forgebut\r\n\tframehandle frgvis\r\n    \r\n    real Event_AfterForge_Real\r\n    item Event_AfterForge_NewItem\r\n    integer Event_AfterForge_ForgedItem\r\n    item Event_AfterForge_ForgedItem_Item\r\n    unit Event_AfterForge_Hero\r\n    \r\n    real Event_BeforeForge_Real\r\n    integer Event_BeforeForge_NewItem\r\n    item Event_BeforeForge_ForgedItem\r\n    unit Event_BeforeForge_Hero\r\nendglobals\r\n\r\nfunction ButtonF takes nothing returns nothing\r\n    local integer i = 3*(GetUnitUserData(udg_hero[GetPlayerId( GetTriggerPlayer() ) + 1])-1)\r\n\tif GetTriggerPlayer() == GetLocalPlayer() then\r\n        if BlzFrameGetText(forgebut) == \"Show\" then\r\n            call BlzFrameSetText(forgebut, \"Hide\")\r\n            if udg_forgeitem[i+1] != null then\r\n                call BlzFrameSetVisible(bgfrgfon[1], true)\r\n            endif\r\n            if udg_forgeitem[i+2] != null then\r\n                call BlzFrameSetVisible(bgfrgfon[2], true)\r\n            endif\r\n            if udg_forgeitem[i+3] != null then\r\n                call BlzFrameSetVisible(bgfrgfon[3], true)\r\n            endif\r\n        else\r\n            call BlzFrameSetText(forgebut, \"Show\")\r\n            call BlzFrameSetVisible(bgfrgfon[1], false)\r\n            call BlzFrameSetVisible(bgfrgfon[2], false)\r\n            call BlzFrameSetVisible(bgfrgfon[3], false)\r\n        endif\r\n\tendif\r\nendfunction\r\n\r\nfunction ForgeAfter takes unit caster, item forgedItem, integer m returns nothing\r\n\tlocal integer k\r\n\tlocal integer id = GetHandleId(forgedItem)\r\n    \r\n\tif m == 'I0C7' and inv( caster, m ) > 0 then\r\n\t\tset k = LoadInteger( udg_hash, id, StringHash( \"frtdk\" ) ) + 1\r\n\t\tcall SaveInteger( udg_hash, id, StringHash( \"frtdk\" ), k )\r\n\t\tcall FortuneDeck( caster, forgedItem )\r\n\tendif\r\n\tif m == 'I03F' and inv( caster, m ) > 0 then\r\n\t\tset k = LoadInteger( udg_hash, id, StringHash( \"snddk\" ) ) + 1\r\n\t\tcall SaveInteger( udg_hash, id, StringHash( \"snddk\" ), k )\r\n\t\tcall Sandro( caster, forgedItem )\r\n\tendif\r\n    if m == 'I0EN' and inv( caster, m ) > 0 then\r\n\t\tset k = LoadInteger( udg_hash, id, StringHash( \"mmco\" ) ) + 1\r\n\t\tcall SaveInteger( udg_hash, id, StringHash( \"mmco\" ), k )\r\n\t\tcall MimicOrb( caster, forgedItem )\r\n\tendif\r\n\tif m == 'I0CA' then\r\n\t\tcall BlzSetItemIntegerFieldBJ( bj_lastCreatedItem, ITEM_IF_NUMBER_OF_CHARGES, 3 )\r\n        call UnitRemoveItem(caster, bj_lastCreatedItem)\r\n        call UnitAddItem(caster, bj_lastCreatedItem)\r\n\tendif\r\n    if m == 'I05H' then\r\n        call BlzSetItemExtendedTooltip( bj_lastCreatedItem, \"|cFFB20080Ditto|r|n\" + BlzGetItemExtendedTooltip(bj_lastCreatedItem) ) // sadtwig\r\n        //call BlzSetItemIconPath( bj_lastCreatedItem, \"|cFFB20080Ditto|r|n\" + BlzGetItemExtendedTooltip(bj_lastCreatedItem) )\r\n    endif\r\n    \r\n    set Event_AfterForge_NewItem = bj_lastCreatedItem\r\n    set Event_AfterForge_ForgedItem = m\r\n    set Event_AfterForge_Hero = caster\r\n    set Event_AfterForge_ForgedItem_Item = forgedItem\r\n    \r\n    set Event_AfterForge_Real = 0.00\r\n    set Event_AfterForge_Real = 1.00\r\n    set Event_AfterForge_Real = 0.00\r\n    \r\n    set caster = null\r\nendfunction\r\n\r\nfunction NoRemoveItem takes integer i returns boolean\r\n    if i == 'I0FH' then\r\n        return false\r\n    endif\r\n    if i == 'I086' then\r\n        return false\r\n    endif\r\n    return true\r\nendfunction\r\n\r\nfunction TakeItem takes unit caster, integer itm, item m returns nothing\r\n    local integer i = GetPlayerId(GetOwningPlayer(caster)) + 1\r\n    \r\n    if m != null then\r\n        if GetItemTypeId(m) == 'I0FH' then\r\n            set udg_FutureBall[i] = itm\r\n            set bj_lastCreatedItem = CreateItem( itm, 0, 0 )\r\n            call BlzSetItemExtendedTooltip( m, words( caster, BlzGetItemDescription(m), \"Future: \", \")|r\", GetItemName(bj_lastCreatedItem) ) ) // sadtwig\r\n            //call BlzSetItemIconPath( m, words( caster, BlzGetItemDescription(m), \"Future: \", \")|r\", GetItemName(bj_lastCreatedItem) ) )\r\n            call RemoveItem(bj_lastCreatedItem)\r\n        elseif UnitInventoryCount(caster) < 6 then\r\n            call UnitAddItem(caster, CreateItem( itm, GetUnitX(caster), GetUnitY(caster) ))\r\n        endif\r\n    elseif UnitInventoryCount(caster) < 6 then\r\n        //bj_lastCreatedItem обязательно!\r\n        set bj_lastCreatedItem = CreateItem( itm, GetUnitX(caster), GetUnitY(caster) )\r\n        call UnitAddItem(caster, bj_lastCreatedItem)\r\n    endif\r\n    set caster = null\r\n    set m = null\r\nendfunction\r\n\r\nfunction ButtonUse takes player p, integer b returns nothing\r\n    local integer k = GetPlayerId(p)\r\n\tlocal integer i = k + 1\r\n\tlocal integer j = k*3\r\n\tlocal integer m = GetItemTypeId(udg_forgelose[i]) \r\n    local integer id = GetHandleId(udg_forgelose[i])\r\n    local integer cyclA\r\n    \r\n\tif UnitHasItem(udg_hero[i], udg_forgelose[i]) then\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 3\r\n            set LastForgeItems[i][cyclA] = udg_forgeitem[j+cyclA]\r\n            call SaveInteger( udg_hash, id, StringHash( \"frg\" + I2S(cyclA) ), 0 )\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        call DestroyEffect( AddSpecialEffect( \"Objects\\\\Spawnmodels\\\\NightElf\\\\NECancelDeath\\\\NECancelDeath.mdl\", GetUnitX( udg_hero[i] ), GetUnitY( udg_hero[i] ) ) )\r\n        \r\n        set Event_BeforeForge_ForgedItem = udg_forgelose[i]\r\n        set Event_BeforeForge_Hero = udg_hero[i]\r\n        set Event_BeforeForge_NewItem = udg_forgeitem[j+b]\r\n        set Event_BeforeForge_Real = 0.00\r\n        set Event_BeforeForge_Real = 1.00\r\n        set Event_BeforeForge_Real = 0.00\r\n        \r\n\t\tif LoadBoolean( udg_hash, GetHandleId(udg_forgelose[i]), StringHash( \"frgdest\" ) ) and NoRemoveItem(GetItemTypeId(udg_forgelose[i])) then\r\n\t\t\tcall stazisst( udg_hero[i], udg_forgelose[i] )\r\n\t\t\tset udg_forgelose[i] = null\r\n\t\tendif\r\n\t\tcall TakeItem(udg_hero[i], udg_forgeitem[j+b], udg_forgelose[i] )\r\n\tendif\r\n\tif p == GetLocalPlayer() then\r\n\t\tcall BlzFrameSetVisible(bgfrgfon[1], false)\r\n\t\tcall BlzFrameSetVisible(bgfrgfon[2], false)\r\n\t\tcall BlzFrameSetVisible(bgfrgfon[3], false)\r\n\t\tcall BlzFrameSetVisible(forgebut, false)\r\n\tendif\r\n\t\r\n\tcall ForgeAfter( udg_hero[i], udg_forgelose[i], m )\r\n\r\n    set p = null\r\nendfunction\r\n\r\nfunction Button1 takes nothing returns nothing\r\n\tcall ButtonUse(GetTriggerPlayer(), 1)\r\nendfunction\r\n\r\nfunction Button2 takes nothing returns nothing\r\n\tcall ButtonUse(GetTriggerPlayer(), 2)\r\nendfunction\r\n\r\nfunction Button3 takes nothing returns nothing\r\n\tcall ButtonUse(GetTriggerPlayer(), 3)\r\nendfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}