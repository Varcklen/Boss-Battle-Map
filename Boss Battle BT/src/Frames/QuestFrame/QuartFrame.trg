{
  "Id": 50332322,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals\r\n    framehandle quartback\r\n    framehandle quartbut\r\n\tframehandle array quartart\r\n    framehandle array quarticon\r\nendglobals\r\n\r\nfunction ButtonExitGuild takes nothing returns nothing\r\n    if GetLocalPlayer() == GetTriggerPlayer() then\r\n        call BlzFrameSetVisible( quartback,false)\r\n\tendif\r\nendfunction\r\n\r\nfunction IsHeroHaveNoQuest takes unit hero returns boolean\r\n    local boolean isHasNoQuest = true\r\n    local integer i\r\n    local integer iEnd\r\n    \r\n    set i = 1\r\n    set iEnd = udg_QuestItemNum\r\n    loop\r\n        exitwhen i > iEnd or isHasNoQuest == false\r\n        if IsHeroHasItem(hero, udg_QuestItem[i]) then\r\n            set isHasNoQuest = false\r\n        endif\r\n        set i = i + 1\r\n    endloop\r\n\r\n    set hero = null\r\n    return isHasNoQuest\r\nendfunction\r\n\r\nfunction QuartBuy takes nothing returns nothing\r\n    local player triggerPlayer = GetTriggerPlayer()\r\n    local integer i = GetPlayerId( triggerPlayer ) + 1\r\n    local unit hero = udg_hero[i]\r\n    local integer cyclA \r\n    local integer cyclAEnd\r\n    local boolean l = false\r\n    \r\n    if GetLocalPlayer() == triggerPlayer then\r\n        call BlzFrameSetVisible( BlzGetTriggerFrame(),false)\r\n\t\tcall BlzFrameSetVisible( BlzGetTriggerFrame(),true)\r\n\tendif\r\n    \r\n    if GetPlayerState(triggerPlayer, PLAYER_STATE_RESOURCE_GOLD) >= 100 and hero != null and UnitInventoryCount(hero) < 6 and IsHeroHaveNoQuest(hero) then\r\n        set cyclA = 1\r\n        set cyclAEnd = udg_QuestItemNum\r\n        loop\r\n            exitwhen cyclA > cyclAEnd\r\n            if quartart[cyclA] == BlzGetTriggerFrame() then\r\n                call BlzFrameSetVisible( quartart[cyclA],false)\r\n                call BlzFrameSetVisible( quarticon[cyclA],false)\r\n                if inv(hero, udg_QuestItem[cyclA]) == 0 then\r\n                    call UnitAddItem( hero, CreateItem( udg_QuestItem[cyclA], GetUnitX(hero), GetUnitY(hero) ) )\r\n                    set l = true\r\n                endif\r\n                set cyclA = cyclAEnd\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        if l then\r\n            set udg_QuestLimit[i] = true\r\n            call SetPlayerState( triggerPlayer, PLAYER_STATE_RESOURCE_GOLD, IMaxBJ( 0, GetPlayerState(triggerPlayer, PLAYER_STATE_RESOURCE_GOLD) - 100 ) )\r\n            if GetLocalPlayer() == triggerPlayer then\r\n                call BlzFrameSetVisible( quartback, false )\r\n            endif\r\n        endif\r\n    endif\r\n    \r\n    set triggerPlayer = null\r\n    set hero = null\r\nendfunction\r\n\r\nfunction Trig_QuartFrame_Actions takes nothing returns nothing\r\n\tlocal trigger trig\r\n    local framehandle frame\r\n    local integer cyclA\r\n    local integer i\r\n    local real scale\r\n    local item it\r\n    local real size = 0\r\n    \r\n    set quartback = BlzCreateFrame(\"QuestButtonBaseTemplate\", BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI,0), 0, 0)\r\n    call BlzFrameSetAbsPoint(quartback, FRAMEPOINT_TOPRIGHT, 0.75, 0.53)\r\n    call BlzFrameSetVisible( quartback, false )\r\n    call BlzFrameSetLevel( quartback, -1 )\r\n    \r\n    set frame = BlzCreateFrameByType(\"TEXT\", \"\", quartback, \"StandartFrameTemplate\", 0)\r\n\tcall BlzFrameSetSize( frame, 0.25, 0.03 )\r\n\tcall BlzFrameSetPoint(frame, FRAMEPOINT_BOTTOMLEFT, quartback, FRAMEPOINT_BOTTOMLEFT, 0.01,0.005) \r\n\tcall BlzFrameSetText( frame, \"|cffffcc00Cost:|r 100 gold|n|cffffcc00You can choose only 1 quest.|r|n|cffffcc00Choose carefully.|r\" )\r\n    \r\n    set frame = BlzCreateFrameByType(\"BACKDROP\", \"\", quartback, \"StandartFrameTemplate\", 0)\r\n    call BlzFrameSetSize(frame, 0.022, 0.022)\r\n    call BlzFrameSetPoint( frame, FRAMEPOINT_CENTER, quartback, FRAMEPOINT_TOPRIGHT, -0.01, -0.01 )\r\n    call BlzFrameSetTexture(frame, \"war3mapImported\\\\BTNExit.blp\", 0, true)\r\n    \r\n    set quartbut = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", quartback, \"ScoreScreenTabButtonTemplate\", 0)\r\n\tcall BlzFrameSetSize( quartbut, 0.025, 0.025 )\r\n\tcall BlzFrameSetPoint( quartbut, FRAMEPOINT_CENTER, frame, FRAMEPOINT_CENTER, 0, 0 )\r\n    \r\n    set trig = CreateTrigger()\r\n\tcall BlzTriggerRegisterFrameEvent(trig, quartbut, FRAMEEVENT_CONTROL_CLICK)\r\n\tcall TriggerAddAction(trig, function ButtonExitGuild)\r\n    \r\n    set cyclA = 1\r\n    set i = 0 \r\n    set scale = 0\r\n    loop\r\n        exitwhen cyclA > udg_QuestItemNum\r\n        set i = i + 1\r\n        if i > 4 then\r\n            set i = 1\r\n            set scale = scale - 0.04\r\n            set size = size + 0.04\r\n        endif\r\n        \r\n        set it = CreateItem(udg_QuestItem[cyclA], 0, 0 )\r\n        \r\n        set quarticon[cyclA] = BlzCreateFrameByType(\"BACKDROP\", \"\", quartback, \"StandartFrameTemplate\", 0)\r\n        call BlzFrameSetSize(quarticon[cyclA], 0.04, 0.04)\r\n        call BlzFrameSetPoint( quarticon[cyclA], FRAMEPOINT_CENTER, quartback, FRAMEPOINT_TOPLEFT, i*0.04, -0.04+scale )\r\n        call BlzFrameSetTexture(quarticon[cyclA], udg_QuestItemString[cyclA], 0, true)\r\n        \r\n        set quartart[cyclA] = BlzCreateFrameByType(\"GLUEBUTTON\", \"\", quartback, \"ScoreScreenTabButtonTemplate\", 0)\r\n        call BlzFrameSetSize( quartart[cyclA], 0.04, 0.04 )\r\n        call BlzFrameSetPoint( quartart[cyclA], FRAMEPOINT_CENTER, quarticon[cyclA], FRAMEPOINT_CENTER, 0, 0 )\r\n        \r\n        set trig = CreateTrigger()\r\n        call BlzTriggerRegisterFrameEvent(trig, quartart[cyclA], FRAMEEVENT_CONTROL_CLICK)\r\n        call TriggerAddAction(trig, function QuartBuy)\r\n        \r\n        call SetStableTool( quartart[cyclA], GetItemName(it), BlzGetItemDescription(it) )\r\n        \r\n        call RemoveItem(it)\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n    \r\n    call BlzFrameSetSize(quartback, 0.2, 0.1+size)\r\n    \r\n    set it = null\r\n\tset trig = null\r\n    set frame = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_QuartFrame takes nothing returns nothing\r\n    set gg_trg_QuartFrame = CreateTrigger(  )\r\n    call TriggerRegisterTimerExpireEvent( gg_trg_QuartFrame, udg_StartTimer )\r\n    call TriggerAddAction( gg_trg_QuartFrame, function Trig_QuartFrame_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}