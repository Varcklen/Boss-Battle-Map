{
  "Id": 50333019,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_PredatorW_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A15N' and combat( GetSpellAbilityUnit(), true, GetSpellAbilityId() )\r\nendfunction\r\n  \r\nfunction PredatorWEnd takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"prdw1\" ) )\r\n    call UnitRemoveAbility( u, 'A15P' )\r\n    call UnitRemoveAbility( u, 'B072' )\r\n    call FlushChildHashtable( udg_hash, id )\r\n\r\n    set u = null\r\nendfunction\r\n\r\nfunction PredatorWCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local integer id1\r\n\tlocal integer lvl = LoadInteger( udg_hash, id, StringHash( \"prdwlvl\" ) )\r\n\tlocal integer count = LoadInteger( udg_hash, id, StringHash( \"prdw\" ) ) + 1\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"prdw\" ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"prdw\" ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"prdwd\" ) )\r\n    local real x = LoadReal( udg_hash, id, StringHash( \"prdwx\" ) )\r\n    local real y = LoadReal( udg_hash, id, StringHash( \"prdwy\" ) )\r\n    local real reduce = LoadReal( udg_hash, id, StringHash( \"prdwr\" ) )\r\n    local real xc = GetUnitX( caster )\r\n    local real yc = GetUnitY( caster )\r\n    local real angle = Atan2( y - yc, x - xc )\r\n    local real NewX = xc + 20 * Cos( angle )\r\n    local real NewY = yc + 20 * Sin( angle )\r\n    local real IfX = ( x - xc ) * ( x - xc )\r\n    local real IfY = ( y - yc ) * ( y - yc )\r\n\tlocal group h = LoadGroupHandle( udg_hash, id, StringHash( \"prdwg\" ) )\r\n\tlocal group g = CreateGroup()\r\n    local unit u\r\n    \r\n    if RectContainsCoords(udg_Boss_Rect, x, y) and count < 200 and SquareRoot( IfX + IfY ) > 50 and GetUnitState( caster, UNIT_STATE_LIFE) > 0.405 and combat( caster, false, 0 ) and GetUnitAbilityLevel(caster, 'A16J') == 0  and GetUnitAbilityLevel(caster, 'A17U') == 0 then\r\n        call SaveInteger( udg_hash, id, StringHash( \"prdw\" ), count )\r\n\t\tcall SetUnitPosition( caster, NewX, NewY )\r\n\t\tcall GroupEnumUnitsInRange( g, NewX, NewY, 142, null )\r\n\t\tloop\r\n\t\t\tset u = FirstOfGroup(g)\r\n\t\t\texitwhen u == null\r\n\t\t\tif unitst( u, caster, \"enemy\" ) and not(IsUnitInGroup(u, h)) then\r\n\t\t\t\tcall UnitDamageTarget( caster, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS )\r\n\t\t\t\tcall GroupAddUnit(h,u)\r\n\t\t\tendif\r\n\t\t\tcall GroupRemoveUnit(g,u)\r\n\t\tendloop\r\n\t\tcall SaveGroupHandle( udg_hash, id, StringHash( \"prdwg\" ), h )\r\n    else\r\n    \tcall UnitAddAbility( caster, 'A15P' )\r\n    \r\n        set id1 = GetHandleId( caster )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"prdw1\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id1, StringHash( \"prdw1\" ), CreateTimer() )\r\n        endif\r\n        set id1 = GetHandleId( LoadTimerHandle( udg_hash, id1, StringHash( \"prdw1\" ) ) ) \r\n        call SaveUnitHandle( udg_hash, id1, StringHash( \"prdw1\" ), caster )\r\n        call SaveReal( udg_hash, GetHandleId( caster ), StringHash( \"prdw1\" ), reduce )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( caster ), StringHash( \"prdw1\" ) ), 15, false, function PredatorWEnd )\r\n   \r\n    \tcall DestroyEffect( AddSpecialEffect( \"Objects\\\\Spawnmodels\\\\Naga\\\\NagaDeath\\\\NagaDeath.mdl\", GetUnitX(caster), GetUnitY(caster) ) )\r\n        call SetUnitPathing( caster, true )\r\n        call UnitRemoveAbility( caster, 'Avul' )\r\n        call PauseUnit( caster, false )\r\n    \tcall pausest( caster, -1 )\r\n        call UnitRemoveAbility( caster, 'A0DV' )\r\n        call RemoveUnit( dummy )\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    endif\r\n    \r\n    call DestroyGroup( g )\r\n    set u = null\r\n\tset g = null\r\n\tset h = null\r\n    set caster = null\r\nendfunction\r\n\r\nfunction Trig_PredatorW_Actions takes nothing returns nothing\r\n    local integer id \r\n    local integer lvl\r\n    local unit caster\r\n    local unit target\r\n    local real dmg\r\n    local real x\r\n    local real y\r\n    local real reduce\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set lvl = udg_Level\r\n\tset x = GetSpellTargetX()\r\n        set y = GetSpellTargetY()\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A15N'), caster, 64, 90, 10, 1.5 )\r\n        set x = GetUnitX( caster ) + GetRandomReal( -650, 650 )\r\n        set y = GetUnitY( caster ) + GetRandomReal( -650, 650 )\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n\t\tset x = GetSpellTargetX()\r\n        set y = GetSpellTargetY()\r\n    endif  \r\n\r\n    if udg_combatlogic[GetPlayerId(GetOwningPlayer( caster )) + 1] and not( RectContainsCoords(udg_Boss_Rect, x, y) ) then\r\n        set caster = null\r\n        set target = null\r\n        return\r\n    endif\r\n\r\n    set id = GetHandleId( caster )\r\n    set dmg = (80 + ( 40 * lvl )) * GetUnitSpellPower(caster)\r\n    set reduce = (0.05*lvl)+0.04\r\n    \r\n    if GetUnitAbilityLevel( caster, 'A0DV' ) == 0 then\r\n            call pausest( caster, 1 )\r\n    endif\r\n\tcall UnitAddAbility( caster, 'Avul' )\r\n    call UnitAddAbility( caster, 'A0DV' )\r\n    \r\n    call dummyspawn( caster, 0, 'A0N5', 0, 0 )\r\n    call SetUnitPathing( caster, false )\r\n    call SetUnitFacing( caster, bj_RADTODEG * Atan2(y - GetUnitY(caster), x - GetUnitX(caster) ) )\r\n\r\n    \tif LoadTimerHandle( udg_hash, id, StringHash( \"prdw\" ) ) == null  then\r\n    \t\tcall SaveTimerHandle( udg_hash, id, StringHash( \"prdw\" ), CreateTimer() )\r\n   \tendif\r\n    \tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"prdw\" ) ) ) \r\n    \tcall SaveUnitHandle( udg_hash, id, StringHash( \"prdw\" ), caster )\r\n    \tcall SaveUnitHandle( udg_hash, id, StringHash( \"prdwd\" ), bj_lastCreatedUnit )\r\n\tcall SaveReal( udg_hash, id, StringHash( \"prdwx\" ), x )\r\n\tcall SaveReal( udg_hash, id, StringHash( \"prdwy\" ), y )\r\n    \tcall SaveReal( udg_hash, id, StringHash( \"prdw\" ), dmg )\r\n    \tcall SaveReal( udg_hash, id, StringHash( \"prdwr\" ), reduce )\r\n\tcall SaveInteger( udg_hash, id, StringHash( \"prdwlvl\" ), lvl )\r\n\tcall SaveGroupHandle( udg_hash, id, StringHash( \"prdwg\" ), CreateGroup() )\r\n    \tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( caster ), StringHash( \"prdw\" ) ), 0.02, true, function PredatorWCast )\r\n\r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_PredatorW takes nothing returns nothing\r\n    set gg_trg_PredatorW = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_PredatorW, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_PredatorW, Condition( function Trig_PredatorW_Conditions ) )\r\n    call TriggerAddAction( gg_trg_PredatorW, function Trig_PredatorW_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}