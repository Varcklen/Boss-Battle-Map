{
  "Id": 50333001,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals\r\n    constant integer BEORN_R_DURATION = 20\r\n    constant integer BEORN_R_TICK = 1\r\n    constant integer BEORN_R_DAMAGE_FIRST_LEVEL = 10\r\n    constant integer BEORN_R_DAMAGE_LEVEL_BONUS = 6\r\n    \r\n    constant real BEORN_R_DAMAGE_BONUS_ALTERNATIVE = 0.5\r\n    \r\n    constant string BEORN_R_ANIMATION = \"Abilities\\\\Spells\\\\Other\\\\Stampede\\\\StampedeMissileDeath.mdl\"\r\nendglobals\r\n\r\nfunction Trig_BeornR_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A0B9'\r\nendfunction\r\n\r\nfunction BeornRCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"berr\" ) )\r\n    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"berr\" ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"berrd\" ) )\r\n    \r\n    if GetUnitState( dummy, UNIT_STATE_LIFE) > 0.405 and GetUnitState( target, UNIT_STATE_LIFE) > 0.405 and GetUnitAbilityLevel( target, 'A0PF') > 0 then\r\n        call UnitDamageTarget( dummy, target, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS )\r\n    else\r\n        call UnitRemoveAbility( target, 'A0PF' )\r\n        call UnitRemoveAbility( target, 'B001' )\r\n        call RemoveUnit( dummy )\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    endif\r\n    \r\n    set target = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction BeornR_Alternative takes unit caster, unit target, real duration, real damage returns nothing\r\n    local unit oldTarget = LoadUnitHandle( udg_hash, GetHandleId(caster), StringHash( \"berrt\" ) )\r\n    local integer id\r\n    \r\n    if oldTarget != null then\r\n        call UnitRemoveAbility( oldTarget, 'A0PF' )\r\n        call UnitRemoveAbility( oldTarget, 'B001' )\r\n        call RemoveSavedHandle( udg_hash, GetHandleId( caster ), StringHash( \"berrt\" ) )\r\n    endif\r\n    \r\n    set damage = damage + (damage*BEORN_R_DAMAGE_BONUS_ALTERNATIVE)\r\n    \r\n    call dummyspawn( caster, 0, 0, 'A0N5', 0 )\r\n    call bufallst(caster, target, 'A0PF', 0, 0, 0, 0, 'B001', \"berrc\", duration )\r\n    \r\n    set id = InvokeTimerWithUnit( target, \"berr\", BEORN_R_TICK, true, function BeornRCast )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"berrd\" ), bj_lastCreatedUnit )\r\n    call SaveUnitHandle( udg_hash, GetHandleId(caster), StringHash( \"berrt\" ), target )\r\n    call SaveReal( udg_hash, id, StringHash( \"berr\" ), damage )\r\n    \r\n    set caster = null\r\n    set target = null\r\n    set oldTarget = null\r\nendfunction\r\n\r\nfunction BeornR takes unit caster, unit target, real duration, real damage returns nothing\r\n    local integer id\r\n\r\n    call dummyspawn( caster, 0, 0, 'A0N5', 0 )\r\n    call bufallst(caster, target, 'A0PF', 0, 0, 0, 0, 'B001', \"berrc\", duration )\r\n    \r\n    set id = InvokeTimerWithUnit( target, \"berr\", BEORN_R_TICK, true, function BeornRCast )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"berrd\" ), bj_lastCreatedUnit )\r\n    call SaveReal( udg_hash, id, StringHash( \"berr\" ), damage )\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\nfunction Trig_BeornR_Actions takes nothing returns nothing \r\n    local unit caster\r\n    local unit target\r\n    local integer lvl\r\n    local integer id\r\n    local real dmg\r\n    local real t\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n        set t = udg_Time\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 300, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        set t = BEORN_R_DURATION\r\n        call textst( udg_string[0] + GetObjectName('A0B9'), caster, 64, 90, 10, 1.5 )\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set t = BEORN_R_DURATION\r\n    endif\r\n    set t = timebonus(caster, t)\r\n    \r\n    set dmg = (BEORN_R_DAMAGE_FIRST_LEVEL + ( BEORN_R_DAMAGE_LEVEL_BONUS * lvl )) * GetUnitSpellPower(caster)\r\n    \r\n    //call BJDebugMsg(\"aspect1: \" + B2S(IsAspectActive[udg_HeroNum[GetUnitUserData(caster)]][1]))\r\n    //call BJDebugMsg(\"aspect2: \" + B2S(IsAspectActive[udg_HeroNum[GetUnitUserData(caster)]][2]))\r\n    //call BJDebugMsg(\"aspect3: \" + B2S(IsAspectActive[udg_HeroNum[GetUnitUserData(caster)]][3]))\r\n    if Aspects_IsHeroAspectActive( caster, ASPECT_03 ) then\r\n        call BeornR_Alternative( caster, target, t, dmg )\r\n    else\r\n        call BeornR( caster, target, t, dmg )\r\n    endif\r\n    \r\n    call DestroyEffect( AddSpecialEffectTarget( BEORN_R_ANIMATION, target, \"chest\" ) )\r\n    \r\n     set caster = null\r\n     set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_BeornR takes nothing returns nothing\r\n    set gg_trg_BeornR = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_BeornR, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_BeornR, Condition( function Trig_BeornR_Conditions ) )\r\n    call TriggerAddAction( gg_trg_BeornR, function Trig_BeornR_Actions )\r\nendfunction\r\n\r\nscope BeornR initializer Triggs\r\n    private function DeleteBuff_Conditions takes nothing returns boolean\r\n        return GetUnitAbilityLevel( Event_DeleteBuff_Unit, 'A0PF') > 0\r\n    endfunction\r\n    \r\n    private function DeleteBuff takes nothing returns nothing\r\n        local unit hero = Event_DeleteBuff_Unit\r\n        \r\n        call UnitRemoveAbility( hero, 'A0PF' )\r\n        call UnitRemoveAbility( hero, 'B001' )\r\n        \r\n        set hero = null\r\n    endfunction\r\n\r\n    private function Triggs takes nothing returns nothing\r\n        call CreateEventTrigger( \"Event_DeleteBuff_Real\", function DeleteBuff, function DeleteBuff_Conditions )\r\n    endfunction\r\nendscope\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}