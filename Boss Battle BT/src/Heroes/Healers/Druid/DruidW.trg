{
  "Id": 50333291,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals\r\n    constant integer DRUID_W_DURATION = 20\r\n    constant integer DRUID_W_HEAL_FIRST_LEVEL = 25\r\n    constant integer DRUID_W_HEAL_LEVEL_BONUS = 50\r\n    \r\n    constant integer DRUID_W_AREA_ALTERNATIVE = 400\r\nendglobals\r\n\r\nfunction Trig_DruidW_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId( ) == 'A0JC'\r\nendfunction\r\n\r\nfunction DruidW_Alternative takes unit caster, unit target, real duration, integer level returns nothing\r\n    local group g = CreateGroup()\r\n    local unit u\r\n    \r\n    call GroupEnumUnitsInRange( g, GetUnitX( target ), GetUnitY( target ), DRUID_W_AREA_ALTERNATIVE, null )\r\n    loop\r\n        set u = FirstOfGroup(g)\r\n        exitwhen u == null\r\n        if unitst( u, caster, TARGET_ALLY ) then\r\n            call bufallst( caster, u, 'A0U8', 'A0JD', 0, 0, 0, 'B005', \"druw\", duration )\r\n            call SetUnitAbilityLevel( u, 'A0JD', level )\r\n        endif\r\n        call GroupRemoveUnit(g,u)\r\n    endloop\r\n\r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\nfunction DruidW takes unit caster, unit target, real duration, integer level, real heal returns nothing\r\n    call healst( caster, target, heal )\r\n\r\n    call bufallst( caster, target, 'A0U8', 'A0JD', 0, 0, 0, 'B005', \"druw\", duration )\r\n    call SetUnitAbilityLevel( target, 'A0JD', level )\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\nfunction Trig_DruidW_Actions takes nothing returns nothing\r\n    local unit caster\r\n    local unit target\r\n    local integer lvl\r\n    local real t\r\n    local real heal\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n        set t = udg_Time\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 900, \"ally\", \"\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A0JC'), caster, 64, 90, 10, 1.5 )\r\n        set t = DRUID_W_DURATION\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set t = DRUID_W_DURATION\r\n    endif\r\n    \r\n    set heal = DRUID_W_HEAL_FIRST_LEVEL + ( DRUID_W_HEAL_LEVEL_BONUS * lvl )\r\n    \r\n    if Aspects_IsHeroAspectActive(caster, ASPECT_02 ) then\r\n        call DruidW_Alternative(caster,  target, t, lvl )\r\n    else\r\n        call DruidW(caster,  target, t, lvl, heal )\r\n    endif\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_DruidW takes nothing returns nothing\r\n    set gg_trg_DruidW = CreateTrigger( )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_DruidW, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_DruidW, Condition( function Trig_DruidW_Conditions ) )\r\n    call TriggerAddAction( gg_trg_DruidW, function Trig_DruidW_Actions )\r\nendfunction\r\n\r\nscope DruidW initializer Triggs\r\n    private function DeleteBuff_Conditions takes nothing returns boolean\r\n        return GetUnitAbilityLevel( Event_DeleteBuff_Unit, 'A0U8') > 0\r\n    endfunction\r\n    \r\n    private function DeleteBuff takes nothing returns nothing\r\n        local unit hero = Event_DeleteBuff_Unit\r\n\r\n        call UnitRemoveAbility( hero, 'A0U8' )\r\n        call UnitRemoveAbility( hero, 'A0JD' )\r\n        call UnitRemoveAbility( hero, 'B005' )\r\n        \r\n        set hero = null\r\n    endfunction\r\n\r\n    private function Triggs takes nothing returns nothing\r\n        call CreateEventTrigger( \"Event_DeleteBuff_Real\", function DeleteBuff, function DeleteBuff_Conditions )\r\n    endfunction\r\nendscope\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}