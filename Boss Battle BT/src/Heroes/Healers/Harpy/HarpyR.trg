{
  "Id": 50333308,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope HarpyR initializer init\r\n\r\n\tglobals\r\n\t\tprivate constant integer ABILITY_ID = 'A0UD'\r\n\t\t\r\n\t\tprivate constant integer RESOURCE_RESTORE_INITIAL = 10\r\n\t\tprivate constant integer RESOURCE_RESTORE_PER_LEVEL = 10\r\n\t\t\r\n\t\tprivate constant string ANIMATION = \"Abilities\\\\Spells\\\\Human\\\\Resurrect\\\\ResurrectCaster.mdl\"\r\n\tendglobals\r\n\r\n\tprivate function condition takes nothing returns boolean\r\n\t    return GetSpellAbilityId() == ABILITY_ID and combat( GetSpellAbilityUnit(), true, GetSpellAbilityId() )\r\n\tendfunction\r\n\t\r\n\tprivate function HarpyREnd takes nothing returns nothing\r\n\t    local integer id = GetHandleId( GetExpiredTimer() )\r\n\t    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"harpy_r\" ) )\r\n\t    local real resourceRestore = LoadReal( udg_hash, id, StringHash( \"harpy_r_restore\" ) )\r\n\t    \r\n\t    /*call BJDebugMsg(\"resourceRestore: \" + R2S(resourceRestore))\r\n\t    call BJDebugMsg(\"target: \" + GetUnitName(target))\r\n\t    */\r\n\t    if combat( target, false, 0 ) and IsUnitDead(target) then\r\n\t    \t//call BJDebugMsg(\"res!\")\r\n\t        call ReviveHero( target, GetUnitX( target ), GetUnitY( target ), true )\r\n\t        call ShowUnitShow( target )\r\n\t        if IsUnitDead(target) then\r\n\t            call BJDebugMsg(\"Error! HarpyREnd: Ressurection unseccesful!\")\r\n\t        else\r\n\t            call PauseUnit( target, false )\r\n\t            call SetUnitState( target, UNIT_STATE_LIFE, GetUnitState( target, UNIT_STATE_MAX_LIFE) * resourceRestore )\r\n\t            call SetUnitState( target, UNIT_STATE_MANA, GetUnitState( target, UNIT_STATE_MAX_MANA) * resourceRestore )\r\n\t        endif\r\n\t    endif\r\n\t    call DeathSystem_SetUnkillable(target, false)\r\n\t    \r\n\t    call FlushChildHashtable( udg_hash, id )\r\n\t    set target = null\r\n\tendfunction\r\n\t\r\n\tprivate function HarpyRCast takes nothing returns nothing\r\n\t    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n\t    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"harpy_r_delay\" ) )\r\n\t    local real resourceRestore = LoadReal( udg_hash, id, StringHash( \"harpy_r_delay_restore\" ) )\r\n\t    local effect particle\r\n\t\r\n\t\tcall FlushChildHashtable( udg_hash, id )\r\n\t\r\n\t    if combat( target, false, 0 ) then\r\n\t    \tset particle = AddSpecialEffect( ANIMATION,  GetUnitX( target ), GetUnitY( target ) )\r\n\t    \tcall BlzSetSpecialEffectYaw( particle, Deg2Rad(270) )\r\n\t        call DestroyEffect( particle )\r\n\t        \r\n\t        /*call BJDebugMsg(\"res start!\")\r\n\t        call BJDebugMsg(\"resourceRestore: \" + R2S(resourceRestore))\r\n\t    \tcall BJDebugMsg(\"target: \" + GetUnitName(target))*/\r\n\t        set id = InvokeTimerWithUnit( target, \"harpy_r\", 3, false, function HarpyREnd )\r\n\t        call SaveReal( udg_hash, id, StringHash( \"harpy_r_restore\" ), resourceRestore )\r\n\t        \r\n\t        call DeathSystem_SetUnkillable(target, true)\r\n\t        \r\n\t        call KillUnit( target )\r\n\t    endif\r\n\t    \r\n\t    set particle = null\r\n\t    set target = null\r\n\tendfunction   \r\n\t\r\n\tprivate function action takes nothing returns nothing\r\n\t    local integer id \r\n\t    local unit caster\r\n\t    local unit target\r\n\t    local integer lvl\r\n\t    local real resourceRestore\r\n\t    \r\n\t    if CastLogic() then\r\n\t        set caster = udg_Caster\r\n\t        set target = udg_Target\r\n\t        set lvl = udg_Level\r\n\t    elseif RandomLogic() then\r\n\t        set caster = udg_Caster\r\n\t        set target = randomtarget( caster, 900, \"ally\", \"hero\", \"\", \"\", \"\" )\r\n\t        set lvl = udg_Level\r\n\t        call textst( udg_string[0] + GetObjectName(ABILITY_ID), caster, 64, 90, 10, 1.5 )\r\n\t        if target == null then\r\n\t            set caster = null\r\n\t            return\r\n\t        endif\r\n\t    else\r\n\t        set caster = GetSpellAbilityUnit()\r\n\t        set target = GetSpellTargetUnit()\r\n\t        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n\t    endif\r\n\t    \r\n\t    set resourceRestore = (RESOURCE_RESTORE_INITIAL + ( RESOURCE_RESTORE_PER_LEVEL * lvl )) * 0.01\r\n\t    \r\n\t    //call UnitAddAbility( target, 'A0EX' )\r\n\t\r\n\t\tset id = InvokeTimerWithUnit( target, \"harpy_r_delay\", 0.01, false, function HarpyRCast )\r\n\t    call SaveReal( udg_hash, id, StringHash( \"harpy_r_delay_restore\" ), resourceRestore )\r\n\t    \r\n\t    set caster = null\r\n\t    set target = null\r\n\tendfunction\r\n\t\r\n\t//===========================================================================\r\n\tprivate function init takes nothing returns nothing\r\n\t    set gg_trg_HarpyR = CreateNativeEvent( EVENT_PLAYER_UNIT_SPELL_EFFECT, function action, function condition )\r\n\tendfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}