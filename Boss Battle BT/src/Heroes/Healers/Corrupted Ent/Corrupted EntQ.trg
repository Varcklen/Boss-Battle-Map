{
  "Id": 50333322,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope CorruptedEntQ initializer init\r\n\r\n    globals\r\n        private constant integer ID_ABILITY = 'A0OE'\r\n    \r\n        private constant integer AREA = 200\r\n        private constant integer HEAL_FIRST_LEVEL = 50\r\n        private constant integer HEAL_LEVEL_BONUS = 25\r\n        private constant integer DAMAGE_FIRST_LEVEL = 0\r\n        private constant integer DAMAGE_LEVEL_BONUS = 25\r\n        public constant integer CHARGE_LIMIT = 3\r\n        private constant integer DELAY = 2\r\n        \r\n        private constant string BLOOM_EFFECT = \"Objects\\\\Spawnmodels\\\\Undead\\\\CryptFiendEggsack\\\\CryptFiendEggsack.mdl\"\r\n        private constant string EXPLODE_EFFECT = \"war3mapImported\\\\ArcaneExplosion.mdx\"\r\n        \r\n        private constant real ALT_DELAY = 0.1\r\n        \r\n        real Event_Corrupted_End_Q_Real\r\n        unit Event_Corrupted_End_Q_Unit\r\n        unit Event_Corrupted_End_Q_Caster\r\n    endglobals\r\n\r\n    function Trig_Corrupted_EntQ_Conditions takes nothing returns boolean\r\n        return GetSpellAbilityId() == ID_ABILITY\r\n    endfunction\r\n    \r\n    private function Explode takes unit caster, real x, real y, real damage, real heal returns nothing\r\n        local group g = CreateGroup()\r\n        local unit u\r\n    \r\n        call GroupEnumUnitsInRange( g, x, y, AREA, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if unitst( u, caster, TARGET_ENEMY ) and damage > 0 then\r\n                call UnitTakeDamage( caster, u, damage, DAMAGE_TYPE_MAGIC )\r\n            elseif unitst( u, caster, TARGET_ALLY )  then\r\n                call healst(caster, u , heal)\r\n            endif\r\n            \r\n            set Event_Corrupted_End_Q_Caster = caster\r\n            set Event_Corrupted_End_Q_Unit = u\r\n            \r\n            set Event_Corrupted_End_Q_Real = 0.00\r\n            set Event_Corrupted_End_Q_Real = 1.00\r\n            set Event_Corrupted_End_Q_Real = 0.00\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n        \r\n        call GroupClear( g )\r\n        call DestroyGroup( g )\r\n        set u = null\r\n        set g = null\r\n        set caster = null\r\n    endfunction\r\n\r\n    private function Corrupted_EntQExplode takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local effect bloom = LoadEffectHandle( udg_hash, id, StringHash( \"entq\" ) )\r\n        local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"entqc\" ) )\r\n        local real damage = LoadReal( udg_hash, id, StringHash( \"entqdmg\" ) )\r\n        local real heal = LoadReal( udg_hash, id, StringHash( \"entqhl\" ) )\r\n        local real x = BlzGetLocalSpecialEffectX( bloom )\r\n        local real y = BlzGetLocalSpecialEffectY( bloom )\r\n\r\n        call DestroyEffect( AddSpecialEffect( EXPLODE_EFFECT, x, y ) )\r\n        call Explode(caster, x, y, damage, heal)\r\n        call DestroyEffect(bloom)\r\n        call FlushChildHashtable( udg_hash, id )\r\n        \r\n        set bloom = null\r\n        set caster = null\r\n    endfunction\r\n\r\n    private function Corrupted_EntQ_Alternative takes unit caster, real x, real y, real heal returns nothing\r\n        local effect bloom\r\n        local integer id\r\n    \r\n        set bloom = AddSpecialEffect(BLOOM_EFFECT, x, y)\r\n        set id = InvokeTimerWithEffect( bloom, \"entq\", ALT_DELAY, false, function Corrupted_EntQExplode )\r\n        call SaveUnitHandle(udg_hash, id, StringHash(\"entqc\"), caster )\r\n        call SaveReal(udg_hash, id, StringHash(\"entqdmg\"), 0 )\r\n        call SaveReal(udg_hash, id, StringHash(\"entqhl\"), heal )\r\n        \r\n        set caster = null\r\n        set bloom = null\r\n    endfunction\r\n\r\n    private function Corrupted_EntQ takes unit caster, real x, real y, real damage, real heal returns nothing\r\n        local effect bloom\r\n        local integer id\r\n    \r\n        set bloom = AddSpecialEffect(BLOOM_EFFECT, x, y)\r\n        set id = InvokeTimerWithEffect( bloom, \"entq\", DELAY, false, function Corrupted_EntQExplode )\r\n        call SaveUnitHandle(udg_hash, id, StringHash(\"entqc\"), caster )\r\n        call SaveReal(udg_hash, id, StringHash(\"entqdmg\"), damage )\r\n        call SaveReal(udg_hash, id, StringHash(\"entqhl\"), heal )\r\n        \r\n        set caster = null\r\n        set bloom = null\r\n    endfunction\r\n\r\n    function Trig_Corrupted_EntQ_Actions takes nothing returns nothing\r\n        local unit caster\r\n        local integer lvl\r\n        local real x\r\n        local real y\r\n        local integer damage\r\n        local integer heal\r\n        \r\n        if CastLogic() then\r\n            set caster = udg_Target\r\n            set lvl = udg_Level\r\n            set x = GetLocationX( GetSpellTargetLoc() )\r\n            set y = GetLocationY( GetSpellTargetLoc() )\r\n        elseif RandomLogic() then\r\n            set caster = udg_Caster\r\n            set lvl = udg_Level\r\n            set x = GetUnitX( caster ) + GetRandomReal( -650, 650 )\r\n            set y = GetUnitY( caster ) + GetRandomReal( -650, 650 )\r\n            call textst( udg_string[0] + GetObjectName(ID_ABILITY), caster, 64, 90, 10, 1.5 )\r\n        else\r\n            set caster = GetSpellAbilityUnit()\r\n            set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n            set x = GetLocationX( GetSpellTargetLoc() )\r\n            set y = GetLocationY( GetSpellTargetLoc() )\r\n        endif\r\n        \r\n        set damage = DAMAGE_FIRST_LEVEL + (lvl * DAMAGE_LEVEL_BONUS)\r\n        set heal = HEAL_FIRST_LEVEL + (lvl * HEAL_LEVEL_BONUS)\r\n        \r\n        if Aspects_IsHeroAspectActive(caster, ASPECT_01 ) then\r\n            call Corrupted_EntQ_Alternative( caster, x, y, heal )\r\n        else\r\n            call Corrupted_EntQ( caster, x, y, damage, heal )\r\n        endif\r\n\r\n        set caster = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_Corrupted_EntQ = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_Corrupted_EntQ, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n        call TriggerAddCondition( gg_trg_Corrupted_EntQ, Condition( function Trig_Corrupted_EntQ_Conditions ) )\r\n        call TriggerAddAction( gg_trg_Corrupted_EntQ, function Trig_Corrupted_EntQ_Actions )\r\n    endfunction\r\n\r\nendscope\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}