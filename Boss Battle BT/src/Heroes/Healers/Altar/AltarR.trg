{
  "Id": 50333320,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_AltarR_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A12B'\r\nendfunction\r\n\r\nfunction AtlarREnd takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"altr\" ) )\r\n    \r\n    call UnitRemoveAbility( caster, 'A12Z' )\r\n    call UnitRemoveAbility( caster, 'A0FZ' )\r\n    call UnitRemoveAbility( caster, 'A0PB' )\r\n    call UnitRemoveAbility( caster, 'B08C' )\r\n    call FlushChildHashtable( udg_hash, id )\r\n    \r\n    set caster = null\r\nendfunction\r\n\r\nfunction AtlarRCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local real counter = LoadReal( udg_hash, id, StringHash( \"altr\" ) ) - 1\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"altrc\" ) )\r\n    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"altr\" ) )\r\n    local real heal = LoadReal( udg_hash, id, StringHash( \"altrh\" ) )\r\n    \r\n    if GetUnitState( target, UNIT_STATE_LIFE) > 0.405 then\r\n        call healst( caster, target, heal )\r\n    endif\r\n    \r\n    if counter > 0 then\r\n        call SaveReal( udg_hash, id, StringHash( \"altr\" ), counter )\r\n    else\r\n        call UnitRemoveAbility( target, 'A12Z' )\r\n        call UnitRemoveAbility( target, 'A0FZ' )\r\n        call UnitRemoveAbility( target, 'A0PB' )\r\n        call UnitRemoveAbility( target, 'B08C' )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n        call FlushChildHashtable( udg_hash, id ) \r\n    endif\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\nfunction Trig_AltarR_Actions takes nothing returns nothing\r\n    local unit caster\r\n    local unit target\r\n    local integer lvl\r\n    local real heal\r\n    local integer id\r\n    local real t\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n        set t = udg_Time\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 900, \"ally\", \"notcaster\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A12B'), caster, 64, 90, 10, 1.5 )\r\n        set t = 15\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set t = 15\r\n    endif\r\n    set t = timebonus(caster, t)\r\n    set heal = 10 + ( 5 * lvl )\r\n    \r\n    if GetUnitAbilityLevel( caster, 'A12W') > 0 then\r\n        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Items\\\\AIil\\\\AIilTarget.mdl\", GetUnitX( target ), GetUnitY( target) ) )\r\n        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Items\\\\AIil\\\\AIilTarget.mdl\", GetUnitX( caster ), GetUnitY( caster) ) )\r\n        \r\n        set id = GetHandleId( target )\r\n        call UnitAddAbility( target, 'A12Z' )\r\n        call UnitAddAbility( target, 'A0FZ' )\r\n        call UnitAddAbility( target, 'A0PB' )\r\n        call SetUnitAbilityLevel( target, 'A0FZ', lvl )\r\n        call SetUnitAbilityLevel( target, 'A0PB', lvl )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"altr\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"altr\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle(udg_hash, id, StringHash( \"altr\" ) ) )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"altr\" ), target )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"altr\" ) ), t, false, function AtlarREnd )\r\n        \r\n        set id = GetHandleId( caster )\r\n        call UnitAddAbility( caster, 'A12Z' )\r\n        call UnitAddAbility( caster, 'A0FZ' )\r\n        call UnitAddAbility( caster, 'A0PB' )\r\n        call SetUnitAbilityLevel( caster, 'A0FZ', lvl )\r\n        call SetUnitAbilityLevel( caster, 'A0PB', lvl )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"altr\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"altr\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle(udg_hash, id, StringHash( \"altr\" ) ) )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"altr\" ), caster )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( caster ), StringHash( \"altr\" ) ), t, false, function AtlarREnd )\r\n        \r\n    else\r\n        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Items\\\\AIil\\\\AIilTarget.mdl\", GetUnitX( target ), GetUnitY( target) ) )\r\n        set id = GetHandleId( target )\r\n        call UnitAddAbility( target, 'A12Z' )\r\n        call UnitAddAbility( target, 'A0PB' )\r\n        call SetUnitAbilityLevel( target, 'A0PB', lvl )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"altr\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"altr\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle(udg_hash, id, StringHash( \"altr\" ) ) )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"altr\" ), target )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"altrc\" ), caster )\r\n        call SaveReal( udg_hash, id, StringHash( \"altr\" ), t )\r\n        call SaveReal( udg_hash, id, StringHash( \"altrh\" ), heal )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"altr\" ) ), 1, true, function AtlarRCast )\r\n        \r\n        call SetUnitState( caster, UNIT_STATE_LIFE, RMaxBJ(0,GetUnitState( caster, UNIT_STATE_LIFE) - (95+(5*lvl)) ))\r\n    endif\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_AltarR takes nothing returns nothing\r\n    set gg_trg_AltarR = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_AltarR, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_AltarR, Condition( function Trig_AltarR_Conditions ) )\r\n    call TriggerAddAction( gg_trg_AltarR, function Trig_AltarR_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}