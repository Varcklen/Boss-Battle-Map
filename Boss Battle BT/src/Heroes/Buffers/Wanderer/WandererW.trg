{
  "Id": 50332987,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_WandererW_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A0JG'\r\nendfunction\r\n\r\nfunction WandererWWawe  takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local integer counter = LoadInteger( udg_hash, id, StringHash( \"wndww\" ) ) \r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"wndww\" ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"wndwwcs\" ) )\r\n    local unit u\r\n    local real NewX = GetUnitX( dummy ) + 20 * Cos( 0.017 * GetUnitFacing( dummy ) )\r\n    local real NewY = GetUnitY( dummy ) + 20 * Sin( 0.017 * GetUnitFacing( dummy ) )\r\n    local real sh = LoadReal( udg_hash, id, StringHash( \"wndww\" ) )\r\n    local group nodmg = LoadGroupHandle( udg_hash, GetHandleId( dummy ), StringHash( \"wndwwg\" ) )\r\n    local group g = CreateGroup()\r\n\r\n    if counter >= 50 or GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n        call RemoveUnit( dummy )\r\n        call GroupClear( nodmg )\r\n        call DestroyEffect( AddSpecialEffect(\"Abilities\\\\Spells\\\\Items\\\\AIil\\\\AIilTarget.mdl\", GetUnitX(dummy), GetUnitY(dummy)) )\r\n        call SaveGroupHandle( udg_hash, GetHandleId( dummy ), StringHash( \"wndwwg\" ), nodmg )\r\n        call DestroyGroup( nodmg )\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        call SetUnitPosition( dummy, NewX, NewY )\r\n        call SaveInteger( udg_hash, id, StringHash( \"wndww\" ), counter + 1)\r\n        call GroupEnumUnitsInRange( g, GetUnitX( dummy ), GetUnitY( dummy ), 100, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if unitst( u, caster, \"ally\" ) and not( IsUnitInGroup( u, nodmg ) ) then\r\n\t\t\t\tcall shield( caster, u, sh, 60 )\r\n                call GroupAddUnit( nodmg, u )\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n        call SaveGroupHandle( udg_hash, GetHandleId( dummy ), StringHash( \"wndwwg\" ), nodmg )\r\n    endif\r\n    \r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set dummy = null\r\n    set caster = null\r\nendfunction\r\n\r\nfunction WandererWCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local real counter = LoadReal( udg_hash, id, StringHash( \"wndw2\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"wndw\" ) )\r\n    local real sh = LoadReal( udg_hash, id, StringHash( \"wndws\" ) )\r\n    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"wndw\" ) )\r\n    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"wndwc\" ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"wndw1\" ) )\r\n    local integer id1\r\n    local integer cyclA\r\n    \r\n    if GetUnitState( target, UNIT_STATE_LIFE) > 0.405 then\r\n        call UnitDamageTarget( dummy, target, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS )\r\n    endif\r\n    \r\n    if GetUnitState(target, UNIT_STATE_LIFE) > 0.405 and counter > 0 and GetUnitAbilityLevel( target, 'B01T') > 0 then\r\n        call SaveReal( udg_hash, id, StringHash( \"wndw2\" ), counter - 1 )\r\n    else\r\n        if GetUnitAbilityLevel( target, 'B01T') > 0 then\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 6\r\n                set bj_lastCreatedUnit = CreateUnit( GetOwningPlayer( caster ), 'u000', GetUnitX( target ), GetUnitY( target ), 60 * cyclA )\r\n                call UnitAddAbility( bj_lastCreatedUnit, 'A0LC')\r\n                \r\n                set id1 = GetHandleId( bj_lastCreatedUnit )\r\n                call SaveTimerHandle( udg_hash, id1, StringHash( \"wndww\" ), CreateTimer() )\r\n                set id1 = GetHandleId( LoadTimerHandle( udg_hash, id1, StringHash( \"wndww\" ) ) ) \r\n                call SaveUnitHandle( udg_hash, id1, StringHash( \"wndww\" ), bj_lastCreatedUnit )\r\n                call SaveUnitHandle( udg_hash, id1, StringHash( \"wndwwcs\" ), caster )\r\n                call SaveReal( udg_hash, id1, StringHash( \"wndww\" ), sh )\r\n                call SaveGroupHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"wndwwg\" ), CreateGroup() )\r\n                call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"wndww\" ) ), 0.04, true, function WandererWWawe )\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n    \r\n        call UnitRemoveAbility( target, 'A0LB' )\r\n        call UnitRemoveAbility( target, 'B01T' )\r\n        call RemoveUnit( dummy )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n        call FlushChildHashtable( udg_hash, id )\r\n    endif\r\n    \r\n    set target = null\r\n    set caster = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Trig_WandererW_Actions takes nothing returns nothing\r\n    local unit dummy\r\n    local integer id\r\n    local real dmg\r\n    local real sh\r\n    local real hp\r\n    local integer stack\r\n    local unit caster\r\n    local unit target\r\n    local integer lvl\r\n    local real t\r\n    local boolean l = false\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n        set t = udg_Time\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 900, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A0JG'), caster, 64, 90, 10, 1.5 )\r\n        set t = 7\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set t = 7\r\n    endif\r\n    set t = timebonus(caster, t)\r\n\r\n    call UnitAddAbility( target, 'A0LB')\r\n    set dmg = ( 5 + ( 3 * lvl ) ) * GetUnitSpellPower(caster)\r\n    set sh = 50 + (30*lvl)\r\n    set hp = 30 + (10*lvl)\r\n    \r\n    call DestroyEffect( AddSpecialEffectTarget(\"Abilities\\\\Spells\\\\Items\\\\AIil\\\\AIilTarget.mdl\", target, \"origin\") )\r\n    \r\n    set id = GetHandleId( target )\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"wndw\" ) ) == null then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"wndw\" ), CreateTimer() )\r\n        set l = true\r\n    endif\r\n\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"wndw\" ) ) ) \r\n\tcall SaveUnitHandle( udg_hash, id, StringHash( \"wndw\" ), target )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"wndwc\" ), caster )\r\n    call SaveReal( udg_hash, id, StringHash( \"wndw2\" ), t )\r\n    call SaveReal( udg_hash, id, StringHash( \"wndw\" ), dmg )\r\n    call SaveReal( udg_hash, id, StringHash( \"wndws\" ), sh )\r\n    if l then\r\n        call dummyspawn( caster, 0, 0, 0, 0 )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"wndw1\" ), bj_lastCreatedUnit )\r\n    endif\r\n\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"wndw\" ) ), 1, true, function WandererWCast )\r\n    \r\n    call SetUnitState( caster, UNIT_STATE_LIFE, RMaxBJ(0,GetUnitState( caster, UNIT_STATE_LIFE) - hp ))\r\n    \r\n    set dummy = null\r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_WandererW takes nothing returns nothing\r\n    set gg_trg_WandererW = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_WandererW, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_WandererW, Condition( function Trig_WandererW_Conditions ) )\r\n    call TriggerAddAction( gg_trg_WandererW, function Trig_WandererW_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}