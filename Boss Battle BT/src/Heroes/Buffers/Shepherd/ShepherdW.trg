{
  "Id": 50333063,
  "Comment": "Blanko Q",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope ShepherdW initializer init\r\n\r\n    globals\r\n        private constant integer ID_ABILITY = 'A1DS'\r\n        private constant integer AREA_BASE = 200\r\n        private constant integer AREA_PER_LVL = 50\r\n        private constant string AREA_EFFECT = \"Abilities\\\\Spells\\\\Human\\\\Feedback\\\\SpellBreakerAttack.mdl\"\r\n        private constant string FIZZLE_EFFECT = \"Abilities\\\\Spells\\\\Other\\\\TalkToMe\\\\TalkToMe\"\r\n        private group g = CreateGroup()\r\n    endglobals\r\n\r\n    function Trig_ShepherdW_Conditions takes nothing returns boolean\r\n        return GetSpellAbilityId() == ID_ABILITY //and combat( GetSpellAbilityUnit(), true, GetSpellAbilityId() )\r\n    endfunction\r\n\r\n    private function target_is_ally takes nothing returns boolean\r\n        local unit filtered\r\n        local unit caster\r\n        local boolean b\r\n        set filtered = GetFilterUnit()\r\n        set caster = udg_Caster\r\n        if caster == null then\r\n            set caster = GetSpellAbilityUnit()\r\n        endif\r\n        set b = unitst( filtered, caster, \"ally\" ) and not( IsUnitType( filtered, UNIT_TYPE_STRUCTURE ) )\r\n        set filtered = null\r\n        set caster = null\r\n        return b\r\n    endfunction\r\n    private function target_is_enemy takes nothing returns boolean\r\n        local unit filtered\r\n        local unit caster\r\n        local boolean b\r\n        set filtered = GetFilterUnit()\r\n        set caster = udg_Caster\r\n        if caster == null then\r\n            set caster = GetSpellAbilityUnit()\r\n        endif\r\n        set b = unitst( filtered, caster, \"enemy\" ) and GetUnitAbilityLevel( filtered, 'Avul' ) == 0 \r\n        set filtered = null\r\n        set caster = null\r\n        return b\r\n    endfunction\r\n    private function target_is_enemy_nonmech takes nothing returns boolean\r\n        local unit filtered\r\n        local unit caster\r\n        local boolean b\r\n        set filtered = GetFilterUnit()\r\n        set caster = udg_Caster\r\n        if caster == null then\r\n            set caster = GetSpellAbilityUnit()\r\n        endif\r\n        set b = unitst( filtered, caster, \"enemy\" ) and GetUnitAbilityLevel( filtered, 'Avul' ) == 0 and not( IsUnitType( filtered, UNIT_TYPE_MECHANICAL ) )\r\n        set filtered = null\r\n        set caster = null\r\n        return b\r\n    endfunction\r\n    private function target_is_ally_or_enemy takes nothing returns boolean\r\n        local unit filtered\r\n        local unit caster\r\n        local boolean b\r\n        set filtered = GetFilterUnit()\r\n        set caster = udg_Caster\r\n        if caster == null then\r\n            set caster = GetSpellAbilityUnit()\r\n        endif\r\n        set b = ( unitst( filtered, caster, \"ally\" ) and not( IsUnitType( filtered, UNIT_TYPE_STRUCTURE ) ) ) or ( unitst( filtered, caster, \"enemy\" ) and GetUnitAbilityLevel( filtered, 'Avul' ) == 0 )\r\n        set filtered = null\r\n        set caster = null\r\n        return b\r\n    endfunction\r\n    private function target_is_allied_summon takes nothing returns boolean\r\n        local unit filtered\r\n        local unit caster\r\n        local boolean b\r\n        \r\n        set filtered = GetFilterUnit()\r\n        set caster = udg_Caster\r\n        set caster = udg_Caster\r\n        if caster == null then\r\n            set caster = GetSpellAbilityUnit()\r\n        endif\r\n        set b = unitst( filtered, caster, \"ally\" ) and not( IsUnitType( filtered, UNIT_TYPE_HERO ) ) and not( IsUnitType( filtered, UNIT_TYPE_ANCIENT ) ) and  GetUnitAbilityLevel( filtered, 'Avul' ) == 0\r\n        set filtered = null\r\n        set caster = null\r\n        return b\r\n    endfunction\r\n\r\n    function Trig_ShepherdW_Actions takes nothing returns nothing\r\n        local unit caster\r\n        local unit u\r\n        local real target_x\r\n        local real target_y\r\n        local integer lvl\r\n        local real range\r\n        local integer i = 0\r\n        local integer cyclA\r\n        local integer cyclAEnd\r\n        \r\n        if CastLogic() then\r\n            set caster = udg_Caster\r\n            //set target = udg_Target\r\n            set target_x = GetLocationX( GetUnitLoc( caster ) )\r\n            set target_y = GetLocationY( GetUnitLoc( caster ) )\r\n            set lvl = udg_Level\r\n        elseif RandomLogic() then\r\n            set caster = udg_Caster\r\n            //set target = randomtarget( caster, 600, \"enemy\", \"\", \"\", \"\", \"\" )\r\n            set target_x = GetLocationX( GetUnitLoc( caster ) )\r\n            set target_y = GetLocationY( GetUnitLoc( caster ) )\r\n            set lvl = udg_Level\r\n            call textst( udg_string[0] + GetObjectName(ID_ABILITY), caster, 64, 90, 10, 1.5 )\r\n            /*if target == null then\r\n                set caster = null\r\n                return\r\n            endif*/\r\n        else\r\n            set caster = GetSpellAbilityUnit()\r\n            //set target = GetSpellTargetUnit()\r\n            set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n            set target_x = GetLocationX( GetSpellTargetLoc() )\r\n            set target_y = GetLocationY( GetSpellTargetLoc() )\r\n        endif\r\n        \r\n        set range = I2R(AREA_BASE+(AREA_PER_LVL*lvl))\r\n        set cyclA = 1\r\n        set cyclAEnd = udg_Database_NumberItems[24]\r\n        loop\r\n            exitwhen cyclA > cyclAEnd\r\n            if GetUnitAbilityLevel( caster, udg_DB_Hero_SpecAbAkt[cyclA] ) > 0 or GetUnitAbilityLevel( caster, udg_DB_Hero_SpecAbAktPlus[cyclA] ) > 0 then\r\n                set i = cyclA\r\n                set cyclA = cyclAEnd\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        // not untargeted\r\n        if i != 0 and i != 7 and i != 9 and i != 10 and i != 11 and i != 13 and i != 14 and i != 15 then \r\n            // targets allies\r\n            if i == 1 or i == 5  then\r\n                call GroupEnumUnitsInRange( g, target_x, target_y, range, Condition(function target_is_ally) )\r\n            // targets allied summons\r\n            elseif i == 8 then\r\n                call GroupEnumUnitsInRange( g, target_x, target_y, range, Condition(function target_is_allied_summon) )\r\n            // targets enemy nonmech\r\n            elseif i == 2 then\r\n                call GroupEnumUnitsInRange( g, target_x, target_y, range, Condition(function target_is_enemy_nonmech) )\r\n            // targets enemy \r\n            elseif i == 3 or i == 6 then\r\n                call GroupEnumUnitsInRange( g, target_x, target_y, range, Condition(function target_is_enemy) )\r\n            // targets both\r\n            elseif i == 4 or i == 12 then\r\n                call GroupEnumUnitsInRange( g, target_x, target_y, range, Condition(function target_is_ally_or_enemy) )\r\n            else //undefined\r\n                /*loop\r\n                    set u = FirstOfGroup(g)\r\n                    exitwhen u == null\r\n                    call GroupRemoveUnit(g,u)\r\n                    set u = FirstOfGroup(g)\r\n                endloop*/\r\n                call textst( \"Fizzled!\", caster, 64, 90, 10, 1.5 )\r\n                call DestroyEffect( AddSpecialEffectTarget(FIZZLE_EFFECT, caster, \"overhead\" ) )       \r\n                call BJDebugMsg(\"Error: Undefined Unique for 'Shepherd: Care'\")\r\n            endif            \r\n            loop\r\n                set u = FirstOfGroup(g)\r\n                exitwhen u == null\r\n                //\r\n                    set udg_Target = u\r\n                    set udg_Caster = caster\r\n                    set udg_CastLogic = true\r\n                    set udg_CareLogic = true\r\n                    call TriggerExecute( udg_DB_Trigger_Spec[i] )\r\n                    set udg_CareLogic = false\r\n                    set udg_CastLogic = false\r\n                //\r\n                call GroupRemoveUnit(g,u)\r\n            endloop\r\n            call DestroyEffect( AddSpecialEffect( AREA_EFFECT, target_x, target_y ) )\r\n        else\r\n            call textst( \"Fizzled!\", caster, 64, 90, 10, 1.5 )\r\n            call DestroyEffect( AddSpecialEffectTarget(FIZZLE_EFFECT, caster, \"overhead\" ) )       \r\n        endif\r\n        set caster = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_ShepherdW = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_ShepherdW, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n        call TriggerAddCondition( gg_trg_ShepherdW, Condition( function Trig_ShepherdW_Conditions ) )\r\n        call TriggerAddAction( gg_trg_ShepherdW, function Trig_ShepherdW_Actions )\r\n    endfunction\r\n    \r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}