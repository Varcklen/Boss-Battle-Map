{
  "Id": 50332963,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope ComanderR\r\n\r\n    globals\r\n        private constant integer STRENGTH_LIMIT = 100000\r\n    endglobals\r\n\r\n    function Trig_ComandR_Conditions takes nothing returns boolean\r\n        return GetSpellAbilityId() == 'A0UV'\r\n    endfunction\r\n\r\n    function ComandRSpell takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"comr\" ) )\r\n        local real hp = GetUnitState( u, UNIT_STATE_LIFE)\r\n        local integer str = LoadInteger( udg_hash, GetHandleId( u ), StringHash( \"comrs\" ) )\r\n        \r\n        if GetUnitState( u, UNIT_STATE_LIFE) > 0.405 then\r\n            call statst( u, -str, 0, 0, 0, false )\r\n            call SetUnitState( u, UNIT_STATE_LIFE, hp )\r\n            call UnitRemoveAbility( u, 'A0UX' )\r\n            call UnitRemoveAbility( u, 'B056' )\r\n            call RemoveSavedInteger( udg_hash, GetHandleId( u ), StringHash( \"comrs\" ) )\r\n        endif\r\n        call FlushChildHashtable( udg_hash, id )\r\n        \r\n        set u = null\r\n    endfunction\r\n\r\n    function Trig_ComandR_Actions takes nothing returns nothing\r\n        local integer id \r\n        local integer str \r\n        local integer strsum\r\n        local unit caster\r\n        local unit target\r\n        local integer lvl\r\n        local real t\r\n        local real hp\r\n        \r\n        if CastLogic() then\r\n            set caster = udg_Caster\r\n            set target = udg_Target\r\n            set lvl = udg_Level\r\n            set t = udg_Time\r\n        elseif RandomLogic() then\r\n            set caster = udg_Caster\r\n            set target = randomtarget( caster, 900, \"ally\", \"hero\", \"\", \"\", \"\" )\r\n            set lvl = udg_Level\r\n            call textst( udg_string[0] + GetObjectName('A0UV'), caster, 64, 90, 10, 1.5 )\r\n            set t = 20 \r\n            if target == null then\r\n                set caster = null\r\n                return\r\n            endif\r\n        else\r\n            set caster = GetSpellAbilityUnit()\r\n            set target = GetSpellTargetUnit()\r\n            set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n            set t = 20 \r\n        endif\r\n        set t = timebonus(caster, t)\r\n\r\n        set id = GetHandleId( target )\r\n        \r\n        if IsUnitType( target, UNIT_TYPE_HERO) then\r\n            set str = 10+(10*lvl)\r\n            call UnitAddAbility( target, 'A0UX' )\r\n            if GetHeroStr( target, false) < STRENGTH_LIMIT then\r\n                call statst( target, str, 0, 0, 0, false )\r\n                set strsum = LoadInteger( udg_hash, GetHandleId( target ), StringHash( \"comrs\" ) ) + str\r\n            endif\r\n\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Human\\\\Slow\\\\SlowCaster.mdl\", GetUnitX( target ), GetUnitY( target ) ) )\r\n            \r\n            set id = GetHandleId( target )\r\n            if LoadTimerHandle( udg_hash, id, StringHash( \"comr\" ) ) == null  then\r\n                call SaveTimerHandle( udg_hash, id, StringHash( \"comr\" ), CreateTimer() )\r\n            endif\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"comr\" ) ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"comr\" ), target )\r\n            call SaveInteger( udg_hash, GetHandleId( target ), StringHash( \"comrs\" ), strsum )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"comr\" ) ), t, false, function ComandRSpell )\r\n        endif\r\n        \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    function InitTrig_ComandR takes nothing returns nothing\r\n        set gg_trg_ComandR = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_ComandR, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n        call TriggerAddCondition( gg_trg_ComandR, Condition( function Trig_ComandR_Conditions ) )\r\n        call TriggerAddAction( gg_trg_ComandR, function Trig_ComandR_Actions )\r\n    endfunction\r\n    \r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}