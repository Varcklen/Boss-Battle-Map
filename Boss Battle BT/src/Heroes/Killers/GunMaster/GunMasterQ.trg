{
  "Id": 50333127,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_GunMasterQ_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A19H'\r\nendfunction\r\n\r\nfunction CommandoQEnd takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"codq1\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"codq1dmg\" ) )\r\n    local group g = CreateGroup()\r\n    local unit u\r\n    local effect fx \r\n    \r\n    set fx = AddSpecialEffect( \"Abilities\\\\Weapons\\\\GyroCopter\\\\GyroCopterMissile.mdl\", GetUnitX( dummy ), GetUnitY( dummy ) )\r\n    call BlzSetSpecialEffectScale( fx, 2 )\r\n    call DestroyEffect( fx )\r\n    \r\n    call GroupEnumUnitsInRange( g, GetUnitX( dummy ), GetUnitY( dummy ), 350, null )\r\n    loop\r\n        set u = FirstOfGroup(g)\r\n        exitwhen u == null\r\n        if unitst( u, dummy, \"enemy\" ) then\r\n            call UnitDamageTarget( bj_lastCreatedUnit, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n        endif\r\n        call GroupRemoveUnit(g,u)\r\n    endloop\r\n    call FlushChildHashtable( udg_hash, id )\r\n    call RemoveUnit( dummy )\r\n\r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set dummy = null\r\n    set fx = null\r\nendfunction\r\n\r\nfunction CommandoQCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"codq\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"codqdmg\" ) )\r\n    local real x = LoadReal( udg_hash, id, StringHash( \"codqx\" ) )\r\n    local real y = LoadReal( udg_hash, id, StringHash( \"codqy\" ) )\r\n    local real xc = GetUnitX( dummy )\r\n    local real yc = GetUnitY( dummy )\r\n    local integer counter = LoadInteger( udg_hash, id, StringHash( \"codq\" ) ) + 1\r\n    local real angle = Atan2( y - yc, x - xc )\r\n    local real NewX = xc + 20 * Cos( angle )\r\n    local real NewY = yc + 20 * Sin( angle )\r\n    local real halftime = LoadReal( udg_hash, id, StringHash( \"codqt\" ) )\r\n    local real IfX = ( x - xc ) * ( x - xc )\r\n    local real IfY = ( y - yc ) * ( y - yc )\r\n    local real IfS = SquareRoot( IfX + IfY )\r\n    local real time = LoadReal( udg_hash, id, StringHash( \"codqp\" ) ) + 0.02\r\n    local boolean l = LoadBoolean( udg_hash, id, StringHash( \"codq\" ))\r\n    local integer id1\r\n\r\n    if IfS < 50 or GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n        if GetUnitState( dummy, UNIT_STATE_LIFE) > 0.405 then\r\n            set time = halftime\r\n            call SetUnitPosition( dummy, NewX, NewY )\r\n            \r\n            set id1 = GetHandleId( dummy )\r\n            if LoadTimerHandle( udg_hash, id1, StringHash( \"codq1\" ) ) == null then\r\n                call SaveTimerHandle( udg_hash, id1, StringHash( \"codq1\" ), CreateTimer() )\r\n            endif\r\n            set id1 = GetHandleId( LoadTimerHandle( udg_hash, id1, StringHash( \"codq1\" ) ) )\r\n            call SaveUnitHandle( udg_hash, id1, StringHash( \"codq1\" ), dummy )\r\n            call SaveReal( udg_hash, id1, StringHash( \"codq1dmg\" ), dmg )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( dummy ), StringHash( \"codq1\" ) ), 2, false, function CommandoQEnd )\r\n        endif\r\n        call FlushChildHashtable( udg_hash, id ) \r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        call SaveInteger( udg_hash, id, StringHash( \"codq\" ), counter )\r\n        call SetUnitPosition( dummy, NewX, NewY )\r\n    endif\r\n    if time >= halftime and not(l) then\r\n        call SetUnitFlyHeight( dummy, -400, 800 )\r\n        call SaveBoolean( udg_hash, id, StringHash( \"codq\" ), true )\r\n    else\r\n        call SaveReal( udg_hash, id, StringHash( \"codqp\" ), time )\r\n    endif\r\n    \r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Trig_GunMasterQ_Actions takes nothing returns nothing\r\n    local real dmg\r\n    local unit caster\r\n    local integer lvl\r\n    local real x\r\n    local real y\r\n    local real dx\r\n    local real dy\r\n    local real dist\r\n    local integer id\r\n    local real halftime\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set x = GetLocationX( GetSpellTargetLoc() )\r\n        set y = GetLocationY( GetSpellTargetLoc() )\r\n        set lvl = udg_Level\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set lvl = udg_Level\r\n        set x = GetUnitX( caster ) + GetRandomReal( -650, 650 )\r\n        set y = GetUnitY( caster ) + GetRandomReal( -650, 650 )\r\n        call textst( udg_string[0] + GetObjectName('A19H'), caster, 64, 90, 10, 1.5 )\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set x = GetLocationX( GetSpellTargetLoc() )\r\n        set y = GetLocationY( GetSpellTargetLoc() )\r\n    endif\r\n    \r\n    call dummyspawn( caster, 0, 'A19I', 0, 0 )\r\n    call UnitAddAbility(bj_lastCreatedUnit, 'Amrf')\r\n    \r\n    set dmg = 100+(50*lvl)\r\n    set dx = x - GetUnitX(bj_lastCreatedUnit)\r\n    set dy = y - GetUnitY(bj_lastCreatedUnit)\r\n    set dist = SquareRoot(dx * dx + dy * dy)\r\n    \r\n    set halftime = 0.02*0.5*(dist/20)\r\n\r\n    call SetUnitFlyHeight( bj_lastCreatedUnit, 400, 800 )\r\n    \r\n    set id = GetHandleId( bj_lastCreatedUnit )\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"codq\" ) ) == null then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"codq\" ), CreateTimer() )\r\n    endif\r\n    set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"codq\" ) ) )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"codq\" ), bj_lastCreatedUnit)\r\n    call SaveReal( udg_hash, id, StringHash( \"codqx\" ), x )\r\n    call SaveReal( udg_hash, id, StringHash( \"codqy\" ), y )\r\n    call SaveReal( udg_hash, id, StringHash( \"codqt\" ), halftime)\r\n    call SaveReal( udg_hash, id, StringHash( \"codqdmg\" ), dmg)\r\n    call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"codq\" ) ), 0.02, true, function CommandoQCast )\r\n\r\n    set caster = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_GunMasterQ takes nothing returns nothing\r\n    set gg_trg_GunMasterQ = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_GunMasterQ, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_GunMasterQ, Condition( function Trig_GunMasterQ_Conditions ) )\r\n    call TriggerAddAction( gg_trg_GunMasterQ, function Trig_GunMasterQ_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}