{
  "Id": 50333169,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope WagonR initializer init\r\n\t\r\n\tglobals\r\n\t    private constant real GOLD_DISCOUNT = 0.8\r\n\t    \r\n\t    private constant real DAMAGE_MULTIPLIER = 3\r\n\t    \r\n\t    private constant real GOLD_THROW_INITIAL = 0.05\r\n\t    private constant real GOLD_THROW_PER_LEVEL = 0.05\r\n\t    \r\n\t    private constant integer SPEED = 20\r\n\tendglobals\r\n\t\r\n\tprivate function condition takes nothing returns boolean\r\n\t    return GetSpellAbilityId() == 'A0OY' and not(udg_fightmod[3]) and combat( GetSpellAbilityUnit(), true, GetSpellAbilityId() )\r\n\tendfunction\r\n\t\r\n\tprivate function SpawnCoin takes integer coinType, real x, real y returns nothing\r\n\t\tset bj_lastCreatedItem = CreateItem( coinType, x + GetRandomReal(-300, 300), y + GetRandomReal(-300, 300) )\r\n        if RectContainsItem( bj_lastCreatedItem, udg_Boss_Rect) == false then\r\n            call SetItemPositionLoc( bj_lastCreatedItem, GetRectCenter( udg_Boss_Rect ) )\r\n        endif\r\n\tendfunction\r\n\t\r\n\tprivate function GoldCreation takes integer gold, real x, real y returns nothing\r\n\t\tlocal integer loopEnd = 1\r\n\t\t\r\n        loop\r\n            exitwhen gold < 10 or loopEnd > 30 \r\n            if gold >= 500 then\r\n                set gold = gold - 500\r\n                call SpawnCoin('I04Q', x, y)\r\n            elseif gold >= 100 then\r\n                set gold = gold - 100\r\n                call SpawnCoin('I04P', x, y)\r\n            elseif gold >= 50 then\r\n                set gold = gold - 50\r\n                call SpawnCoin('I04J', x, y)\r\n            elseif gold >= 10 then\r\n                set gold = gold - 10\r\n                call SpawnCoin('I02U', x, y)\r\n            endif\r\n            set loopEnd = loopEnd + 1\r\n        endloop\r\n\tendfunction\r\n\t\r\n\tprivate function WagonRCast takes nothing returns nothing\r\n\t    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n\t    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"mwgr\" ) )\r\n\t    local real x = LoadReal( udg_hash, id, StringHash( \"mwgrx\" ) )\r\n\t    local real y = LoadReal( udg_hash, id, StringHash( \"mwgry\" ) )\r\n\t    local real xc = GetUnitX( dummy )\r\n\t    local real yc = GetUnitY( dummy )\r\n\t    local real angle = Atan2( y - yc, x - xc )\r\n\t    local real NewX = xc + SPEED * Cos( angle )\r\n\t    local real NewY = yc + SPEED * Sin( angle )\r\n\t    local real dist = LoadReal( udg_hash, id, StringHash( \"mwgrd\" ) )\r\n\t    local real IfX = ( x - xc ) * ( x - xc )\r\n\t    local real IfY = ( y - yc ) * ( y - yc )\r\n\t    local real IfS = SquareRoot( IfX + IfY )\r\n\t    local real perc = IfS * 100 / dist\r\n\t    local boolean flyingDown = LoadBoolean( udg_hash, id, StringHash( \"mwgr\" ))\r\n\t    local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"mwgrc\" ) )\r\n\t    local real dmg \r\n\t    local integer gold \r\n\t\r\n\t    if perc <= 50 and flyingDown == false then\r\n\t        call SetUnitFlyHeight( dummy, -400, 1000 )\r\n\t        call SaveBoolean( udg_hash, id, StringHash( \"mwgr\" ), true )\r\n\t    endif\r\n\t\r\n\t    if IfS < 100 or IsUnitDead( dummy) then\r\n\t    \tset dmg = LoadReal( udg_hash, id, StringHash( \"mwgrdmg\" ) )\r\n\t    \tset gold = R2I( LoadInteger( udg_hash, id, StringHash( \"mwgrg\" ) ) * GOLD_DISCOUNT )\r\n\t        if IsUnitAlive( dummy ) then\r\n\t            call GroupAoE( caster, x, y, dmg, 300, \"enemy\", \"Abilities\\\\Weapons\\\\MeatwagonMissile\\\\MeatwagonMissile.mdl\", null )\r\n\t        endif\r\n\t        call GoldCreation(gold, x, y)\r\n\t        call RemoveUnit(dummy)\r\n\t        call DestroyTimer( GetExpiredTimer() )\r\n\t    else\r\n\t        call SetUnitPosition( dummy, NewX, NewY )\r\n\t    endif\r\n\t    \r\n\t    set caster = null\r\n\t    set dummy = null\r\n\tendfunction\r\n\t\r\n\tprivate function action takes nothing returns nothing\r\n\t    local integer id \r\n\t    local integer lvl\r\n\t    local unit caster\r\n\t    local unit target\r\n\t    local real dmg\r\n\t    local real x\r\n\t    local real y\r\n\t    local real dist\r\n\t    local real dx\r\n\t    local real dy\r\n\t    local integer goldToThrow\r\n\t    local real goldMultiplier\r\n\t    \r\n\t    if CastLogic() then\r\n\t        set caster = udg_Caster\r\n\t        set target = udg_Target\r\n\t        set lvl = udg_Level\r\n\t    elseif RandomLogic() then\r\n\t        set caster = udg_Caster\r\n\t        set target = randomtarget( caster, 900, \"enemy\", \"\", \"\", \"\", \"\" )\r\n\t        set lvl = udg_Level\r\n\t        call textst( udg_string[0] + GetObjectName('A0OY'), caster, 64, 90, 10, 1.5 )\r\n\t        if target == null then\r\n\t            set caster = null\r\n\t            return\r\n\t        endif\r\n\t    else\r\n\t        set caster = GetSpellAbilityUnit()\r\n\t        set target = GetSpellTargetUnit()\r\n\t        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n\t    endif\r\n\t    \r\n\t    call dummyspawn( caster, 0, 'A0PA', 0, 0 )\r\n\t    call UnitAddAbility(bj_lastCreatedUnit, 'Amrf')\r\n\t    \r\n\t    set goldMultiplier = GOLD_THROW_INITIAL + (GOLD_THROW_PER_LEVEL * lvl)\r\n\t    set goldToThrow = R2I(goldMultiplier * GetPlayerState( GetOwningPlayer( caster ), PLAYER_STATE_RESOURCE_GOLD) )\r\n\t    set dmg = goldToThrow * DAMAGE_MULTIPLIER\r\n\t\tset x = GetUnitX(target)\r\n\t    set y = GetUnitY(target)\r\n\t    set dx = x - GetUnitX(bj_lastCreatedUnit)\r\n\t    set dy = y - GetUnitY(bj_lastCreatedUnit)\r\n\t    set dist = SquareRoot(dx * dx + dy * dy)\r\n\t\r\n\t    call SetUnitFlyHeight( bj_lastCreatedUnit, 400, 1000 )\r\n\t    \r\n\t    set id = InvokeTimerWithUnit( bj_lastCreatedUnit, \"mwgr\", 0.02, true, function WagonRCast )\r\n\t    call SaveUnitHandle( udg_hash, id, StringHash( \"mwgrc\" ), caster)\r\n\t    call SaveReal( udg_hash, id, StringHash( \"mwgrx\" ), x )\r\n\t    call SaveReal( udg_hash, id, StringHash( \"mwgry\" ), y )\r\n\t    call SaveReal( udg_hash, id, StringHash( \"mwgrd\" ), dist)\r\n\t    call SaveReal( udg_hash, id, StringHash( \"mwgrdmg\" ), dmg)\r\n\t    call SaveInteger( udg_hash, id, StringHash( \"mwgrg\" ), goldToThrow )\r\n\t    \r\n\t    call SetPlayerState( GetOwningPlayer( caster ), PLAYER_STATE_RESOURCE_GOLD, IMaxBJ( 0, GetPlayerState( GetOwningPlayer( caster ), PLAYER_STATE_RESOURCE_GOLD) - goldToThrow ) )\r\n\t\r\n\t    set caster = null\r\n\t    set target = null\r\n\tendfunction\r\n\t\r\n\t//===========================================================================\r\n\tprivate function init takes nothing returns nothing\r\n\t    set gg_trg_WagonR = CreateTrigger(  )\r\n\t    call TriggerRegisterAnyUnitEventBJ( gg_trg_WagonR, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n\t    call TriggerAddCondition( gg_trg_WagonR, Condition( function condition ) )\r\n\t    call TriggerAddAction( gg_trg_WagonR, function action )\r\n\tendfunction\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}