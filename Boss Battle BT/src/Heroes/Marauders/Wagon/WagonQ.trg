{
  "Id": 50333166,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_WagonQ_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A01G'\r\nendfunction\r\n\r\nfunction WagonQCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"mwgq\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"mwgqdmg\" ) )\r\n    local real x = LoadReal( udg_hash, id, StringHash( \"mwgqx\" ) )\r\n    local real y = LoadReal( udg_hash, id, StringHash( \"mwgqy\" ) )\r\n    local real xc = GetUnitX( dummy )\r\n    local real yc = GetUnitY( dummy )\r\n    local integer counter = LoadInteger( udg_hash, id, StringHash( \"mwgq\" ) ) + 1\r\n    local integer c = LoadInteger( udg_hash, id, StringHash( \"mwgqc\" ) ) + 1\r\n    local real angle = Atan2( y - yc, x - xc )\r\n    local real NewX = xc + 20 * Cos( angle )\r\n    local real NewY = yc + 20 * Sin( angle )\r\n    local group g = CreateGroup()\r\n    local unit u\r\n    local real dist = LoadReal( udg_hash, id, StringHash( \"mwgqd\" ) )\r\n    local real IfX = ( x - xc ) * ( x - xc )\r\n    local real IfY = ( y - yc ) * ( y - yc )\r\n    local real IfS = SquareRoot( IfX + IfY )\r\n    local real perc = (IfS * 100)/dist\r\n    local boolean l = LoadBoolean( udg_hash, id, StringHash( \"mwgq\" ))\r\n\r\n    if perc <= 50 and not(l) then\r\n        call SetUnitFlyHeight( dummy, -400, 1000 )\r\n        call SaveBoolean( udg_hash, id, StringHash( \"mwgq\" ), true )\r\n    endif\r\n    \r\n    if c >= 10 then\r\n        call SaveInteger( udg_hash, id, StringHash( \"mwgqc\" ), 0 )\r\n        if not(udg_fightmod[3]) and combat( dummy, false, 0 ) then\r\n            call CreateItem( 'I02U', xc, yc )\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Orc\\\\MirrorImage\\\\MirrorImageDeathCaster.mdl\", xc, yc ) )\r\n        endif\r\n    else\r\n        call SaveInteger( udg_hash, id, StringHash( \"mwgqc\" ), c )\r\n    endif\r\n\r\n    if IfS < 100 or GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n        if GetUnitState( dummy, UNIT_STATE_LIFE) > 0.405 then\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Weapons\\\\MeatwagonMissile\\\\MeatwagonMissile.mdl\", x, y ) )\r\n            call GroupEnumUnitsInRange( g, x, y, 300, null )\r\n            loop\r\n                set u = FirstOfGroup(g)\r\n                exitwhen u == null\r\n                if unitst( u, dummy, \"enemy\" ) then\r\n                    call UnitDamageTarget(dummy, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n                endif\r\n                call GroupRemoveUnit(g,u)\r\n            endloop\r\n        endif\r\n        call RemoveUnit(dummy)\r\n        call FlushChildHashtable( udg_hash, id ) \r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        call SaveInteger( udg_hash, id, StringHash( \"mwgq\" ), counter )\r\n        call SetUnitPosition( dummy, NewX, NewY )\r\n    endif\r\n    \r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Trig_WagonQ_Actions takes nothing returns nothing\r\n    local integer id \r\n    local integer lvl\r\n    local unit caster\r\n    local unit target\r\n    local real dmg\r\n    local real x\r\n    local real y\r\n    local real dist\r\n    local real dx\r\n    local real dy\r\n\r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 900, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A01G'), caster, 64, 90, 10, 1.5 )\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n    endif\r\n    \r\n    call dummyspawn( caster, 0, 'A027', 0, 0 )\r\n    call UnitAddAbility(bj_lastCreatedUnit, 'Amrf')\r\n    \r\n    set dmg = 80 + (50*lvl)\r\n\tset x = GetUnitX(target)\r\n    set y = GetUnitY(target)\r\n    set dx = x - GetUnitX(bj_lastCreatedUnit)\r\n    set dy = y - GetUnitY(bj_lastCreatedUnit)\r\n    set dist = SquareRoot(dx * dx + dy * dy)\r\n    call SetUnitFlyHeight( bj_lastCreatedUnit, 400, 1000 )\r\n    \r\n    set id = GetHandleId( bj_lastCreatedUnit )\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"mwgq\" ) ) == null then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"mwgq\" ), CreateTimer() )\r\n    endif\r\n    set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"mwgq\" ) ) )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"mwgq\" ), bj_lastCreatedUnit)\r\n    call SaveReal( udg_hash, id, StringHash( \"mwgqx\" ), x )\r\n    call SaveReal( udg_hash, id, StringHash( \"mwgqy\" ), y )\r\n    call SaveReal( udg_hash, id, StringHash( \"mwgqd\" ), dist)\r\n    call SaveReal( udg_hash, id, StringHash( \"mwgqdmg\" ), dmg)\r\n    call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"mwgq\" ) ), 0.02, true, function WagonQCast ) \r\n\r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_WagonQ takes nothing returns nothing\r\n    set gg_trg_WagonQ = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_WagonQ, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_WagonQ, Condition( function Trig_WagonQ_Conditions ) )\r\n    call TriggerAddAction( gg_trg_WagonQ, function Trig_WagonQ_Actions )\r\nendfunction",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}