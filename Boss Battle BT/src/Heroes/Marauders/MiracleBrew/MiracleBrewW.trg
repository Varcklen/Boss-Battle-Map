{
  "Id": 50333134,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_MiracleBrewW_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A0R4'\r\nendfunction\r\n\r\nfunction MiracleBrewWEnd takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    call UnitRemoveAbility( LoadUnitHandle( udg_hash, id, StringHash( \"mrbw\" ) ), LoadInteger( udg_hash, id, StringHash( \"mrbw\" ) ) )\r\n    call UnitRemoveAbility( LoadUnitHandle( udg_hash, id, StringHash( \"mrbw\" ) ), 'B00F' )\r\n    call FlushChildHashtable( udg_hash, id )\r\nendfunction\r\n\r\nfunction Trig_MiracleBrewW_Actions takes nothing returns nothing\r\n    local integer id \r\n    local integer i\r\n    local integer d\r\n    local unit caster\r\n    local unit target\r\n    local integer lvl\r\n    local real dmg\r\n    local real t\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set target = udg_Target\r\n        set lvl = udg_Level\r\n        set t = udg_Time\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set target = randomtarget( caster, 900, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        set lvl = udg_Level\r\n        set t = 12\r\n        call textst( udg_string[0] + GetObjectName('A0R4'), caster, 64, 90, 10, 1.5 )\r\n        if target == null then\r\n            set caster = null\r\n            return\r\n        endif\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set target = GetSpellTargetUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        set t = 12\r\n    endif\r\n    set t = timebonus(caster, t)\r\n    \r\n    set id = GetHandleId( target )\r\n    \r\n    if udg_Database_Hero[20] == 'O00N' then\r\n        call DestroyEffect( AddSpecialEffectTarget( \"Acid Ex.mdx\", target, \"origin\" ) ) \r\n        set i = 'A0MY'\r\n    else\r\n        call DestroyEffect( AddSpecialEffectTarget(\"Abilities\\\\Spells\\\\Other\\\\CrushingWave\\\\CrushingWaveDamage.mdl\", target, \"chest\" ) )\r\n        set i = 'A0RP'\r\n    endif\r\n    \r\n    if not(IsUnitType( target, UNIT_TYPE_ANCIENT)) and not(IsUnitType( target, UNIT_TYPE_HERO)) then\r\n        set d = lvl + 5\r\n    else\r\n        set d = lvl\r\n    endif\r\n    call UnitAddAbility( target, i )\r\n    call SetUnitAbilityLevel( target, 'A0A1', d )\r\n    \r\n   if LoadTimerHandle( udg_hash, id, StringHash( \"mrbw\" ) ) == null  then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"mrbw\" ), CreateTimer() )\r\n    endif\r\n\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"mrbw\" ) ) ) \r\n\tcall SaveUnitHandle( udg_hash, id, StringHash( \"mrbw\" ), target )\r\n    call SaveInteger( udg_hash, id, StringHash( \"mrbw\" ), i )\r\n\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"mrbw\" ) ), t, false, function MiracleBrewWEnd )\r\n    \r\n    set caster = null\r\n    set target = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_MiracleBrewW takes nothing returns nothing\r\n    set gg_trg_MiracleBrewW = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_MiracleBrewW, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_MiracleBrewW, Condition( function Trig_MiracleBrewW_Conditions ) )\r\n    call TriggerAddAction( gg_trg_MiracleBrewW, function Trig_MiracleBrewW_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}