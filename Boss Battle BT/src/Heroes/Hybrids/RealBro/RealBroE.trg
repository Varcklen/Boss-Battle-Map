{
  "Id": 50333227,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope RealBroE\r\n\r\n    function Trig_RealBroE_Conditions takes nothing returns boolean\r\n        return GetSpellAbilityId() == 'A1BG' and combat( GetSpellAbilityUnit(), true, GetSpellAbilityId() )\r\n    endfunction\r\n\r\n    function RealBroECast takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local integer counter = LoadInteger( udg_hash, id, StringHash( \"rlbe\" ) )\r\n        local integer count = LoadInteger( udg_hash, id, StringHash( \"rlbec\" ) ) + 1\r\n        local real dmg = LoadReal( udg_hash, id, StringHash( \"rlbe\" ) )\r\n        local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"rlbe\" ) )\r\n        local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"rlbet\" ) )\r\n        local real x = GetUnitX( caster )\r\n        local real y = GetUnitY( caster )\r\n        local real xc = GetUnitX( target )\r\n        local real yc = GetUnitY( target )\r\n        local real angle = Atan2( y - yc, x - xc )\r\n        local real NewX = xc + 12 * Cos( angle )\r\n        local real NewY = yc + 12 * Sin( angle )\r\n        local real IfX = ( x - xc ) * ( x - xc )\r\n        local real IfY = ( y - yc ) * ( y - yc )\r\n        \r\n        //RectContainsCoords(udg_Boss_Rect, x, y) and\r\n        if SquareRoot( IfX + IfY ) > 128 and counter < 200 and GetUnitState( target, UNIT_STATE_LIFE) > 0.405 and GetUnitState( caster, UNIT_STATE_LIFE) > 0.405 and combat( caster, false, 0 ) then\r\n            call SetUnitPosition( target, NewX, NewY )\r\n            call SetUnitFacing( target, AngleBetweenUnits(caster, target ) )\r\n            call SaveInteger( udg_hash, id, StringHash( \"rlbe\" ), counter + 1 )\r\n            if GetUnitTypeId( target ) == 'n030' then\r\n                if count >= 25 then\r\n                    call SaveInteger( udg_hash, id, StringHash( \"rlbec\" ), 0 )\r\n                    call GroupAoE( caster, null, GetUnitX(target), GetUnitY(target), dmg, 400, \"enemy\", \"\", \"\" )\r\n                else\r\n                    call SaveInteger( udg_hash, id, StringHash( \"rlbec\" ), count + 1 )\r\n                endif\r\n            endif\r\n        else\r\n            if GetUnitState( caster, UNIT_STATE_LIFE) > 0.405 and GetUnitState( target, UNIT_STATE_LIFE) > 0.405 and counter < 200 and combat( caster, false, 0 ) then\r\n                call DestroyEffect( AddSpecialEffect(\"Abilities\\\\Spells\\\\Human\\\\Thunderclap\\\\ThunderClapCaster.mdl\", GetUnitX( target ), GetUnitY( target ) ) )\r\n                if IsUnitEnemy( target, GetOwningPlayer( caster ) ) then\r\n                    call UnitStun(caster, target, 1.5 )\r\n                endif\r\n            endif\r\n            call SetUnitPathing( target, true )\r\n            call pausest( target, -1 )\r\n            call UnitRemoveAbility( target, 'A0DV' )\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        endif\r\n        \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n    \r\n    private function IsNotPvP takes unit caster, unit target returns boolean\r\n        local boolean isTrue = true\r\n        \r\n        if (target == udg_unit[57] or target == udg_unit[58]) and IsUnitAlly(target, GetOwningPlayer(caster)) then\r\n            set isTrue = false\r\n        endif\r\n        \r\n        set target = null\r\n        set caster = null\r\n        return isTrue\r\n    endfunction\r\n\r\n    function Trig_RealBroE_Actions takes nothing returns nothing\r\n        local integer id \r\n        local integer lvl\r\n        local unit caster\r\n        local unit target\r\n        local real dmg\r\n        local real x\r\n        local real y\r\n        \r\n        if CastLogic() then\r\n            set caster = udg_Caster\r\n            set target = udg_Target\r\n            set lvl = udg_Level\r\n        elseif RandomLogic() then\r\n            set caster = udg_Caster\r\n            set target = randomtarget( caster, 900, \"enemy\", \"notcaster\", \"\", \"\", \"\" )\r\n            set lvl = udg_Level\r\n            call textst( udg_string[0] + GetObjectName('A1BG'), caster, 64, 90, 10, 1.5 )\r\n            if target == null then\r\n                set caster = null\r\n                return\r\n            endif\r\n        else\r\n            set caster = GetSpellAbilityUnit()\r\n            set target = GetSpellTargetUnit()\r\n            set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n        endif\r\n        \r\n        if target != null and GetUnitAbilityLevel( target, 'A0DV' ) == 0 and GetUnitDefaultMoveSpeed(target) != 0 and IsNotPvP(caster, target) and caster != target then\r\n            set x = GetUnitX( caster )\r\n            set y = GetUnitY( caster )\r\n            \r\n            set dmg = (20 + ( 10 * lvl )) * GetUnitSpellPower(caster)\r\n            \r\n            if GetUnitAbilityLevel( target, 'A0DV' ) == 0 then\r\n                call pausest( target, 1 )\r\n            endif\r\n            call UnitAddAbility( target, 'A0DV' )\r\n            \r\n            call SetUnitPathing( target, false )\r\n            call SetUnitFacing( target, AngleBetweenUnits(caster, target ) )\r\n\r\n            set id = GetHandleId( target )\r\n            if LoadTimerHandle( udg_hash, id, StringHash( \"rlbe\" ) ) == null  then\r\n                call SaveTimerHandle( udg_hash, id, StringHash( \"rlbe\" ), CreateTimer() )\r\n            endif\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"rlbe\" ) ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"rlbe\" ), caster )\r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"rlbet\" ), target )\r\n            call SaveReal( udg_hash, id, StringHash( \"rlbe\" ), dmg )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"rlbe\" ) ), 0.02, true, function RealBroECast )\r\n        endif\r\n        \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    function InitTrig_RealBroE takes nothing returns nothing\r\n        set gg_trg_RealBroE = CreateTrigger(  )\r\n        call TriggerRegisterAnyUnitEventBJ( gg_trg_RealBroE, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n        call TriggerAddCondition( gg_trg_RealBroE, Condition( function Trig_RealBroE_Conditions ) )\r\n        call TriggerAddAction( gg_trg_RealBroE, function Trig_RealBroE_Actions )\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}