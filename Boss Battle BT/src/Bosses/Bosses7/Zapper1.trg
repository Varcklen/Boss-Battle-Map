{
  "Id": 50333575,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_Zapper1_Conditions takes nothing returns boolean\r\n    return GetUnitTypeId(udg_DamageEventTarget) == 'n00Q'\r\nendfunction\r\n\r\nfunction Zapper1Cast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local real r = LoadReal( udg_hash, id, StringHash( \"bszp1\" ) )\r\n    local unit boss = LoadUnitHandle( udg_hash, id, StringHash( \"bszp1\" ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"bszp1d\" ) )\r\n    local real xc = LoadReal( udg_hash, id, StringHash( \"bszp1x\" ) )\r\n    local real yc = LoadReal( udg_hash, id, StringHash( \"bszp1y\" ) )\r\n    local real x\r\n    local real y\r\n    \r\n    if GetUnitState( boss, UNIT_STATE_LIFE) <= 0.405 or not( udg_fightmod[0] ) then\r\n        call RemoveUnit( dummy )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n        call FlushChildHashtable( udg_hash, id )\r\n    else\r\n        set x = xc + 1000 * Cos( r * bj_DEGTORAD)\r\n        set y = yc + 1000 * Sin( r * bj_DEGTORAD)\r\n        call SaveReal( udg_hash, id, StringHash( \"bszp1\" ), r + 1 )\r\n        call SetUnitPosition( dummy, x, y )\r\n        call SetUnitFacing( dummy, 90 + r )\r\n    endif\r\n    \r\n    set boss = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Zapper2Fire takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"bszpfire\" ) )\r\n    local unit un = LoadUnitHandle( udg_hash, id, StringHash( \"bszpfireu\" ) )\r\n    local unit t = LoadUnitHandle( udg_hash, id, StringHash( \"bszpfiret\" ) )\r\n    local real x = LoadReal( udg_hash, id, StringHash( \"bszpfirex\" ) )\r\n    local real y = LoadReal( udg_hash, id, StringHash( \"bszpfirey\" ) )\r\n    local real r = LoadReal( udg_hash, id, StringHash( \"bszpfire\" ) )\r\n    local real dummyX = GetUnitX( dummy )\r\n    local real dummyY = GetUnitY( dummy )\r\n    local real angle = Atan2( y - dummyY, x - dummyX )\r\n    local real NewX = dummyX + 0.03 * r * Cos( angle )\r\n    local real NewY = dummyY + 0.03 * r * Sin( angle )\r\n    local real IfX = ( x - dummyX ) * ( x - dummyX )\r\n    local real IfY = ( y - dummyY ) * ( y - dummyY )\r\n    \r\n    if GetUnitState( un, UNIT_STATE_LIFE) <= 0.405 or not( udg_fightmod[0] ) or SquareRoot( IfX + IfY ) <= 25 then\r\n        if IsUnitAlive(un) then\r\n            call GroupAoE( un, NewX, NewY, 100, 125, \"enemy\", \"Abilities\\\\Spells\\\\Other\\\\Incinerate\\\\FireLordDeathExplode.mdl\", null )\r\n        endif\r\n        call RemoveUnit( t )\r\n        call RemoveUnit( dummy )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else \r\n        call SetUnitPosition( dummy, NewX, NewY )\r\n    endif\r\n    \r\n    set un = null\r\n    set t = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Zapper2CreateProjectile takes unit u returns nothing\r\n\tlocal real xTarget\r\n    local real yTarget\r\n    local unit targetPoint\r\n    local unit projectile\r\n    local real r\r\n    local real x\r\n    local real y\r\n    local integer id\r\n    local unit target\r\n    \r\n    set target = DeathSystem_GetRandomAliveHero()\r\n    if target != null and GetRandomInt(1, 5) == 1 then\r\n    \tset xTarget = GetUnitX( target ) + GetRandomReal( -75, 75 )\r\n\t\tset yTarget = GetUnitY( target ) + GetRandomReal( -75, 75 )\r\n    else\r\n\t\tset xTarget = GetUnitX( u ) + GetRandomReal( -900, 900 )\r\n\t\tset yTarget = GetUnitY( u ) + GetRandomReal( -900, 900 )\r\n    endif\r\n    \r\n    set targetPoint = CreateUnit( GetOwningPlayer( u ), 'u000', xTarget, yTarget, 270 )\r\n    call UnitAddAbility( targetPoint, 'A136')\r\n    \r\n    set projectile = dummyspawn( u, 0, 'A07D', 0, 0 )\r\n    set x = GetUnitX(projectile) - xTarget\r\n    set y = GetUnitY(projectile) - yTarget\r\n    set r = SquareRoot(x * x + y * y)\r\n    call SetUnitFlyHeight( projectile, 500, -r / ( r * 0.04 ) )\r\n    \r\n    set id = InvokeTimerWithUnit( projectile, \"bszpfire\", 0.04, true, function Zapper2Fire )\r\n\tcall SaveReal( udg_hash, id, StringHash( \"bszpfirex\" ), xTarget ) \r\n    call SaveReal( udg_hash, id, StringHash( \"bszpfirey\" ), yTarget )\r\n    call SaveReal( udg_hash, id, StringHash( \"bszpfire\" ), r )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"bszpfiret\" ), targetPoint )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"bszpfireu\" ), u )\r\n        \r\n    set target = null\r\n    set targetPoint = null\r\n    set projectile = null\r\nendfunction\r\n\r\nfunction Zapper2Cast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"bszp\" ) )\r\n\r\n    if GetUnitState( u, UNIT_STATE_LIFE) <= 0.405 or not( udg_fightmod[0] ) then\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    else\r\n        call Zapper2CreateProjectile(u)\r\n    endif\r\nendfunction\r\n\r\nfunction Trig_Zapper1_Actions takes nothing returns nothing\r\n    local integer id \r\n    local real x = GetRectCenterX(udg_Boss_Rect)\r\n    local real y = GetRectCenterY(udg_Boss_Rect) + 300\r\n\r\n    call DisableTrigger( GetTriggeringTrigger() )\r\n    set bj_lastCreatedUnit = CreateUnit( GetOwningPlayer( udg_DamageEventTarget ), 'u005', x, y, GetUnitFacing(udg_DamageEventTarget) )\r\n    \r\n    set id = GetHandleId( bj_lastCreatedUnit )\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"bszp\" ) ) == null  then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"bszp\" ), CreateTimer() )\r\n    endif\r\n\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"bszp\" ) ) ) \r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"bszp\" ), bj_lastCreatedUnit )\r\n\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"bszp\" ) ), 0.5, true, function Zapper2Cast )\r\n    \r\n    set id = GetHandleId( udg_DamageEventTarget )\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"bszp1\" ) ) == null  then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"bszp1\" ), CreateTimer() )\r\n    endif\r\n\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"bszp1\" ) ) ) \r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"bszp1\" ), udg_DamageEventTarget )\r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"bszp1d\" ), bj_lastCreatedUnit )\r\n    call SaveReal( udg_hash, id, StringHash( \"bszp1x\" ), x )\r\n    call SaveReal( udg_hash, id, StringHash( \"bszp1y\" ), y )\r\n\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"bszp1\" ) ), 0.02, true, function Zapper1Cast )\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_Zapper1 takes nothing returns nothing\r\n    set gg_trg_Zapper1 = CreateTrigger(  )\r\n    call DisableTrigger( gg_trg_Zapper1 )\r\n    call TriggerRegisterVariableEvent( gg_trg_Zapper1, \"udg_AfterDamageEvent\", EQUAL, 1.00 )\r\n    call TriggerAddCondition( gg_trg_Zapper1, Condition( function Trig_Zapper1_Conditions ) )\r\n    call TriggerAddAction( gg_trg_Zapper1, function Trig_Zapper1_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}