{
  "Id": 50333570,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope Wyrm1 initializer init\r\n\r\n\tglobals\r\n\t\tprivate constant integer COOLDOWN = 6\r\n\t\t\r\n\t\tprivate constant real MOVE_TICK = 0.04\r\n\t\tprivate constant integer SHARD_INITIAL_HEIGHT = 500\r\n\t\tprivate constant real FLY_DURATION = 2\r\n\t\tprivate constant real DAMAGE = 400\r\n\t\tprivate constant real DAMAGE_AREA = 150\r\n\t\t\r\n\t\tprivate constant string ANIMATION = \"Objects\\\\Spawnmodels\\\\NightElf\\\\NECancelDeath\\\\NECancelDeath.mdl\"\r\n\t\tprivate constant integer SHARD_PARTICLE = 'A13T'\r\n\tendglobals\r\n\r\n\tprivate function condition takes nothing returns boolean\r\n\t    return GetUnitTypeId(udg_DamageEventTarget) == 'o00M'\r\n\tendfunction\r\n\t\r\n\tprivate function WyrmFrostFire takes nothing returns nothing\r\n\t    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n\t    local unit shard = LoadUnitHandle( udg_hash, id, StringHash( \"wyrm_shardmove\" ) )\r\n\t    local unit boss\r\n\t    local real tickSpeed = LoadReal( udg_hash, id, StringHash( \"wyrm_shardmove\" ) )\r\n\t    local location targetLoc = LoadLocationHandle( udg_hash, id, StringHash( \"wyrm_shardmove_loc\" ) )\r\n\t    local location shardLoc = GetUnitLoc(shard)\r\n\t    local location newLoc = LocationSystem_PolarProjection( shardLoc, targetLoc, tickSpeed )\r\n\t    local real distance = DistanceBetweenPoints( shardLoc, targetLoc )\r\n\t    \r\n\t    /*call BJDebugMsg(\"shard: \" + GetUnitName(shard))\r\n\t    call BJDebugMsg(\"distance: \" + R2S(distance))\r\n\t    call BJDebugMsg(\"targetPoint: x: \" + R2S(GetLocationX(targetLoc)) + \" y: \" + R2S(GetLocationY(targetLoc)))\r\n\t    call BJDebugMsg(\"shard: x: \" + R2S(GetLocationX(shardLoc)) + \" y: \" + R2S(GetLocationY(shardLoc)))*/\r\n\t    \r\n\t    if distance <= 25 then\r\n\t    \tset boss = LoadUnitHandle( udg_hash, id, StringHash( \"wyrm_shardmove_boss\" ) )\r\n\t\t    call GroupAoE( boss, GetLocationX(newLoc), GetLocationY(newLoc), DAMAGE, DAMAGE_AREA, \"enemy\", ANIMATION, \"\" )\r\n\t        \r\n\t        call RemoveLocation(targetLoc)\r\n\t        call RemoveUnit( shard )\r\n\t        call DestroyTimer( GetExpiredTimer() )\r\n\t    else \r\n\t        call SetUnitPositionLoc( shard, newLoc )\r\n\t    endif\r\n\t    \r\n\t    call RemoveLocation(shardLoc)\r\n\t    call RemoveLocation(newLoc)\r\n\t    set newLoc = null\r\n        set targetLoc = null\r\n        set shardLoc = null\r\n\t    set shard = null\r\n\t    set boss = null\r\n\tendfunction\r\n\t\r\n\tprivate function SpawnShard takes unit boss, unit target returns nothing\r\n\t\tlocal unit shard\r\n\t    local real range\r\n\t    local integer id\r\n\t    local real x = GetUnitX( target )\r\n\t    local real y = GetUnitY( target )\r\n\t    local location targetLoc = Location(x, y)\r\n\t    local location shardLoc\r\n\t    local real speed\r\n\t    local real fallSpeed\r\n\t    \r\n\t\tcall IndicatorSystem_Create( INDICATOR_WARNING, x, y, DAMAGE_AREA, FLY_DURATION )\r\n\r\n        set shard = dummyspawn( boss, 0, SHARD_PARTICLE, 0, 0 )\r\n        set shardLoc = GetUnitLoc(shard)\r\n        \r\n        set range = DistanceBetweenPoints( shardLoc, targetLoc)\r\n        set speed = range * MOVE_TICK / FLY_DURATION\r\n        set fallSpeed = -range / ( range * MOVE_TICK )\r\n        \r\n        call SetUnitFlyHeight( shard, SHARD_INITIAL_HEIGHT, fallSpeed )\r\n        \r\n        set id = InvokeTimerWithUnit( shard, \"wyrm_shardmove\", MOVE_TICK, true, function WyrmFrostFire )\r\n        call SaveReal( udg_hash, id, StringHash( \"wyrm_shardmove\" ), speed ) \r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"wyrm_shardmove_shard\" ), shard )\r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"wyrm_shardmove_boss\" ), boss )\r\n        call SaveLocationHandle( udg_hash, id, StringHash( \"wyrm_shardmove_loc\" ), targetLoc )\r\n        \r\n        call RemoveLocation(shardLoc)\r\n        set targetLoc = null\r\n        set shardLoc = null\r\n\t\tset boss = null\r\n\t\tset target = null\r\n\t\tset shard = null\r\n\tendfunction\r\n\t\r\n\tprivate function WyrmFrostCast takes nothing returns nothing\r\n\t    local integer id = GetHandleId( GetExpiredTimer() )\r\n\t    local unit boss = LoadUnitHandle( udg_hash, id, StringHash( \"wyrm_shard_tick_boss\" ) )\r\n\t    local integer i\r\n\t    \r\n\t    if IsUnitDeadBJ(boss) or  udg_fightmod[0] == false then\r\n\t        call DestroyTimer( GetExpiredTimer() )\r\n\t    else\r\n\t    \tset i = 1\r\n\t        loop\r\n\t            exitwhen i > 4\r\n\t            if IsUnitAlive( udg_hero[i]) then\r\n\t                call SpawnShard(boss, udg_hero[i])\r\n\t            endif\r\n\t            set i = i + 1\r\n\t        endloop\r\n\t    endif\r\n\t    \r\n\t    set boss = null\r\n\tendfunction\r\n\t\r\n\tprivate function action takes nothing returns nothing\r\n\t    local integer id = GetHandleId( udg_DamageEventTarget )\r\n\t    \r\n\t    call DisableTrigger( GetTriggeringTrigger() )\r\n\t    call DestroyTimer( LoadTimerHandle( udg_hash, id, StringHash( \"wyrm_start_dealy\" ) ) )\r\n\t    call UnitAddAbility( udg_DamageEventTarget, 'Awan')\r\n\t    \r\n\t    if LoadTimerHandle( udg_hash, id, StringHash( \"wyrm_shard_tick\" ) ) == null  then\r\n\t        call SaveTimerHandle( udg_hash, id, StringHash( \"wyrm_shard_tick\" ), CreateTimer() )\r\n\t    endif\r\n\t\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"wyrm_shard_tick\" ) ) ) \r\n\t    call SaveUnitHandle( udg_hash, id, StringHash( \"wyrm_shard_tick_boss\" ), udg_DamageEventTarget )\r\n\t\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"wyrm_shard_tick\" ) ), bosscast(COOLDOWN), true, function WyrmFrostCast )\r\n\tendfunction\r\n\t\r\n\t//===========================================================================\r\n\tprivate function init takes nothing returns nothing\r\n\t    set gg_trg_Wyrm1 = CreateTrigger(  )\r\n\t    call DisableTrigger( gg_trg_Wyrm1 )\r\n\t    call TriggerRegisterVariableEvent( gg_trg_Wyrm1, \"udg_DamageModifierEvent\", EQUAL, 1.00 )\r\n\t    call TriggerAddCondition( gg_trg_Wyrm1, Condition( function condition ) )\r\n\t    call TriggerAddAction( gg_trg_Wyrm1, function action )\r\n\tendfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [
    {
      "LocalVar": 1,
      "variable": {
        "Id": 0,
        "ArraySize": [
          1,
          1
        ],
        "Name": "UntitledVariable",
        "Type": "integer",
        "IsArray": false,
        "IsTwoDimensions": false,
        "InitialValue": {
          "ParamType": 5,
          "value": "0"
        }
      }
    }
  ],
  "Conditions": [],
  "Actions": []
}