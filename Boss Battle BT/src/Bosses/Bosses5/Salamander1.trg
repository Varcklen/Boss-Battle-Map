{
  "Id": 50333531,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "function Trig_Salamander1_Conditions takes nothing returns boolean\r\n    return GetUnitTypeId(udg_DamageEventTarget) == 'n041'\r\nendfunction\r\n\r\nfunction Salamander1_Movement takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit boss =  LoadUnitHandle( udg_hash, id, StringHash( \"cerf\" ) )\r\n    local real SalamanderAccelerationx = 0.3\r\n    local real SalamanderAccelerationy = 0.3\r\n    local real SalamanderSpeedx = udg_SalamanderSpeed[0] //скорость саламандры глобальная переменная массив integer\r\n    local real SalamanderSpeedy = udg_SalamanderSpeed[1]\r\n    local real BossPosx = 0.00\r\n    local real HeroPosx = 0.00\r\n    local real BossPosy = 0.00\r\n    local real HeroPosy = 0.00\r\n    local integer Hero1 = 0\r\n    local integer Time2 = udg_counter[0]//счетчик глобальная переменная массив integer\r\n    local integer Time3 = udg_counter[1]\r\n    local integer Time4 = udg_counter[2]\r\n    local group g = CreateGroup()\r\n    local unit u\r\n    \r\n    if GetUnitState( boss, UNIT_STATE_LIFE) <= 0.405 or not( udg_fightmod[0] ) then\r\n        call DestroyTimer( GetExpiredTimer() )\r\n        call FlushChildHashtable( udg_hash, id )\r\n    else\r\n        set Time2 = udg_counter[0] + 1\r\n        if GetUnitAbilityLevel( boss, 'BEer' ) > 0 or GetUnitAbilityLevel( boss, 'BPSE' ) > 0 or GetUnitAbilityLevel( boss, 'B043' ) > 0 or IsUnitPaused(boss) then//внести сюда все станящие абилки, так же при стане не кдшатся скилы боса\r\n            set Time2 = 1\r\n        else\r\n            //set Hero = 1\r\n            //loop \r\n            //exitwhen GetUnitState(udg_hero[Hero], UNIT_STATE_LIFE) > 0.405\r\n            //    set Hero = Hero + 1\r\n            //endloop\r\n            set SalamanderSpeedx = udg_SalamanderSpeed[0] + SalamanderAccelerationx * CosBJ (GetUnitFacing (boss))\r\n            set SalamanderSpeedy = udg_SalamanderSpeed[1] + SalamanderAccelerationy * SinBJ (GetUnitFacing (boss))\r\n            if SalamanderSpeedy > 12 then\r\n                set SalamanderSpeedy = 10 //максимальная скорость\r\n            endif\r\n            if SalamanderSpeedy < -12 then\r\n                set SalamanderSpeedy = -10\r\n            endif\r\n            if SalamanderSpeedx > 12 then\r\n                set SalamanderSpeedx = 10\r\n            endif\r\n            if SalamanderSpeedx < -12 then\r\n                set SalamanderSpeedx = -10\r\n            endif\r\n            set BossPosx = GetUnitX(boss) + SalamanderSpeedx\r\n            set BossPosy = GetUnitY(boss) + SalamanderSpeedy\r\n            if IsTerrainPathable(BossPosx,BossPosy, PATHING_TYPE_WALKABILITY) == FALSE then //проверка проходимости\r\n                call SetUnitX (boss,BossPosx)\r\n                call SetUnitY (boss,BossPosy)\r\n            else\r\n                set SalamanderSpeedx = 0//сброс скорости если непроходимо\r\n                set SalamanderSpeedy = 0\r\n            endif\r\n            if RAbsBJ (SalamanderSpeedx) + RAbsBJ (SalamanderSpeedy)< 2 and Time2 > 200 then// оглушение боса при замедлении раз в 6 секунд(200*0.03)абилка новое переделана работа на самого боса\r\n                call dummyspawn( boss, 1, 'A0JW', 0, 0 )\r\n                call IssueTargetOrder( bj_lastCreatedUnit, \"thunderbolt\", boss )\r\n                set SalamanderSpeedx = 0\r\n                set SalamanderSpeedy = 0\r\n                set Time2 = 0\r\n            endif\r\n            if GetUnitLifePercent(boss) <= 75 then\r\n                set Time3 = udg_counter[1] + 1\r\n                set Hero1 = 1\r\n                loop\r\n                    if RAbsBJ(BossPosx - GetUnitX(udg_hero[Hero1]))+ RAbsBJ(BossPosy - GetUnitY(udg_hero[Hero1]))<250 and Time3 > 300 then\r\n                        call GroupEnumUnitsInRange( g, GetUnitX( boss ), GetUnitY( boss ), 300, null )\r\n                        call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Human\\\\ThunderClap\\\\ThunderClapCaster.mdl\", BossPosx, BossPosy ) )\r\n                        loop\r\n                            set u = FirstOfGroup(g)\r\n                        exitwhen u == null\r\n                            if unitst( u, boss, \"enemy\" ) then\r\n                                call dummyspawn( boss, 1, 0, 0, 0 )\r\n                                call UnitStun(boss, u, 3 )\r\n                                call UnitDamageTarget( boss, u, 125, true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)//оглушение героев если они близко раз в 9 секунд абилка взята от медведя\r\n                            endif\r\n                            call GroupRemoveUnit(g,u)\r\n                            set u = FirstOfGroup(g)\r\n                        endloop\r\n                        set Time3 = 0\r\n                    endif\r\n                exitwhen Hero1>4\r\n                    set Hero1 = Hero1 + 1\r\n                endloop\r\n            endif\r\n            if GetUnitLifePercent(boss) <= 50 then\r\n                set Time4 = udg_counter[2] + 1\r\n                if RAbsBJ (BossPosx-udg_BossPos[0])+ RAbsBJ (BossPosy-udg_BossPos[1])>320 and Time4 < 450 then//поджог земли при перемещении в течении 14 секунд потом 14 секунд отдыха абилка стандартная\r\n                    set udg_BossPos[0]=BossPosx\r\n                    set udg_BossPos[1]=BossPosy \r\n                    call dummyspawn( boss, 1, 'A0JT',0, 0)\r\n                    call IssuePointOrder( bj_lastCreatedUnit, \"flamestrike\", GetUnitX( boss ), GetUnitY( boss ) )\r\n                endif\r\n                if Time4 > 900 then\r\n                    set Time4 = 0\r\n                endif\r\n            endif\r\n            set udg_SalamanderSpeed[0] = SalamanderSpeedx\r\n            set udg_SalamanderSpeed[1] = SalamanderSpeedy\r\n            set udg_counter[0] = Time2\r\n            set udg_counter[1] = Time3\r\n            set udg_counter[2] = Time4\r\n        endif\r\n    endif\r\n    \r\n    call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set u = null\r\n    set g = null\r\n    set boss = null\r\nendfunction\r\n\r\nfunction Trig_Salamander1_Actions takes nothing returns nothing\r\n    local integer id = GetHandleId( udg_DamageEventTarget )\r\n\r\n    call DisableTrigger( GetTriggeringTrigger() )\r\n\r\n    if LoadTimerHandle( udg_hash, id, StringHash( \"cerf\" ) ) == null  then\r\n        call SaveTimerHandle( udg_hash, id, StringHash( \"cerf\" ), CreateTimer() )\r\n    endif\r\n\tset id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"cerf\" ) ) ) \r\n    call SaveUnitHandle( udg_hash, id, StringHash( \"cerf\" ), udg_DamageEventTarget )\r\n\tcall TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_DamageEventTarget ), StringHash( \"cerf\" ) ), 0.03, true, function Salamander1_Movement )\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_Salamander1 takes nothing returns nothing\r\n    set gg_trg_Salamander1 = CreateTrigger(  )\r\n    call DisableTrigger( gg_trg_Salamander1 )\r\n    call TriggerRegisterVariableEvent( gg_trg_Salamander1, \"udg_AfterDamageEvent\", EQUAL, 1.00 )\r\n    call TriggerAddCondition( gg_trg_Salamander1, Condition( function Trig_Salamander1_Conditions ) )\r\n    call TriggerAddAction( gg_trg_Salamander1, function Trig_Salamander1_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}