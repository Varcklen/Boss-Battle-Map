{
  "Id": 50333710,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals\r\n    real Event_SomeoneDied_Real\r\n    unit Event_SomeoneDied_WhoDied\r\n    unit Event_SomeoneDied_Unit\r\nendglobals\r\n\r\nfunction Trig_KillUnit_Conditions takes nothing returns boolean\r\n    return GetUnitAbilityLevel(GetDyingUnit(), 'A1FY') == 0\r\nendfunction\r\n\r\nfunction CamPCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    call UnitRemoveAbility( LoadUnitHandle( udg_hash, id, StringHash( \"camp\" ) ), 'A0UU' )\r\n    call UnitRemoveAbility( LoadUnitHandle( udg_hash, id, StringHash( \"camp\" ) ), 'B055' )\r\n    call FlushChildHashtable( udg_hash, id )\r\nendfunction\r\n\r\nfunction Trig_KillUnit_Actions takes nothing returns nothing\r\n    //local group g = CreateGroup()\r\n    local unit u\r\n    local integer n\r\n    local unit i = LoadUnitHandle( udg_hash, 1, StringHash( \"sklp\" ) )\r\n    local integer cyclA = 1\r\n    local integer cyclAEnd\r\n    local integer cyclB\r\n    local integer id\r\n    local integer k = GetPlayerId(GetOwningPlayer(GetDyingUnit())) + 1\r\n    local integer j = GetPlayerId(GetOwningPlayer(GetKillingUnit())) + 1\r\n    local integer p\r\n    local real pr\r\n\r\n    \r\n\r\n    //When hero kill someone...\r\n    if GetUnitState( udg_hero[j], UNIT_STATE_LIFE) > 0.405 and not( udg_fightmod[3] ) and combat( udg_hero[j], false, 0 ) and IsUnitEnemy(GetDyingUnit(), GetOwningPlayer(udg_hero[j])) and ( GetUnitTypeId(GetKillingUnit()) == 'u000' or GetKillingUnit() == udg_hero[j] ) then\r\n        if inv(udg_hero[j], 'I0BR') > 0 and udg_Item_Souls[j] < 9800 then\r\n            set udg_Item_Souls[j] = udg_Item_Souls[j] + 200\r\n            call ChangeToolItem( udg_hero[j], 'I0BR', \"|cffbe81f2\", \"|r\", I2S(200+udg_Item_Souls[j]) )\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Items\\\\TomeOfRetraining\\\\TomeOfRetrainingCaster.mdl\", GetUnitX( udg_hero[j] ), GetUnitY( udg_hero[j] ) ) )\r\n        endif\r\n    endif\r\n    if GetUnitAbilityLevel(GetDyingUnit(), 'A10I') > 0 then\r\n        set u = LoadUnitHandle( udg_hash, GetHandleId(GetDyingUnit()), StringHash( \"dvred\" ))\r\n        if combat( u, false, 0 ) and not( udg_fightmod[3] ) then\r\n            call spdst( u, LoadReal( udg_hash, GetHandleId(GetDyingUnit()), StringHash( \"dvred\" )) )\r\n            call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\Undead\\\\AnimateDead\\\\AnimateDeadTarget.mdl\", GetUnitX( u ), GetUnitY( u ) ) )\r\n        endif\r\n        call SaveReal( udg_hash, GetHandleId(GetDyingUnit()), StringHash( \"dvred\" ), 0 )\r\n        call SaveUnitHandle( udg_hash, GetHandleId(GetDyingUnit()), StringHash( \"dvred\" ), null )\r\n    endif\r\n\r\n    /*if IsUnitEnemy(GetDyingUnit(), GetOwningPlayer(GetKillingUnit())) and GetUnitTypeId(GetDyingUnit()) != 'h01F' and udg_combatlogic[j] and ( ( inv( GetKillingUnit(), 'I0CR') > 0 ) or ( ( inv( GetKillingUnit(), 'I030') > 0 ) and udg_Set_Weapon_Logic[j + 80] ) ) and ( GetUnitTypeId(GetKillingUnit()) == 'u000' or GetKillingUnit() == udg_hero[j] ) and not(IsUnitType( GetDyingUnit(), UNIT_TYPE_HERO)) and not(IsUnitType( GetDyingUnit(), UNIT_TYPE_ANCIENT)) then\r\n        call DestroyEffect( AddSpecialEffect(\"Objects\\\\Spawnmodels\\\\Orc\\\\OrcSmallDeathExplode\\\\OrcSmallDeathExplode.mdl\", GetUnitX( GetDyingUnit() ), GetUnitY( GetDyingUnit() ) ) )\r\n        set bj_lastCreatedUnit = CreateUnit( GetOwningPlayer( GetKillingUnit() ), GetUnitTypeId(GetDyingUnit()), GetUnitX( GetDyingUnit() ), GetUnitY( GetDyingUnit() ), GetUnitFacing( GetDyingUnit() ) )\r\n        call UnitApplyTimedLife( bj_lastCreatedUnit, 'BTLF', 10 )\r\n    endif*/\r\n\r\n    if GetUnitTypeId(GetDyingUnit()) == 'n044' then\r\n        set udg_logic[96] = true\r\n        call StartSound(gg_snd_QuestLog)\r\n        set udg_DeathPig = udg_DeathPig + 1\r\n        if udg_DeathPig > 3 and GetRandomInt(1,3) == 1 then\r\n            set udg_DeathPig = 0 \r\n            set cyclA = 1\r\n            set cyclAEnd = udg_Heroes_Amount\r\n            loop\r\n                exitwhen cyclA > cyclAEnd\r\n                set bj_lastCreatedUnit = CreateUnitAtLoc( Player(PLAYER_NEUTRAL_AGGRESSIVE), 'n045', Location(GetRandomReal(GetRectMinX(gg_rct_Spawn), GetRectMaxX(gg_rct_Spawn)), GetRandomReal(GetRectMinY(gg_rct_Spawn), GetRectMaxY(gg_rct_Spawn))), GetRandomReal( 0, 360 ) )\r\n                call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Spells\\\\NightElf\\\\BattleRoar\\\\RoarCaster.mdl\", GetUnitX( bj_lastCreatedUnit ), GetUnitY( bj_lastCreatedUnit ) ) )\r\n                call IssueTargetOrder( bj_lastCreatedUnit, \"attackonce\", DeathSystem_GetRandomAliveHero() ) \r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n    endif\r\n    \r\n    if GetUnitAbilityLevel( GetDyingUnit(), 'A196') > 0 and not(udg_fightmod[3]) then\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if GetUnitTypeId(udg_hero[cyclA]) == 'O016' and udg_combatlogic[cyclA] and luckylogic( udg_hero[cyclA], 40, 1, 100 ) then\r\n                call entropy( udg_hero[cyclA], 1 )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    endif\r\n\r\n    if i != null then\r\n        if GetUnitAbilityLevel( i, 'A0CK' ) > 0 and IsUnitEnemy(GetDyingUnit(), GetOwningPlayer( i ) ) and GetUnitState( i, UNIT_STATE_LIFE) > 0.405 and GetUnitName(GetDyingUnit()) != \"dummy\" and GetUnitTypeId(GetDyingUnit()) != 'u001' and GetUnitTypeId(GetDyingUnit()) != 'h009' and GetUnitTypeId(GetDyingUnit()) != 'h01F' then\r\n            call skeletsp( i, GetDyingUnit() )\r\n        endif\r\n    endif\r\n    \r\n    // Runestone Mos Rework disabled this 11.02.2024 (Now an Item Trigger in Common Items)\r\n\t//if inv(udg_hero[k], 'I026') > 0 and luckylogic( udg_hero[k], 20, 1, 100 ) and GetUnitState( udg_hero[k], UNIT_STATE_LIFE) > 0.405 and combat( udg_hero[k], false, 0 ) and not( udg_fightmod[3] ) then\r\n    //    call CreateItem( 'I03J' + GetRandomInt(1, 6), GetUnitX( GetDyingUnit() ), GetUnitY( GetDyingUnit() ) )\r\n    //endif\r\n\r\n    if GetUnitTypeId(GetDyingUnit()) == ID_SHEEP or GetUnitTypeId(GetDyingUnit()) == 'n00E' then\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if (GetUnitAbilityLevel( udg_hero[cyclA], 'A0MG' ) > 0 or GetUnitAbilityLevel( udg_hero[cyclA], 'A0MH' ) > 0) and GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 then\r\n                call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\MarkOfChaos\\\\MarkOfChaosDone.mdl\", udg_hero[cyclA], \"origin\" ) )\r\n                call BlzEndUnitAbilityCooldown( udg_hero[cyclA], udg_Ability_Uniq[cyclA] )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    endif\r\n    \r\n    if GetUnitAbilityLevel( GetDyingUnit(), 'A0CF' ) > 0 then\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 and IsUnitAlly(GetDyingUnit(), GetOwningPlayer(udg_hero[cyclA])) then\r\n                call healst( udg_hero[cyclA], null, GetUnitState( udg_hero[cyclA], UNIT_STATE_MAX_LIFE)*0.2 )\r\n                call DestroyEffect( AddSpecialEffect( \"Abilities\\\\Weapons\\\\FrostWyrmMissile\\\\FrostWyrmMissile.mdl\", GetUnitX( udg_hero[cyclA] ), GetUnitY( udg_hero[cyclA] ) ) )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    endif\r\n    \r\n    if IsUnitType( GetDyingUnit(), UNIT_TYPE_HERO) then\r\n        if IsUnitInGroup(GetDyingUnit(), udg_heroinfo) and udg_combatlogic[k] then\r\n            set udg_Death[k] = true\r\n        endif\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if GetPlayerSlotState( Player( cyclA - 1 ) ) == PLAYER_SLOT_STATE_PLAYING and inv( udg_hero[cyclA], 'I09K') > 0 and combat( udg_hero[cyclA], false, 0 ) and GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 and IsUnitAlly(GetDyingUnit(), GetOwningPlayer(udg_hero[cyclA])) and GetOwningPlayer(GetDyingUnit()) != Player(4) then\r\n            \tcall DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Items\\\\AIso\\\\AIsoTarget.mdl\", udg_hero[cyclA], \"origin\") )\r\n            \tcall KillUnit( udg_hero[cyclA] )\r\n            endif\r\n            if udg_hero[cyclA] != GetDyingUnit() and GetUnitAbilityLevel( udg_hero[cyclA], 'A0EY') > 0 and not( udg_fightmod[3] ) and GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 and IsUnitAlly(GetDyingUnit(), GetOwningPlayer(udg_hero[cyclA])) then\r\n                set p = GetUnitAbilityLevel( udg_hero[cyclA], 'A0EY')\r\n                call healst( udg_hero[cyclA], null, GetUnitState( udg_hero[cyclA], UNIT_STATE_MAX_LIFE) * (0.05+(0.15*p)) )\r\n                call manast( udg_hero[cyclA], null, GetUnitState( udg_hero[cyclA], UNIT_STATE_MAX_MANA) * (0.05+(0.15*p)) )\r\n                call shield( udg_hero[cyclA], null, 100+(100*p) )\r\n                call DestroyEffect( AddSpecialEffect( \"war3mapImported\\\\SoulRitual.mdx\", GetUnitX( udg_hero[cyclA] ), GetUnitY( udg_hero[cyclA] ) ) )\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        if GetUnitAbilityLevel( GetDyingUnit(), 'A0UQ') > 0 then\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 4\r\n                if GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 then\r\n                    set id = GetHandleId( udg_hero[cyclA] )\r\n        \r\n                    call UnitAddAbility( udg_hero[cyclA], 'A0UU' )\r\n                    call SetUnitAbilityLevel( udg_hero[cyclA], 'A0US', GetUnitAbilityLevel( GetDyingUnit(), 'A0UQ' ) )\r\n                    call SetUnitAbilityLevel( udg_hero[cyclA], 'A0UT', GetUnitAbilityLevel( GetDyingUnit(), 'A0UQ' ) )\r\n                    \r\n                    if udg_Database_Hero[29] == 'O00Z' then\r\n                        call DestroyEffect( AddSpecialEffectTarget(\"war3mapImported\\\\RequiemofGhostsCaster.mdx\", udg_hero[cyclA], \"origin\" ) )\r\n                    else\r\n                        call DestroyEffect( AddSpecialEffectTarget(\"Abilities\\\\Spells\\\\NightElf\\\\BattleRoar\\\\RoarCaster.mdl\", udg_hero[cyclA], \"origin\" ) )\r\n                    endif\r\n                    \r\n                    if LoadTimerHandle( udg_hash, id, StringHash( \"camp\" ) ) == null then\r\n                        call SaveTimerHandle( udg_hash, id, StringHash( \"camp\" ), CreateTimer() )\r\n                    endif\r\n                    set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"camp\" ) ) ) \r\n                    call SaveUnitHandle( udg_hash, id, StringHash( \"camp\" ), udg_hero[cyclA] )\r\n                    call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_hero[cyclA] ), StringHash( \"camp\" ) ), timebonus(GetDyingUnit(), 60), false, function CamPCast )\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            if GetUnitAbilityLevel(udg_hero[cyclA], 'A0TP') > 0 and (GetUnitState( udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 or udg_hero[cyclA] == GetDyingUnit() ) then\r\n                set pr = 0.04 * GetUnitAbilityLevel(udg_hero[cyclA], 'A0TP')\r\n                set cyclB = 1\r\n                loop\r\n                    exitwhen cyclB > 4\r\n                    if GetUnitState( udg_hero[cyclB], UNIT_STATE_LIFE) > 0.405 and unitst( udg_hero[cyclB], udg_hero[cyclA], \"ally\" ) and not( udg_fightmod[3] ) then\r\n                        call healst( udg_hero[cyclA], udg_hero[cyclB], GetUnitState(udg_hero[cyclB], UNIT_STATE_MAX_LIFE) * pr )\r\n                        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Human\\\\HolyBolt\\\\HolyBoltSpecialArt.mdl\", udg_hero[cyclB], \"origin\") )\r\n                    endif\r\n                    set cyclB = cyclB + 1\r\n                endloop\r\n            endif\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n    else\r\n        call FlushChildHashtable( udg_hash, GetHandleId(GetDyingUnit()) )\r\n    endif\r\n    \r\n    /*call GroupClear( g )\r\n    call DestroyGroup( g )\r\n    set g = null*/\r\n    set u = null\r\n    set i = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_KillUnit takes nothing returns nothing\r\n    set gg_trg_KillUnit = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_KillUnit, EVENT_PLAYER_UNIT_DEATH )\r\n    call TriggerAddCondition( gg_trg_KillUnit, Condition( function Trig_KillUnit_Conditions ) )\r\n    call TriggerAddAction( gg_trg_KillUnit, function Trig_KillUnit_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}