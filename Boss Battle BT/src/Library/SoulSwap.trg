{
  "Id": 50332100,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library SoulSwap requires BuffDeleteLib\r\n\r\n\tglobals\r\n\t\tpublic boolean Debug = false\r\n\tendglobals\r\n\r\n    function heroswap takes nothing returns nothing\r\n        local integer cyclA\r\n        local integer cyclB\r\n        local integer cyclE\r\n        local group array g\r\n        local unit array un\r\n        local unit u\r\n        local integer array m\r\n        local integer p\r\n        local integer i\r\n        \r\n        if (udg_Heroes_Amount > 1 and udg_Heroes_Amount - udg_Heroes_Deaths > 1) or Debug then\r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 4\r\n                set g[cyclA] = CreateGroup()\r\n                set un[cyclA] = null\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n            \r\n            set cyclE = 1\r\n            loop\r\n                exitwhen cyclE > 1\r\n                set cyclA = 1\r\n                loop\r\n                    exitwhen cyclA > 4\r\n                    if GetUnitState(udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 then\r\n                        set cyclB = 1\r\n                        loop\r\n                            exitwhen cyclB > 4\r\n                            if GetUnitState(udg_hero[cyclB], UNIT_STATE_LIFE) > 0.405 and GetOwningPlayer(udg_hero[cyclB]) != GetOwningPlayer(udg_hero[cyclA]) then\r\n                                call GroupAddUnit(g[cyclB], udg_hero[cyclA])\r\n                            endif\r\n                            set cyclB = cyclB + 1\r\n                        endloop\r\n                    endif\r\n                    set cyclA = cyclA + 1\r\n                endloop\r\n                \r\n                set cyclA = 1\r\n                loop\r\n                    exitwhen cyclA > 4\r\n                    if GetUnitState(udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 then\r\n                        set un[cyclA] = GroupPickRandomUnit(g[cyclA])\r\n                        set m[cyclA] = GetPlayerId(GetOwningPlayer(un[cyclA]))\r\n                        if m[cyclA] == 10 then\r\n                            set m[cyclA] = LoadInteger( udg_hash, GetHandleId( un[cyclA] ), StringHash( \"control\" ) )\r\n                        endif\r\n                        set cyclB = 1\r\n                        loop\r\n                            exitwhen cyclB > 4\r\n                            if IsUnitInGroup(un[cyclA], g[cyclB]) then\r\n                                call GroupRemoveUnit(g[cyclB], un[cyclA])\r\n                            endif\r\n                            set cyclB = cyclB + 1\r\n                        endloop\r\n                    endif\r\n                    set cyclA = cyclA + 1\r\n                endloop\r\n\r\n                set cyclA = 1\r\n                set p = 0\r\n                loop\r\n                    exitwhen cyclA > 4\r\n                    if (GetUnitState(udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 and un[cyclA] != null) or GetUnitState(udg_hero[cyclA], UNIT_STATE_LIFE) <= 0.405 then\r\n                        set p = p + 1\r\n                    endif\r\n                    set cyclA = cyclA + 1\r\n                endloop\r\n            \r\n                if p < 4 then\r\n                    set cyclE = cyclE - 1\r\n                endif\r\n                set cyclE = cyclE + 1\r\n            endloop\r\n            \r\n            set cyclA = 1\r\n            loop\r\n                exitwhen cyclA > 4\r\n                if GetUnitState(udg_hero[cyclA], UNIT_STATE_LIFE) > 0.405 then\r\n                    call DelBuff( udg_hero[cyclA], false )\r\n                    set i = m[cyclA]\r\n                    set ChoosedHero[cyclA] = udg_hero[i]\r\n                    if GetOwningPlayer(udg_hero[cyclA]) == Player(10) then\r\n                        call SaveInteger( udg_hash, GetHandleId( udg_hero[cyclA] ), StringHash( \"control\" ), i )\r\n                    else\r\n                        if Transport[cyclA] != null and IsUnitAlive(Transport[cyclA]) then\r\n                            call PanCameraToTimedForPlayer( Player(i), GetUnitX( Transport[cyclA] ), GetUnitY( udg_hero[cyclA] ), 0.25 )\r\n                            call SetUnitOwner( Transport[cyclA], Player(i), true )\r\n                            call SelectUnitForPlayerSingle( Transport[cyclA], Player(i) )\r\n                        else\r\n                            call PanCameraToTimedForPlayer( Player(i), GetUnitX( udg_hero[cyclA] ), GetUnitY( udg_hero[cyclA] ), 0.25 )\r\n                            call SetUnitOwner( udg_hero[cyclA], Player(i), true )\r\n                            call SelectUnitForPlayerSingle( udg_hero[cyclA], Player(i) )\r\n                        endif\r\n                    endif\r\n                    call DestroyEffect( AddSpecialEffect(\"Abilities\\\\Spells\\\\Other\\\\Charm\\\\CharmTarget.mdl\", GetUnitX(udg_hero[cyclA]), GetUnitY(udg_hero[cyclA])) )\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n        endif\r\n        \r\n        set cyclA = 1\r\n        loop\r\n            exitwhen cyclA > 4\r\n            call GroupClear( g[cyclA] )\r\n            call DestroyGroup( g[cyclA]  )\r\n            set g[cyclA] = null\r\n            set un[cyclA] = null\r\n            set cyclA = cyclA + 1\r\n        endloop\r\n        \r\n        set Debug = false\r\n        \r\n        set u = null\r\n    endfunction\r\n    \r\n    public function End takes nothing returns nothing\r\n        local integer i\r\n        local player owner\r\n        local unit hero\r\n    \r\n        set i = 1\r\n        loop\r\n            exitwhen i > PLAYERS_LIMIT\r\n            set owner = Player( i - 1 )\r\n            set hero = udg_hero[i]\r\n            if GetPlayerSlotState( owner ) == PLAYER_SLOT_STATE_PLAYING then\r\n                set ChoosedHero[i] = hero\r\n                call DelBuff( hero, false )\r\n                if IsUnitAlive(hero) then\r\n                    call PanCameraToTimedLocForPlayer( owner, GetUnitLoc( hero ), 0 )\r\n                endif\r\n                call SetUnitOwner( hero, owner, true )\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        \r\n        set owner = null\r\n        set hero = null\r\n    endfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}