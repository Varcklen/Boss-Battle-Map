{
  "Id": 50332088,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library ShieldstLib initializer init requires BuffsLibLib\r\n\r\n    globals\r\n        real Event_ShieldDestroyed_Real\r\n        unit Event_ShieldDestroyed_Hero\r\n        \r\n        private texttag array TextTagList\r\n        private integer TextTagList_Max = 0\r\n    endglobals\r\n\r\n\tprivate function CleatTexts takes nothing returns nothing\r\n\t\tlocal integer i = 0\r\n\t\t\r\n\t\tloop\r\n\t\t\texitwhen i >= TextTagList_Max\r\n\t\t\tcall DestroyTextTag( TextTagList[i] )\r\n\t\t\tset i = i + 1\r\n\t\tendloop\r\n\t\t\r\n\t\tset TextTagList_Max = 0\r\n\tendfunction\r\n\t\r\n    /*function ShieldEnd takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"shield\" ) )\r\n        local texttag tt = LoadTextTagHandle( udg_hash, id, StringHash( \"shieldtt\" ) )\r\n\r\n        if tt != null then\r\n            call DestroyTextTag( tt )\r\n        endif\r\n        call SaveReal( udg_hash, GetHandleId( u ), StringHash( \"shield\" ), 0 )\r\n        call SaveReal( udg_hash, GetHandleId( u ), StringHash( \"shieldMax\" ), 0 )\r\n        \r\n        call FlushChildHashtable( udg_hash, id )\r\n        \r\n        set u = null\r\n    endfunction*/\r\n    \r\n    function RemoveShield takes unit u returns nothing\r\n        local integer id = GetHandleId( u )\r\n        local texttag tx = LoadTextTagHandle( udg_hash, id, StringHash( \"shldtx\" ) )\r\n    \r\n        call DestroyTextTag( tx )\r\n        call SaveTextTagHandle( udg_hash, id, StringHash( \"shldtx\" ), null )\r\n        call SaveReal( udg_hash, id, StringHash( \"shield\" ), 0 )\r\n        call SaveReal( udg_hash, id, StringHash( \"shieldMax\" ), 0 )\r\n        call UnitRemoveAbility( u, 'A11F' )\r\n        call UnitRemoveAbility( u, 'B05P' )\r\n        \r\n        set Event_ShieldDestroyed_Hero = u\r\n        set Event_ShieldDestroyed_Real = 0.00\r\n        set Event_ShieldDestroyed_Real = 1.00\r\n        set Event_ShieldDestroyed_Real = 0.00\r\n        \r\n        set tx = null\r\n        set u = null\r\n    endfunction\r\n\r\n    private function ShieldCast takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"shld\" ) )\r\n        local texttag tx = LoadTextTagHandle( udg_hash, GetHandleId( u ), StringHash( \"shldtx\" ) )\r\n        local real l = LoadReal( udg_hash, GetHandleId( u ), StringHash( \"shield\" ) )\r\n        local real lmax = LoadReal( udg_hash, GetHandleId( u ), StringHash( \"shieldMax\" ) )\r\n\r\n        if l < 1 or GetUnitState( u, UNIT_STATE_LIFE) <= 0.405 or tx == null then\r\n            call RemoveShield(u)\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n            call SetTextTagText(tx, I2S(R2I(l)) + \"/\" + I2S(R2I(lmax)), 0.03 )\r\n            call SetTextTagPosUnit(tx, u, -300)\r\n        endif\r\n        \r\n        set u = null\r\n        set tx = null\r\n    endfunction\r\n\r\n    function shield takes unit caster, unit target, real shiledValue returns nothing\r\n        local integer id\r\n        local real l \r\n        local real lmax\r\n        local texttag tt = null\r\n        \r\n        if shiledValue < 1 then\r\n        \treturn\r\n        endif\r\n        \r\n        if target == null then\r\n            set target = caster\r\n        endif\r\n        \r\n        if IsUnitType( target, UNIT_TYPE_HERO) == false and IsUnitType( target, UNIT_TYPE_ANCIENT) == false then\r\n        \treturn\r\n        endif\r\n        \r\n        set shiledValue = shiledValue * GetUnitSpellPower(caster)\r\n        set l = LoadReal( udg_hash, GetHandleId( target ), StringHash( \"shield\" ) ) + shiledValue\r\n        set lmax = LoadReal( udg_hash, GetHandleId( target ), StringHash( \"shieldMax\" ) )\r\n        if l > lmax then\r\n            set lmax = l\r\n        endif\r\n        \r\n        if LoadTextTagHandle( udg_hash, GetHandleId( target ), StringHash( \"shldtx\" ) ) == null then\r\n            if l >= 150 then\r\n                call DestroyEffect( AddSpecialEffectTarget(\"Abilities\\\\Spells\\\\Items\\\\AIre\\\\AIreTarget.mdl\", target, \"origin\" ) )\r\n            endif\r\n            set id = GetHandleId( target )\r\n            if LoadTimerHandle( udg_hash, id, StringHash( \"shld\" ) ) == null then\r\n                call SaveTimerHandle( udg_hash, id, StringHash( \"shld\" ), CreateTimer() )\r\n            endif\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"shld\" ) ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"shld\" ), target )\r\n            set tt = CreateTextTag()\r\n            set TextTagList[TextTagList_Max] = tt\r\n        \tset TextTagList_Max = TextTagList_Max + 1\r\n            \r\n            call SetTextTagText(tt, I2S(R2I(l)) + \"/\" + I2S(R2I(lmax)), 0.03)\r\n            call SetTextTagPosUnit(tt, target, -300)\r\n            call SetTextTagColor(tt, 153, 153, 255, 127 )\r\n            call SaveTextTagHandle( udg_hash, GetHandleId( target ), StringHash( \"shldtx\" ), tt )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"shld\" ) ), 0.04, true, function ShieldCast )\r\n        endif\r\n\r\n        call UnitAddAbility( target, 'A11F' )\r\n        call SaveReal( udg_hash, GetHandleId( target ), StringHash( \"shield\"  ), l )\r\n        call SaveReal( udg_hash, GetHandleId( target ), StringHash( \"shieldMax\" ), lmax )\r\n        \r\n        /*set id = GetHandleId( target )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"shield\" ) ) == null then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"shield\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"shield\" ) ) ) \r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"shield\" ), target )\r\n        if tt != null then\r\n            call SaveTextTagHandle( udg_hash, id, StringHash( \"shieldtt\" ), tt )\r\n        endif\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( target ), StringHash( \"shield\" ) ), t, false, function ShieldEnd )*/\r\n        \r\n        set tt = null\r\n    endfunction\r\n    \r\n    //Buff Remove\r\n    //===========================================================================\r\n    private function DeleteBuff_Conditions takes nothing returns boolean\r\n        return GetUnitAbilityLevel( Event_DeleteBuff_Unit, 'B05P') > 0\r\n    endfunction\r\n    \r\n    private function DeleteBuff takes nothing returns nothing\r\n        call RemoveShield(Event_DeleteBuff_Unit)\r\n    endfunction\r\n\r\n    private function init takes nothing returns nothing\r\n    \tcall CreateEventTrigger( \"Event_DeleteBuff_Real\", function DeleteBuff, function DeleteBuff_Conditions )\r\n    \tcall CreateEventTrigger( \"udg_FightEndGlobal_Real\", function CleatTexts, null )\r\n    endfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}