{
  "Id": 50332089,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "library HealstLib requires DummyspawnLib, Inventory, TimebonusLib, RandomTargetLib, Multiboard, ShieldstLib\r\n\r\n    globals\r\n        real Event_OnHealChange_Real\r\n        real Event_OnHealChange_StaticHeal\r\n        real Event_OnHealChange_Heal\r\n        unit Event_OnHealChange_Caster\r\n        unit Event_OnHealChange_Target\r\n        \r\n        real Event_AfterHealChange_Real\r\n        real Event_AfterHealChange_StaticHeal\r\n        real Event_AfterHealChange_Heal\r\n        unit Event_AfterHealChange_Caster\r\n        unit Event_AfterHealChange_Target\r\n        \r\n        real Event_AfterHeal_Real\r\n        real Event_AfterHeal_Heal\r\n        unit Event_AfterHeal_Caster\r\n        unit Event_AfterHeal_Target\r\n        \r\n        boolean IsHealFromPotion = false\r\n    endglobals\r\n\r\n    function PeacelockE_End takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit n = LoadUnitHandle( udg_hash, id, StringHash( \"pcke\" ) )\r\n        local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"pckec\" ) )\r\n        local real dmg = LoadReal( udg_hash, id, StringHash( \"pcke\" ) )\r\n\r\n        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Weapons\\\\IllidanMissile\\\\IllidanMissile.mdl\", n, \"origin\" ) )\r\n        call dummyspawn( u, 1, 0, 0, 0 )\r\n        call UnitDamageTarget( bj_lastCreatedUnit, n, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n\r\n        call FlushChildHashtable( udg_hash, id )\r\n\r\n        set n = null\r\n        set u = null\r\n    endfunction\r\n\r\n    function OrbHolyFire takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"orbhf\" ) )\r\n        local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"orbhfc\" ) )\r\n        local real dmg = LoadReal( udg_hash, id, StringHash( \"orbhf\" ) )\r\n        local group g = CreateGroup()\r\n        local unit u\r\n\r\n        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Other\\\\Incinerate\\\\FireLordDeathExplode.mdl\", target, \"origin\" ) )\r\n        call dummyspawn( caster, 1, 0, 0, 0 )\r\n        call GroupEnumUnitsInRange( g, GetUnitX( target ), GetUnitY( target ), 300, null )\r\n        loop\r\n            set u = FirstOfGroup(g)\r\n            exitwhen u == null\r\n            if unitst( u, caster, \"enemy\" ) then \r\n                call UnitDamageTarget( bj_lastCreatedUnit, u, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n            endif\r\n            call GroupRemoveUnit(g,u)\r\n        endloop\r\n\r\n        call FlushChildHashtable( udg_hash, id )\r\n\r\n        call GroupClear( g )\r\n        call DestroyGroup( g )\r\n        set g = null\r\n        set u = null\r\n        set target = null\r\n        set caster = null\r\n    endfunction\r\n\r\n    private function HealUnit takes unit caster, unit target, real r returns nothing\r\n        local integer i = GetPlayerId( GetOwningPlayer( caster ) ) + 1\r\n        local integer cyclA = 1\r\n        local integer id\r\n        local real t\r\n        local real tm\r\n        local real rst\r\n        local real rfun\r\n        local real rsp = r\r\n        local real hlp = LoadReal( udg_hash, GetHandleId( udg_hero[i] ), StringHash( \"healpot\" ) )\r\n        local unit u\r\n        local unit n\r\n        local real h = r\r\n        local real p\r\n\r\n        if target == null then\r\n            set u = caster\r\n        else\r\n            set u = target\r\n        endif\r\n        \r\n        set Event_OnHealChange_StaticHeal = h\r\n        set Event_OnHealChange_Heal = h\r\n        set Event_OnHealChange_Caster = caster\r\n        set Event_OnHealChange_Target = u\r\n    \r\n        set Event_OnHealChange_Real = 0.00\r\n        set Event_OnHealChange_Real = 1.00\r\n        set Event_OnHealChange_Real = 0.00\r\n        \r\n        set rsp = Event_OnHealChange_Heal\r\n        \r\n        if GetOwningPlayer(u) != Player(PLAYER_NEUTRAL_AGGRESSIVE) then\r\n            set rsp = rsp + ( h * ( udg_BossHeal[i] - 1 ) )\r\n        endif\r\n        set rsp = rsp + ( h * ( RMaxBJ( 0, GetUnitSpellPower(caster) ) - 1 ) )\r\n        \r\n        if GetUnitAbilityLevel( u, 'B04T') > 0 then\r\n            set rsp = rsp+h\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B04S') > 0 then\r\n            set rsp = rsp + (h*0.5)\r\n        endif\r\n        if inv( caster, 'I0A0') > 0 and luckylogic( caster, 25, 1, 100 ) then\r\n            set rsp = rsp + h\r\n        endif\r\n        if inv( caster, 'I0AU') > 0 then\r\n            set rsp = rsp + (h*0.2)\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B08R' ) > 0 then\r\n            set rsp = rsp + (h*LoadReal( udg_hash, GetHandleId( u ), StringHash( \"snkwh\" ) ) )\r\n        endif\r\n        if inv( u, 'I00D') > 0 and not(udg_logic[GetPlayerId( GetOwningPlayer( u ) ) + 1 + 26]) then\r\n            set rsp = rsp - (h*0.4)\r\n        endif\r\n        if GetUnitAbilityLevel(caster, 'B09J') > 0 then\r\n            set rsp = rsp + h\r\n        endif\r\n        if udg_modbad[13] then\r\n            set rsp = rsp - (h*0.15)\r\n        endif\r\n        if inv( caster, 'I0DZ') > 0 then\r\n            set rsp = rsp + (h*1.5)\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B04O') > 0 then\r\n            set rsp = rsp + (LoadReal( udg_hash, GetHandleId( u ), StringHash( \"pckrb\" ))*h) \r\n        endif\r\n        if GetUnitAbilityLevel( u, 'A0VX') > 0 then\r\n            set rsp = rsp + ( h * ( 0.2 * GetUnitAbilityLevel( u, 'A0VX') ) )\r\n        endif\r\n        if GetUnitAbilityLevel( caster, 'B014') > 0 then\r\n            set rsp = rsp + (h*0.75)\r\n        endif \r\n        if GetUnitAbilityLevel( caster, 'B04T') > 0 then\r\n            set rsp = rsp + h\r\n        endif\r\n        ///\r\n        set Event_AfterHealChange_StaticHeal = rsp\r\n        set Event_AfterHealChange_Heal = rsp\r\n        set Event_AfterHealChange_Caster = caster\r\n        set Event_AfterHealChange_Target = u\r\n    \r\n        set Event_AfterHealChange_Real = 0.00\r\n        set Event_AfterHealChange_Real = 1.00\r\n        set Event_AfterHealChange_Real = 0.00\r\n        \r\n        set rsp = Event_AfterHealChange_Heal\r\n        \r\n        if udg_logic[73] then\r\n            set rsp = rsp * udg_real[0]\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B03F') > 0 then\r\n            set rsp = rsp * 0.5\r\n        endif\r\n        if inv( u, 'I09N') > 0 then\r\n            set rsp = 0\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B07E') > 0 then\r\n            set rsp = 0\r\n        endif\r\n        if GetUnitAbilityLevel( u, 'B07W') > 0 then\r\n            set rsp = 0\r\n        endif\r\n        ///\r\n        if GetUnitState( u, UNIT_STATE_LIFE) >= ( GetUnitState( u, UNIT_STATE_MAX_LIFE ) - rsp ) then\r\n            if inv( caster, 'I0CN') > 0 then\r\n                call shield( u, u, rsp*0.3, 60 )\r\n            endif\r\n            set rfun = GetUnitState( u, UNIT_STATE_MAX_LIFE ) - GetUnitState( u, UNIT_STATE_LIFE )\r\n        else\r\n            set rfun = rsp\r\n        endif\r\n        ///\r\n        if rfun >= 1 and GetUnitState( u, UNIT_STATE_LIFE) > 0.405 then\r\n            set t = 8\r\n            set rst = rfun\r\n            loop\r\n                exitwhen cyclA > 1\r\n                if rst >= 200 then\r\n                    set rst = rst - 200\r\n                    set t = t + 1\r\n                    set cyclA = cyclA - 1\r\n                endif\r\n                set cyclA = cyclA + 1\r\n            endloop\r\n            if t > 16 then\r\n                set t = 16\r\n            endif\r\n              \r\n            if inv( caster, 'I08E') > 0 and rfun >= 200 then\r\n                call bufst( caster, u, 'A0SX', 'B013', \"smou\", timebonus(caster, 7) )\r\n            endif\r\n            if inv( caster, 'I0DZ') > 0 and GetUnitAbilityLevel( u, 'B07W') == 0 then\r\n                call bufst( caster, u, 'A0P0', 'B07W', \"idos\", 5 )\r\n            endif\r\n            if not(udg_DamageHealLoop) then\r\n                if GetUnitAbilityLevel( u, 'B03A') > 0 then\r\n                    set n = randomtarget( u, 600, \"enemy\", \"\", \"\", \"\", \"\" )\r\n                    if n != null then\r\n                        set id = GetHandleId( n )\r\n                \r\n                        if LoadTimerHandle( udg_hash, id, StringHash( \"pcke\" ) ) == null then\r\n                            call SaveTimerHandle( udg_hash, id, StringHash( \"pcke\" ), CreateTimer() )\r\n                        endif\r\n                        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"pcke\" ) ) ) \r\n                        call SaveUnitHandle( udg_hash, id, StringHash( \"pcke\" ), n )\r\n                        call SaveUnitHandle( udg_hash, id, StringHash( \"pckec\" ), udg_unit[0] )\r\n                        call SaveReal( udg_hash, id, StringHash( \"pcke\" ), rfun*udg_real[2] )\r\n                        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( n ), StringHash( \"pcke\" ) ), 0.01, false, function PeacelockE_End )\r\n                    endif\r\n                endif\r\n                if inv( u, 'I0FN') > 0 then\r\n                    set id = GetHandleId( u )\r\n            \r\n                    if LoadTimerHandle( udg_hash, id, StringHash( \"orbhf\" ) ) == null then\r\n                        call SaveTimerHandle( udg_hash, id, StringHash( \"orbhf\" ), CreateTimer() )\r\n                    endif\r\n                    set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"orbhf\" ) ) ) \r\n                    call SaveUnitHandle( udg_hash, id, StringHash( \"orbhf\" ), u )\r\n                    call SaveUnitHandle( udg_hash, id, StringHash( \"orbhfc\" ), caster )\r\n                    call SaveReal( udg_hash, id, StringHash( \"orbhf\" ), rfun*0.4 )\r\n                    call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( u ), StringHash( \"orbhf\" ) ), 0.01, false, function OrbHolyFire )\r\n                endif\r\n            endif\r\n            \r\n            call SetUnitState( u, UNIT_STATE_LIFE, GetUnitState( u, UNIT_STATE_LIFE ) + rfun )\r\n            call textst( \"|c0000C800 +\" + I2S( R2I( rfun ) ), u, 64, GetRandomReal( 45, 135 ), t, 1 )\r\n            if udg_combatlogic[i] and not( udg_fightmod[3] ) and not( udg_logic[43] ) then\r\n                set udg_HealFight[i] = udg_HealFight[i] + rfun\r\n                set udg_HealAllTime[i] = udg_HealAllTime[i] + rfun\r\n                call MultiSetValue( udg_multi, ( udg_Multiboard_Position[i] * 3 ) - 1, 9,  I2S( R2I( udg_HealAllTime[i] ) ) )\r\n                call MultiSetValue( udg_multi, ( udg_Multiboard_Position[i] * 3 ) - 1, 10, I2S( R2I( udg_HealFight[i] ) ) )\r\n                if inv(caster, 'I0E3') > 0 then\r\n                    call ChangeToolItem( caster, 'I0E3', \"|cffbe81f7\", \"|r\", I2S(R2I(0.35*udg_HealFight[i])) )\r\n                endif\r\n            endif\r\n\r\n            set Event_AfterHeal_Heal = rfun\r\n            set Event_AfterHeal_Caster = caster\r\n            set Event_AfterHeal_Target = u\r\n            set Event_AfterHeal_Real = 0.00\r\n            set Event_AfterHeal_Real = 1.00\r\n            set Event_AfterHeal_Real = 0.00\r\n            \r\n            set udg_DamageHealLoop = false\r\n        endif\r\n        \r\n        set IsHealFromPotion = false\r\n        \r\n        set caster = null\r\n        set target = null\r\n        set u = null\r\n        set n = null\r\n    endfunction\r\n    \r\n    function EndHealTimer takes nothing returns nothing\r\n        local integer id = GetHandleId( GetExpiredTimer() )\r\n        local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"heal\" ) )\r\n        local unit caster = LoadUnitHandle( udg_hash, id, StringHash( \"healc\" ) )\r\n        local real r = LoadReal( udg_hash, id, StringHash( \"heal\" ) )\r\n    \r\n        call HealUnit( caster, target, r )\r\n        call FlushChildHashtable( udg_hash, id )\r\n    \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n\r\n    function healst takes unit caster, unit target, real r returns nothing\r\n        local integer id = 0\r\n        if IsAttack then\r\n            set id = GetHandleId( caster )\r\n            call SaveTimerHandle( udg_hash, id, StringHash(\"heal\"), CreateTimer() )\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash(\"heal\") ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash(\"healc\"), caster )\r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"heal\" ), target ) \r\n            call SaveReal( udg_hash, id, StringHash( \"heal\" ), r ) \r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( caster ), StringHash(\"heal\") ), 0.01, false, function EndHealTimer)\r\n        else\r\n            call HealUnit( caster, target, r )\r\n        endif\r\n        \r\n        set caster = null\r\n        set target = null\r\n    endfunction\r\n\r\nendlibrary",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}